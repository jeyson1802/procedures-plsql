CREATE OR REPLACE PACKAGE SCOB_PK_COBRANZAS IS

    -- Author  : ADMIN
    -- Created : 17/03/2011 15:00:13 p.m.
    -- Purpose :

    TYPE CU_REC_SET IS REF CURSOR;
    ----

    PROCEDURE SCOB_SP_S_MULTA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 17.03.2011
        -- Proposito    : Consulta las multas
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_C_EVENTO            IN CHAR, --1=RECEPCION;2=VALIDAR;3=OBSERVAR;4=ASIGNAR
     PI_V_CUM               IN VARCHAR2,
     PI_C_ANIO              IN T_SCOB_MULTA.ANIO%TYPE,
     PI_N_NRO_INGRESO       IN T_SCOB_MULTA_COBRANZA.NRO_INGRESO%TYPE,
     PI_N_NRO_IMPROCEDENCIA IN T_SCOB_MULTA_IMPROCEDENCIA.NRO_IMPROCEDENCIA%TYPE,
     PI_I_TIPO_PERSONA      IN T_SCOB_PERSONA.TIPO_PERSONA%TYPE,
     PI_I_TIPO_DOC          IN T_SCOB_PERSONA.TIPO_DOC%TYPE,
     PI_V_NRO_DOC           IN T_SCOB_PERSONA.NRO_DOC%TYPE,
     PI_V_APE_PATERNO       IN T_SCOB_PERSONA.APE_PATERNO%TYPE,
     PI_V_APE_MATERNO       IN T_SCOB_PERSONA.APE_MATERNO%TYPE,
     PI_V_PRI_NOMBRE        IN T_SCOB_PERSONA.PRI_NOMBRE%TYPE,
     PI_V_SEG_NOMBRE        IN T_SCOB_PERSONA.SEG_NOMBRE%TYPE,
     PI_V_RAZON_SOCIAL      IN T_SCOB_PERSONA.RAZON_SOCIAL%TYPE,
     PI_N_ID_USUARIO        IN T_SCOB_USUARIO.ID_USUARIO%TYPE,
     PI_C_FEC_INGRESO_INI   IN CHAR,
     PI_C_FEC_INGRESO_FIN   IN CHAR,
     PI_C_COD_DPTO          IN T_SCOB_UBIGEO.COD_DPTO%TYPE,
     PI_C_COD_PROV          IN T_SCOB_UBIGEO.COD_PROV%TYPE,
     PI_C_COD_DSTO          IN T_SCOB_UBIGEO.COD_DIST%TYPE,
     PI_N_VALOR_UIT_INI     IN T_SCOB_MULTA_DETAL.VALOR_UIT%TYPE,
     PI_N_VALOR_UIT_FIN     IN T_SCOB_MULTA_DETAL.VALOR_UIT%TYPE,
     PI_N_MONTO_UIT_INI     IN T_SCOB_MULTA_DETAL.MONTO_UIT%TYPE,
     PI_N_MONTO_UIT_FIN     IN T_SCOB_MULTA_DETAL.MONTO_UIT%TYPE,
     PI_N_COD_MATERIA       IN T_SCOB_MULTA.ID_MATERIA%TYPE,
     PI_N_COD_ORGANO_RESOL  IN T_SCOB_MULTA_DETAL.ID_ORGANO_RESOLUTIVO%TYPE,
     --PI_I_COD_TIPO_DOMICILIO  IN T_SCOB_PERSONA_DOMICILIO.TIPO_DOMICILIO%TYPE,
     --PI_V_DIRECCION           IN T_SCOB_PERSONA_DOMICILIO.DIRECCION%TYPE,
     PI_V_ASIG        IN VARCHAR2,
     PI_C_FEC_NOT_INI IN CHAR, --falta..
     PI_C_FEC_NOT_FIN IN CHAR, --falta..
     PI_C_FEC_RES_INI IN CHAR, --falta..
     PI_C_FEC_RES_FIN IN CHAR, --falta..
     PI_N_SEDE        IN T_SCOB_SEDE.ID_SEDE%TYPE, --falta..
     PO_CU_RETORNO    OUT CU_REC_SET
     
     );

    PROCEDURE SCOB_SP_S_DATOS_MULTA_COBRANZA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 17.03.2011
        -- Proposito    : Consulta los datos de la cabecera de una multa en cobranza
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PO_CU_RETORNO OUT CU_REC_SET);

    PROCEDURE SCOB_SP_S_MULTA_COBRANZA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 18.03.2011
        -- Proposito    : Consulta las multa para verificar su ingreso a AEC
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_V_CUM          IN T_SCOB_MULTA.CUM%TYPE,
     PO_N_RETORNO      OUT NUMBER,
     PO_N_RETORNO_DET  OUT NUMBER,
     PO_N_RETORNO_DET2 OUT NUMBER,
     PO_C_RETORNO_DET3 OUT CHAR, --
     PO_N_COD_ERROR    OUT NUMBER,
     PO_V_MSJ_ERROR    OUT VARCHAR2);

    PROCEDURE SCOB_SP_I_MULTA_COBRANZA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 18.03.2011
        -- Proposito    : Inserta la multa a AEC
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA       IN T_SCOB_MULTA_COBRANZA.ID_MULTA%TYPE,
     PI_N_ID_MULTA_DETAL IN T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE,
     PI_C_FECHA_INGRESO  CHAR,
     PI_ID_AREA_COBRANZA IN T_SCOB_AREA_COBRANZA.ID_AREA_COBRANZA%TYPE,
     PI_V_AUDUSUCREACION IN T_SCOB_MULTA_DETAL.AUDUSUCREACION%TYPE,
     
     PO_N_RETORNO   OUT NUMBER,
     PO_N_COD_ERROR OUT NUMBER,
     PO_V_MSJ_ERROR OUT VARCHAR2);

    PROCEDURE SCOB_SP_S_CARGA_ASIGNADA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 22.03.2011
        -- Proposito    : Consulta la carga de multas asignadas a los usuarios.
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PO_CU_RETORNO     OUT CU_REC_SET,
     PO_CU_RETORNO_DET OUT CU_REC_SET);

    PROCEDURE SCOB_SP_S_CARGA_ASIGNADA_DET
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 25.08.2011
        -- Proposito    : Consulta el detalle de la carga asignada  a los usuarios.
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PO_CU_RETORNO OUT CU_REC_SET);

    PROCEDURE SCOB_SP_U_CARGA_ASIGNADA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 22.03.2011
        -- Proposito    : insertar las multas asignadas a un usuario.
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_C_EVENTO         IN CHAR,
     PI_N_ID_USUARIO     IN T_SCOB_MULTA.ID_USUARIO_ASIG_COBRANZA%TYPE,
     PI_V_ID_MULTA       IN VARCHAR2,
     PI_N_NRO_ITEMS      IN NUMBER,
     PI_V_AUDUSUCREACION IN T_SCOB_MULTA_CHECK.AUDUSUCREACION%TYPE,
     PO_N_RETORNO        OUT NUMBER,
     PO_N_COD_ERROR      OUT NUMBER,
     PO_V_MSJ_ERROR      OUT VARCHAR2);

    PROCEDURE SCOB_SP_S_MULTA_IMPROCEDENCIA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 01.03.2011
        -- Proposito    : consulta las improcedencias registradas para una multa.
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_C_IND_PEND IN CHAR, --1=muestra solo la pendiente;0=muestra todas
     PO_CU_RETORNO OUT CU_REC_SET);

    PROCEDURE SCOB_SP_I_MULTA_IMPROCEDENCIA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 01.03.2011
        -- Proposito    : actualiza la respuesta a las improcedencias
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA          IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_N_ID_MULTA_DETAL    IN T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE,
     PI_N_ID_MULTA_COBRANZA IN T_SCOB_MULTA_COBRANZA.ID_MULTA_COBRANZA%TYPE,
     PI_I_COD_ESTADO        IN T_SCOB_MULTA.ESTADO_MULTA%TYPE,
     PI_I_COD_MOTIVO        IN T_SCOB_MULTA_IMPROCEDENCIA.COD_MOTIVO%TYPE,
     PI_V_DES_MOTIVO        IN T_SCOB_MULTA_IMPROCEDENCIA.DES_MOTIVO%TYPE,
     PI_N_ID_PLANTILLA      IN T_SCOB_MULTA_IMPROCEDENCIA.ID_PLANTILLA%TYPE,
     PI_N_MOTIVO_PLANTILLA  IN T_SCOB_MULTA_DOCUMENTO_GEN.ID_MOTIVO_PLANTILLA%TYPE,
     --
     PI_N_ID_SERVICIO      IN NUMBER, --falta rmca
     PI_N_ID_TIPO_SERVICIO IN NUMBER, --falta rmca
     PI_C_FLG_UCI          IN CHAR, --falta rmca
     PI_C_FEC_GENERACION   IN CHAR, --falta rmca
     --
     PI_V_AUDUSUCREACION        IN T_SCOB_MULTA_IMPROCEDENCIA.AUDUSUCREACION%TYPE,
     PI_N_ID_USUARIO_INGRESO    IN T_SCOB_MULTA.ID_USUARIO_INGRESO%TYPE,
     PO_CU_RETORNO_ETIQUETA     OUT CU_REC_SET,
     PO_CU_RETORNO_VAL_ETIQUETA OUT CU_REC_SET,
     PO_N_RETORNO               OUT NUMBER,
     PO_N_COD_ERROR             OUT NUMBER,
     PO_V_MSJ_ERROR             OUT VARCHAR2);

    PROCEDURE SCOB_SP_U_MULTA_IMPROCEDENCIA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 23.03.2011
        -- Proposito    : inserta improcedencias
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA               IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_N_ID_MULTA_DETAL         IN T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE,
     PI_N_ID_MULTA_IMPROCEDENCIA IN T_SCOB_MULTA_IMPROCEDENCIA.ID_MULTA_IMPROCEDENCIA%TYPE,
     PI_V_DES_RESPUESTA          IN T_SCOB_MULTA_IMPROCEDENCIA.DES_RESPUESTA%TYPE,
     PI_N_ID_USUARIO_RPTA        IN T_SCOB_USUARIO.ID_USUARIO%TYPE,
     PI_V_AUDUSUMODIFICACION     IN T_SCOB_MULTA_IMPROCEDENCIA.AUDUSUMODIFICACION%TYPE,
     
     PO_N_RETORNO   OUT NUMBER,
     PO_N_COD_ERROR OUT NUMBER,
     PO_V_MSJ_ERROR OUT VARCHAR2);

    PROCEDURE SCOB_SP_U_MULTA_CENTRAL_RIESGO
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 14.07.2011
        -- Proposito    : ACTUALIZAR ENVIO A CENTRAL DE RIESGOS
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA           IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_C_FLG_ENVIO_RIESGO   IN T_SCOB_MULTA.FLG_ENVIO_RIESGO%TYPE,
     PI_V_AUDUSUMODIFICACION IN T_SCOB_MULTA.AUDUSUMODIFICACION%TYPE,
     PO_N_RETORNO            OUT NUMBER,
     PO_N_COD_ERROR          OUT NUMBER,
     PO_V_MSJ_ERROR          OUT VARCHAR2);

    PROCEDURE SCOB_SP_S_MULTA_BY_ID(PI_N_ID_MULTA IN NUMBER,
                                    PO_CU_RETORNO OUT CU_REC_SET);

    PROCEDURE SCOB_SP_U_ASIGNAR_MASIVO
    /*
        -----------------------------------------------------------
        -- Autor        : MGALARZA
        -- Creado       : 12.12.2016
        -- Proposito    : ASIGNACIÓN MASIVA DE FILES
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (IN_AR_VC_CUM         IN STR_ARRAY,
     IN_ID_USUARIO_AEC    IN VARCHAR2,
     IN_VC_AUDUSUMODIFICA IN VARCHAR2,
     PO_N_RETORNO         OUT NUMBER,
     PO_V_MSJ_ERROR       OUT VARCHAR2);
    ----
    PROCEDURE SCOB_SP_S_COMBOS_MULTA_CERO
    /*
    -----------------------------------------------------------
    -- Autor        : HCHALCO
    -- Creado       : 05.08.2021
    -- Proposito    : Listar tipo multas de exp para la págiana multa cero
    -----------------------------------------------------------
    -- Modificacion :
    -- Autor        :
    -- Modificado   :
    -- Proposito    : 
    -----------------------------------------------------------
    */
    (
      PI_VC_NOM_COMBO         VARCHAR2,
      PI_NU_ID_ESTADO_MULTA   NUMBER,
      PO_CU_RETORNO            out CU_REC_SET
    );
    
    PROCEDURE SCOB_SP_I_MULTA_CERO
    /*
    -----------------------------------------------------------
    -- Autor        : HCHALCO
    -- Creado       : 05.08.2021
    -- Proposito    : Generar multa cero
    -----------------------------------------------------------
    -- Modificacion :
    -- Autor        :
    -- Modificado   :
    -- Proposito    : 
    -----------------------------------------------------------
    */
    (
      PI_VC_CUM   IN VARCHAR2,
      PI_NU_TIPO_MULTA         IN NUMBER,
      PI_NU_ESTADO_MULTA         IN NUMBER,
      PI_NU_MOTIVO_MULTA         IN NUMBER,
      PI_DT_FECHA_ESTADO       IN VARCHAR2,
      PI_VC_USUARIO_LOGIN      IN VARCHAR2,
      
      PO_NU_RETORNO            OUT NUMBER,
      PO_NU_COD_ERROR          OUT NUMBER,
      PO_VC_MSJ_ERROR          OUT VARCHAR2
    );
    
    PROCEDURE SCOB_SP_S_MULTA_CERO
    /*
        -----------------------------------------------------------
        -- Autor        : HCHALCO
        -- Creado       : 10.08.2021
        -- Proposito    : Consulta para Multa CERO
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_V_CUM               IN VARCHAR2,
     PO_CU_RETORNO          OUT CU_REC_SET
     
     );
     
procedure scob_sp_s_multa_avanzada_aec(
-----------------------------------------------------------------------------------------------
/*001*/   pi_v_area_macro                        in varchar2      --AREA MACRO
/*002*/  ,pi_v_cum_ini                           in varchar2      --cum
/*003*/  ,pi_v_cum_fin                           in varchar2      --cum
/*004*/  ,pi_v_fec_gen_cum_ini                   in varchar2      --FECHA GENERACION CUM INI
/*005*/  ,pi_v_fec_gen_cum_fin                   in varchar2      --FECHA GENERACION CUM FIN
/*006*/  ,pi_v_id_sede                           in varchar2      --sede
/*007*/  ,PI_V_ID_COD_DPTO_SEDE                  in VARCHAR2      --CODIGO DEPARTAMENTO SEDE
/*008*/  ,PI_V_ID_COD_PROV_SEDE                  in VARCHAR2      --CODIGO PROVINCIA SEDE
/*009*/  ,PI_V_ID_COD_DIST_SEDE                  in VARCHAR2      --CODIGO DISTRITO SEDE
/*010*/  ,pi_v_id_org_resol                      in varchar2      --organo resolutivo
/*011*/  ,PI_V_ID_COD_DPTO_ORGR                  in VARCHAR2      --CODIGO DEPARTAMENTO ORGANO RESOLUTIVO
/*012*/  ,PI_V_ID_COD_PROV_ORGR                  in VARCHAR2      --CODIGO PROVINCIA ORGANO RESOLUTIVO
/*013*/  ,PI_V_ID_COD_DIST_ORGR                  in VARCHAR2      --CODIGO DISTRITO ORGANO RESOLUTIVO
/*014*/  ,PI_V_ID_NRO_INSTANCIA                  in VARCHAR2      --NUMERO DE INSTANCIA
/*015*/  ,pi_v_id_materia                        in varchar2      --materia
/*016*/  ,pi_v_id_sub_materia                    in varchar2      --SUBMATERIA
/*017*/  ,pi_v_nro_exp_unico_ini                 in varchar2      --nro. expediente administrativo
/*018*/  ,pi_v_nro_exp_unico_fin                 in varchar2      --nro. expediente administrativo
/*019*/  ,pi_v_nroExpAdm_nivel                   in varchar2      --nro. expediente antiguo
/*020*/  ,pi_v_nro_resol                         in varchar2      --nro. resolucion or
/*021*/  ,pi_v_fec_reso_or_ini                   in varchar2      --FECHA RESOLUCION OR INI
/*022*/  ,pi_v_fec_reso_or_fin                   in varchar2      --FECHA RESOLUCION OR FIN
/*023*/  ,pi_v_fec_notifi_or_ini                 in varchar2      --FECHA NOTIFICACION RESOLUCION INI
/*024*/  ,pi_v_fec_notifi_or_fin                 in varchar2      --FECHA NOTIFICACION RESOLUCION FIN
/*025*/  ,PI_V_FEC_GENERACION_SEC_INI            in VARCHAR2      --FECHA GENERACION SEC
/*026*/  ,PI_V_FEC_GENERACION_SEC_FIN            in VARCHAR2      --FECHA GENERACION SEC
---
/*027*/  ,pi_v_fec_recepcion_aec_ini             in varchar2      --FECHA RECEPCION AEC INICIO
/*028*/  ,pi_v_fec_recepcion_aec_fin             in varchar2      --FECHA RECEPCION AEC FIN
/*029*/  ,PI_V_ANIO_INGRESO_AEC_INI              in varchar2      --AÑO INGRESO AL AEC INI
/*030*/  ,PI_V_ANIO_INGRESO_AEC_FIN              in varchar2      --AÑO INGRESO AL AEC FIN
/*031*/  ,PI_V_NRO_INGRESO_AEC_INI               in varchar2      --nro. ingreso aec
/*032*/  ,PI_V_NRO_INGRESO_AEC_FIN               in varchar2      --nro. ingreso aec
---
/*033*/  ,PI_V_ANIO_FILE_INI                     in varchar2      --AÑO FILE INI
/*034*/  ,PI_V_ANIO_FILE_FIN                     in varchar2      --AÑO FILE FIN
/*035*/  ,PI_V_NRO_FILE_INI                      in varchar2      --nro. file
/*036*/  ,PI_V_NRO_FILE_FIN                      in varchar2      --nro. file
/*037*/  ,pi_v_fec_recepcion_file_ini            in varchar2      --FECHA RECEPCION FILE INICIO
/*038*/  ,pi_v_fec_recepcion_file_fin            in varchar2      --FECHA RECEPCION FILE FIN
---
/*039*/  ,pi_n_valor_uit_ini                     in number        --nro uit ini
/*040*/  ,pi_n_valor_uit_fin                     in number        --nro uit fin
/*041*/  ,pi_n_monto_uit_ini                     in NUMBER        --MONTO UIT INI
/*042*/  ,pi_n_monto_uit_fin                     in NUMBER        --MONTO UIT FIN
/*043*/  ,pi_n_saldo_ini                         in NUMBER        --SALDO UIT INI
/*044*/  ,pi_n_saldo_fin                         in NUMBER        --SALDO UIT FIN
/*045*/  ,pi_v_id_tipo_multa                     in varchar2      --TIPO MULTA (SOLIDARIA/INDIVIDUAL)
/*046*/  ,pi_v_cod_estado_multa_resol            in varchar2      --estado de la multa resolutivo
/*047*/  ,pi_v_cod_estado_pago                   in varchar2      --estado pago de la multa
/*048*/  ,PI_V_FEC_ESTADO_MULTA_OR_INI           in VARCHAR2      --FECHA ESTADO MULTA OR INI
/*049*/  ,PI_V_FEC_ESTADO_MULTA_OR_FIN           in VARCHAR2      --FECHA ESTADO MULTA OR FIN
/*050*/  ,PI_V_FEC_ESTADO_MULTA_COB_INI          in VARCHAR2      --FECHA ESTADO MULTA COBRANZA
/*051*/  ,PI_V_FEC_ESTADO_MULTA_COB_FIN          in VARCHAR2      --FECHA ESTADO MULTA COBRANZA
/*052*/  ,pi_v_cod_estado_multa_cob              in varchar2      --estado de la multa cobranza
/*053*/  ,pi_v_cod_motivo_multa_cob              in varchar2      --motivo multa cobranza
/*054*/  ,PI_V_IND_TIPO_PAGO                     in VARCHAR2      --INDICADOR DE PAGO
/*055*/  ,pi_c_flg_asocu_multa                   IN CHAR         --INDICADOR % ASOCU > 0
-----------------------------------------------------------------------------------------------
/*056*/  ,pi_v_cod_estado_exped_cob              in varchar2      --estado expediente cobranza
/*057*/  ,pi_v_anio                              in varchar2      --año expediente cobranza
/*058*/  ,pi_v_nro_exp_cob_ini                   in varchar2      --nro. expediente cobranza
/*059*/  ,pi_v_nro_exp_cob_fin                   in varchar2      --nro. expediente cobranza
/*060*/  ,pi_v_fec_gen_exped_cob_ini             in varchar2      --FECHA GENERACION EXPED COBRANZA INI
/*061*/  ,pi_v_fec_gen_exped_cob_fin             in varchar2      --FECHA GENERACION EXPED COBRANZA FIN
-------
/*062*/  ,pi_v_gestor_cobranza                   in varchar2      --Gestor de cobranza
/*063*/  ,pi_v_fec_emi_rec_ini                   in varchar2      --Fecha de Emisión de la REC
/*064*/  ,pi_v_fec_emi_rec_fin                   in varchar2      --Fecha de Emisión de la REC
/*065*/  ,pi_v_fec_noti_rec_ini                  in varchar2      --Fecha de Notificación de la REC
/*066*/  ,pi_v_fec_noti_rec_fin                  in varchar2      --Fecha de Notificación de la REC
/*067*/  ,pi_v_cod_motivo_exped_cob              in varchar2      --motivo expediente cobranza---------
/*068*/  ,pi_v_fec_est_exped_cob_ini             in varchar2      --Fecha de Estado del Expediente
/*069*/  ,pi_v_fec_est_exped_cob_fin             in varchar2      --Fecha de Estado del Expediente
/*070*/  ,pi_v_num_env_arch_ini                  in varchar2      --Nº Envio a Archivo Central
/*071*/  ,pi_v_num_env_arch_fin                  in varchar2      --Nº Envio a Archivo Central
/*072*/  ,pi_v_fec_envi_arch_ini                 in varchar2      --Fecha de Envío a Archivo Central
/*073*/  ,pi_v_fec_envi_arch_fin                 in varchar2      --Fecha de Envío a Archivo Central
/*074*/  ,pi_v_nro_ofic_sunat_ini                in varchar2      --Nº de Oficio de la SUNAT
/*075*/  ,pi_v_nro_ofic_sunat_fin                in varchar2      --Nº de Oficio de la SUNAT
/*076*/  ,pi_n_dere_antiDump_ini                 in NUMBER        --Derechos Antidumping
/*077*/  ,pi_n_dere_antiDump_fin                 in NUMBER        --Derechos Antidumping
/*078*/  ,pi_v_nro_parti_ini                     in varchar2      --Partida Arancelaria
/*079*/  ,pi_v_nro_parti_fin                     in varchar2      --Partida Arancelaria
/*080*/  ,pi_v_nro_dua_ini                       in varchar2      --Nº DUA
/*081*/  ,pi_v_nro_dua_fin                       in varchar2      --Nº DUA
/*082*/  ,pi_v_nro_liq_cob_ini                   in varchar2      --Nº Liquidación de Cobranza
/*083*/  ,pi_v_nro_liq_cob_fin                   in varchar2      --Nº Liquidación de Cobranza
/*084*/  ,pi_v_id_intendencia                    in varchar2      --Intendencia antidumping
/*085*/  ,pi_c_flg_ind_embargo                   in char          --INDICADOR TIENE EMBARGO?
/*086*/  ,pi_v_fec_asig_gestor_ini               in varchar2      --fecha de asignacion de gestor ini
/*087*/  ,pi_v_fec_asig_gestor_fin               in varchar2      --fecha de asignacion de gestor fin
/*088*/  ,pi_v_fec_carta_precoactiva_ini         in varchar2      --fecha de carta precoactiva inicio
/*089*/  ,pi_v_fec_carta_precoactiva_fin         in varchar2      --fecha de carta precoactiva fin
/*090*/  ,pi_v_id_expectativa_cobro              in varchar2      --cadena codigos espectativa de cobro

-----------------------------------------------------------------------------------------------
        --denunciante
/*091*/  ,pi_v_d_codSanciona_ini                 in varchar2      --Código del INDECOPI
/*092*/  ,pi_v_d_codSanciona_fin                 in varchar2      --Código del INDECOPI
/*093*/  ,pi_i_d_tip_persona                     in integer       --Tipo de Personería
/*094*/  ,pi_v_d_razon_social                    in varchar2      --Razón Social
/*095*/  ,pi_v_d_ape_paterno                     in varchar2      --Apellido Paterno
/*096*/  ,pi_v_d_ape_materno                     in varchar2      --Apellido Materno
/*097*/  ,pi_v_d_ape_casada                      in varchar2      --Apellido Casada
/*098*/  ,pi_v_d_pri_nombre                      in varchar2      --Primer nombre
/*099*/  ,pi_v_d_seg_nombre                      in varchar2      --Segundo nombre
/*100*/  ,pi_i_d_tipo_doc                        in integer       --Tipo de Documento
/*101*/  ,pi_v_d_nro_doc                         in varchar2      --Nº de documento de identidad
/*102*/  ,pi_i_d_tip_empresa                     in integer       --Tipo de Empresa
/*103*/  ,pi_n_d_id_sect_econo                   in number        --CIIU (Actividad Economica)
/*104*/  ,pi_c_d_flg_asocu                       in char          --flag asocu
/*105*/  ,pi_c_d_fl_oficio                       in char          --indicador denunciante de oficio=Indecopi
        --denunciado
/*106*/  ,pi_v_do_codSanciona_ini                in varchar2      --Código del INDECOPI
/*107*/  ,pi_v_do_codSanciona_fin                in varchar2      --Código del INDECOPI
/*108*/  ,pi_i_do_tip_persona                    in integer       --Tipo de Personería
/*109*/  ,pi_v_do_razon_social                   in varchar2      --Razón Social
/*110*/  ,pi_v_do_ape_paterno                    in varchar2      --Apellido Paterno
/*111*/  ,pi_v_do_ape_materno                    in varchar2      --Apellido Materno
/*112*/  ,pi_v_do_ape_casada                     in varchar2      --Apellido Casada
/*113*/  ,pi_v_do_pri_nombre                     in varchar2      --Primer nombre
/*114*/  ,pi_v_do_seg_nombre                     in varchar2      --Segundo nombre
/*115*/  ,pi_i_do_tipo_doc                       in integer       --Tipo de Documento
/*116*/  ,pi_v_do_nro_doc                        in varchar2      --Nº de documento de identidad
/*117*/  ,pi_i_do_tip_empresa                    in integer       --Tipo de Empresa
/*118*/  ,pi_n_do_id_sect_econo                  in number        --CIIU (Actividad Economica)
/*119*/  ,pi_c_do_flg_asocu                      in char          --flag asocu
         --sancionado
/*120*/  ,pi_v_s_codSanciona_ini                 in varchar2      --Código del INDECOPI
/*121*/  ,pi_v_s_codSanciona_fin                 in varchar2      --Código del INDECOPI
/*122*/  ,pi_i_s_tip_persona                     in integer       --Tipo de Personería
/*123*/  ,pi_v_s_razon_social                    in varchar2      --Razón Social
/*124*/  ,pi_v_s_ape_paterno                     in varchar2      --Apellido Paterno
/*125*/  ,pi_v_s_ape_materno                     in varchar2      --Apellido Materno
/*126*/  ,pi_v_s_ape_casada                      in varchar2      --Apellido Casada
/*127*/  ,pi_v_s_pri_nombre                      in varchar2      --Primer nombre
/*128*/  ,pi_v_s_seg_nombre                      in varchar2      --Segundo nombre
/*129*/  ,pi_i_s_tipo_doc                        in integer       --Tipo de Documento
/*130*/  ,pi_v_s_nro_doc                         in varchar2      --Nº de documento de identidad
/*131*/  ,pi_i_s_tip_empresa                     in integer       --Tipo de Empresa
/*132*/  ,pi_n_s_id_sect_econo                   in number        --CIIU (Actividad Economica)
/*133*/  ,pi_c_s_flg_asocu                       in char           --flag asocu
--@0002:ini
/*134*/  ,pi_c_s_flg_buscar_by_contenido         in char           --0=NO;1=SI
--@0002:fin
-----------------------------------------------------------------------------------------------
         ,po_cu_retorno                          out cu_rec_set
);
    
END SCOB_PK_COBRANZAS;
/
CREATE OR REPLACE PACKAGE BODY SCOB_PK_COBRANZAS IS
    ----
    PROCEDURE SCOB_SP_S_MULTA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 17.03.2011
        -- Proposito    : Consulta las multas
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_C_EVENTO            IN CHAR, --1=RECEPCION;2=VALIDAR;3=OBSERVAR;4=ASIGNAR
     PI_V_CUM               IN VARCHAR2,
     PI_C_ANIO              IN T_SCOB_MULTA.ANIO%TYPE,
     PI_N_NRO_INGRESO       IN T_SCOB_MULTA_COBRANZA.NRO_INGRESO%TYPE,
     PI_N_NRO_IMPROCEDENCIA IN T_SCOB_MULTA_IMPROCEDENCIA.NRO_IMPROCEDENCIA%TYPE,
     PI_I_TIPO_PERSONA      IN T_SCOB_PERSONA.TIPO_PERSONA%TYPE,
     PI_I_TIPO_DOC          IN T_SCOB_PERSONA.TIPO_DOC%TYPE,
     PI_V_NRO_DOC           IN T_SCOB_PERSONA.NRO_DOC%TYPE,
     PI_V_APE_PATERNO       IN T_SCOB_PERSONA.APE_PATERNO%TYPE,
     PI_V_APE_MATERNO       IN T_SCOB_PERSONA.APE_MATERNO%TYPE,
     PI_V_PRI_NOMBRE        IN T_SCOB_PERSONA.PRI_NOMBRE%TYPE,
     PI_V_SEG_NOMBRE        IN T_SCOB_PERSONA.SEG_NOMBRE%TYPE,
     PI_V_RAZON_SOCIAL      IN T_SCOB_PERSONA.RAZON_SOCIAL%TYPE,
     PI_N_ID_USUARIO        IN T_SCOB_USUARIO.ID_USUARIO%TYPE,
     PI_C_FEC_INGRESO_INI   IN CHAR,
     PI_C_FEC_INGRESO_FIN   IN CHAR,
     PI_C_COD_DPTO          IN T_SCOB_UBIGEO.COD_DPTO%TYPE,
     PI_C_COD_PROV          IN T_SCOB_UBIGEO.COD_PROV%TYPE,
     PI_C_COD_DSTO          IN T_SCOB_UBIGEO.COD_DIST%TYPE,
     PI_N_VALOR_UIT_INI     IN T_SCOB_MULTA_DETAL.VALOR_UIT%TYPE,
     PI_N_VALOR_UIT_FIN     IN T_SCOB_MULTA_DETAL.VALOR_UIT%TYPE,
     PI_N_MONTO_UIT_INI     IN T_SCOB_MULTA_DETAL.MONTO_UIT%TYPE,
     PI_N_MONTO_UIT_FIN     IN T_SCOB_MULTA_DETAL.MONTO_UIT%TYPE,
     PI_N_COD_MATERIA       IN T_SCOB_MULTA.ID_MATERIA%TYPE,
     PI_N_COD_ORGANO_RESOL  IN T_SCOB_MULTA_DETAL.ID_ORGANO_RESOLUTIVO%TYPE,
     PI_V_ASIG              IN VARCHAR2,
     PI_C_FEC_NOT_INI       IN CHAR,
     PI_C_FEC_NOT_FIN       IN CHAR,
     PI_C_FEC_RES_INI       IN CHAR,
     PI_C_FEC_RES_FIN       IN CHAR,
     PI_N_SEDE              IN T_SCOB_SEDE.ID_SEDE%TYPE,
     PO_CU_RETORNO          OUT CU_REC_SET
     
     ) AS
        I_ALTO  INTEGER;
        I_MEDIO INTEGER;
        I_BAJO  INTEGER;
    
    BEGIN
    
        SELECT NVL(TD.TXT_VALOR3, 0),
               NVL(TD.TXT_VALOR2, 0),
               NVL(TD.TXT_VALOR1, 0)
          INTO I_BAJO,
               I_MEDIO,
               I_ALTO
          FROM T_SCOB_TABLA_DET TD
         WHERE TD.ID_TABLA = 16 --PARAMETROS GENERALES
           AND TD.COD_INTERNO = 18; --PARAMETRO DE COBRANZA PARA SEMAFORO ASIGNAR MULTA
    
        OPEN PO_CU_RETORNO FOR
            SELECT DISTINCT CASE
                                WHEN PI_C_EVENTO = '4' AND
                                     MULT.FEC_INGRESO_AEC IS NOT NULL AND
                                     MULT.ID_USUARIO_ASIG_COBRANZA IS NULL
                                
                                 THEN
                                --ESTADO EN TRAMITE DE COBRANZA, LISTO PARA SER ASIGNADO.
                                
                                 CASE
                                     WHEN (TO_DATE(TO_CHAR(SYSDATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN
                                          TO_DATE(TO_CHAR(MULT.FEC_INGRESO_AEC + I_BAJO, 'DD/MM/YYYY'), 'DD/MM/YYYY') AND
                                          TO_DATE(TO_CHAR(MULT.FEC_INGRESO_AEC + I_MEDIO, 'DD/MM/YYYY'), 'DD/MM/YYYY'))
                                     
                                      THEN
                                      '1' --VERDE
                                 
                                     WHEN
                                     
                                      (TO_DATE(TO_CHAR(SYSDATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN
                                      TO_DATE(TO_CHAR(MULT.FEC_INGRESO_AEC + I_MEDIO, 'DD/MM/YYYY'), 'DD/MM/YYYY') AND
                                      TO_DATE(TO_CHAR(MULT.FEC_INGRESO_AEC + I_ALTO, 'DD/MM/YYYY'), 'DD/MM/YYYY'))
                                     
                                      THEN
                                      '2' --AMARILLO
                                 
                                     WHEN
                                     
                                      TO_DATE(TO_CHAR(SYSDATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') >=
                                      TO_DATE(TO_CHAR(MULT.FEC_INGRESO_AEC + I_ALTO, 'DD/MM/YYYY'), 'DD/MM/YYYY') THEN
                                      '3' --ROJO
                                 
                                     ELSE
                                      '0'
                                 
                                 END
                            
                                ELSE
                                 '0'
                            END AS SEM_ASIG_MULTA,
                            MULT.FEC_ESTADO_MULTA AS FEC_ULT_ESTADO_MULTA,
                            MULT.ID_MULTA AS ID_MULTA,
                            MDET.ID_MULTA_DETAL AS ID_MULTA_DETAL,
                            NVL(MCOB.ID_MULTA_COBRANZA, 0) AS ID_MULTA_COBRANZA,
                            NVL(MULT.FLG_MULTA_COBRANZA, '0') AS IND_COBRANZA,
                            NVL(MULT.FLG_MULTA_IMPROCEDENCIA, '0') AS IND_IMPROCEDENCIA,
                            ---
                            ORGR.TIPO_INSTANCIA AS TIPO_INSTANCIA_ACTUAL,
                            MULT.ANIO || MULT.CUM AS COD_MULTA,
                            MDET.ID_ORGANO_RESOLUTIVO AS COD_ORG_RESOLUTIVO,
                            ORGR.DESCRIPCION AS NOM_ORG_RESOLUTIVO,
                            MCOB.FECHA_VALIDACION AS FEC_VALIDACION,
                            MULT.NRO_ULT_IMPROCEDENCIA AS NRO_IMPROCEDENCIA,
                            DECODE(NVL(MULT.NRO_ULT_IMPROCEDENCIA, '0'), '0', 'NO', 'SI') AS NOM_IND_IMPROCEDENCIA,
                            --MULT.FEC_ULT_IMPROCEDENCIA AS FEC_IMPROCEDENCIA,
                            trunc(mimp.audfeccreacion) as FEC_IMPROCEDENCIA,
                            MCOB.NRO_INGRESO AS NRO_INGRESO_AEC, --COLUMNA: NºINGRESO
                            MCOB.FECHA_INGRESO AS FEC_INGRESO_AEC, --COLUMNA: FEC.INGRESO
                            MULT.ID_MATERIA AS COD_MATERIA,
                            MATE.DESCRIPCION AS NOM_MATERIA,
                            MDET.NRO_RESOLUCION AS NRO_RESOLUCION,
                            MDET.FEC_RESOLUCION AS FEC_RESOLUCION,
                            DECODE(MULT.FLG_TIPO_MULTA, SCOB_PK_CONSTANTES.C_FLG_TIPO_MULTA_SOLID, ' ', PERS.COD_SANCIONADO) AS COD_SANCIONADO,
                            DECODE(MULT.FLG_TIPO_MULTA,
                                   SCOB_PK_CONSTANTES.C_FLG_TIPO_MULTA_SOLID,
                                   SCOB_PK_EXPEDIENTE.SCOB_FN_SANCIONADOS_MULTA(MULT.ID_MULTA, 0),
                                   DECODE(PERS.TIPO_PERSONA,
                                          SCOB_PK_CONSTANTES.C_TIPO_PERS_JURIDICA,
                                          PERS.RAZON_SOCIAL,
                                          PERS.APE_PATERNO || ' ' || PERS.APE_MATERNO || ' ' || PERS.PRI_NOMBRE || ' ' || PERS.SEG_NOMBRE || ' ' ||
                                          PERS.APE_CASADA)) AS DES_SANCIONADO,
                            
                            --DATOS ANTIDUMPING
                            DECODE(NVL(MUAN.NRO_LIQUIDACION_CODIGO, ' '),
                                   ' ',
                                   NULL,
                                   MUAN.NRO_LIQUIDACION_CODIGO || '-' || MUAN.NRO_LIQUIDACION_ANIO || '/' || MUAN.NRO_LIQUIDACION_CORRELATIVO) AS NRO_LIQUIDACION,
                            
                            --------------------------------------------------------------------------------------
                            --montos deuda antidumping
                            MUAN.TIPO_CAMBIO       AS TIPO_CAMBIO,
                            MUAN.MONTO_ANTIDUMPING AS MONTO_ANTIDUMPING,
                            --1=Multa OR 0=Multa Antidumping
                            DECODE(MULT.FLG_MULTA_RESOLUTIVO, '1', NULL, MUAN.MONTO_INTERES) AS MONTO_DA_INTERES_COMPENSATORIO, --MUAN.MONTO_INTERES AS MONTO_DA_INTERES_COMPENSATORIO,
                            DECODE(MULT.FLG_MULTA_RESOLUTIVO, '1', NULL, MUAN.MONTO_INTERES_MORATORIO) AS MONTO_DA_INTERES_MORATORIO, --MUAN.MONTO_INTERES_MORATORIO AS MONTO_DA_INTERES_MORATORIO,
                            MUAN.MONTO_TOTAL AS MONTO_TOTAL_DEUDA_DA,
                            
                            --montos deuda uit
                            MDET.VALOR_UIT               AS UIT,
                            MULT.MONTO_UIT               AS MONTO_UIT,
                            MULT.MONTO_INTERES           AS MONTO_IC,
                            MULT.MONTO_INTERES_MORATORIO AS MONTO_IM,
                            MULT.MONTO_COSTAS            AS MONTO_COSTAS,
                            MULT.MONTO_TOTAL_DEUDA       AS MONTO_TOTAL_DEUDA,
                            
                            --montos amortizado
                            CASE
                                WHEN MULT.COD_ESTADO_PAGO = SCOB_PK_CONSTANTES.C_EST_PAGO_DSCTO THEN
                                 0.00
                                ELSE
                                 MULT.TOTAL_AMORTIZADO
                            END AS MONTO_AMORTIZACION, --amortizado_uit
                            CASE
                                WHEN MULT.COD_ESTADO_PAGO = SCOB_PK_CONSTANTES.C_EST_PAGO_DSCTO THEN
                                 DECODE(MULT.IND_DESCUENTO, '1', MULT.MONTO_PORCENTAJE_DSCTO, 0.00)
                                ELSE
                                 0.00
                            END AS MONTO_AMORTIZADO_DSCTO,
                            MULT.TOTAL_AMORTIZADO_IC AS MONTO_AMORTIZADO_IC,
                            MULT.TOTAL_AMORTIZADO_IM AS MONTO_AMORTIZADO_IM,
                            MULT.TOTAL_AMORTIZADO_COSTAS AS MONTO_AMORTIZADO_COSTAS,
                            MULT.TOTAL_AMORTIZACION_DEUDA AS MONTO_TOTAL_AMORTIZADO,
                            
                            --montos saldo
                            MULT.SALDO             AS MONTO_SALDO, --uit
                            MULT.SALDO_IC          AS SALDO_IC,
                            MULT.SALDO_IM          AS SALDO_IM,
                            MULT.SALDO_COSTAS      AS SALDO_COSTAS,
                            MULT.SALDO_TOTAL_DEUDA AS SALDO_TOTAL,
                            --------------------------------------------------------------------------------------
                            
                            VALI.USUARIO             AS NOM_VALIDADO_POR,
                            ASIG.USUARIO             AS NOM_ASIGNADO_A,
                            MULT.FECHA_ASIG_COBRANZA AS FEC_ASIGNADO_A,
                            MULT.ESTADO_MULTA        AS COD_ESTADO,
                            -- INI TK76845@JCARRION
                            --SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MULT.ESTADO_MULTA) AS DES_ESTADO,
                            SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MIMP.ESTADO_MULTA) AS DES_ESTADO,
                            -- FIN TK76845@JCARRION
                            
                            LTRIM(RTRIM(MULT.FLG_TIPO_MULTA)) AS IND_RESPONSABILIDAD,
                            MRES.TXT_DESCRIPCION AS DES_RESPONSABILIDAD,
                            MDET.FEC_NOTIFICACION_RESOLUCION AS FEC_NOTIF,
                            MIMP.COD_MOTIVO AS COD_MOTIVO,
                            MOTI.DESCRIPCION AS NOM_MOTIVO,
                            MIMP.AUDUSUCREACION AS NOM_OBSERVADO_POR,
                            MULT.COD_ESTADO_PAGO AS COD_ESTADO_PAGO,
                            SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_EST_PAGOS, MULT.COD_ESTADO_PAGO) AS NOM_ESTADO_PAGO,
                            ' ' AS VER_MEMO,
                            MULT.FLG_ENVIO_RIESGO AS FLG_ENVIO_RIESGO,
                            MULT.FEC_ENVIO_RIESGO AS FEC_ENVIO_RIESGO,
                            MULT.FLG_MULTA_RESOLUTIVO AS IND_TIPO_MULTA, --1=MULTA OR;0=ANTIDUMPING
                            MULT.FEC_GENERACION_SEC AS FEC_GENERACION_SEC,
                            -------------NRO FILE-----------------------------------------------------
                            MULT.ANIO_FILE_AEC    AS ANIO_FILE, --ANIO
                            ACOB.CODIGO           AS COD_AREA_COB, --COD AREA
                            MULT.NRO_FILE_AEC     AS NRO_FILE, --CORRELATIVO  --COLUMNA: NºFILE (LOS 3 CAMPOS)
                            MULT.FEC_INGRESO_FILE AS FEC_INGRESO_FILE, --COLUMNA: FEC. INGRESO FILE
                            ---------------------------------------------------------------------------
                            EXPE.ID_EXPEDIENTE AS ID_EXPEDIENTE,
                            CASE
                                WHEN EXPE.ID_EXPEDIENTE IS NOT NULL THEN
                                 EST_EXP.DESCRIPCION
                                ELSE
                                  -- INI TK76845@JCARRION
                                  --SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MULT.ESTADO_MULTA)
                                 SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MIMP.ESTADO_MULTA)
                                 -- FIN TK76845@JCARRION
                            END AS ESTADO_MULTA_EXPEDIENTE,
                            
                            CASE
                                WHEN MULT.COD_ESTADO_PAGO = 3 OR
                                     MULT.COD_ESTADO_PAGO = 4 THEN --TOTAL O DESCUENTO
                                 '0' -- VALOR ANTERIOR: 1 cambio JCARRION@20161025
                                WHEN (MULT.ESTADO_MULTA <> SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO) AND
                                     (MULT.ESTADO_MULTA <> SCOB_PK_CONSTANTES.C_TBL_EST_COB_TRAMITE_COB) THEN
                                 '2'
                                ELSE
                                 '0'
                            END AS IND_HABILITA,
                            MULT.TIPO_INSTANCIA_INICIA AS TIPO_INSTANCIA_INICIA
              FROM T_SCOB_MULTA MULT
            
             INNER JOIN T_SCOB_MULTA_DETAL MDET
                ON MDET.ID_MULTA = MULT.ID_MULTA
               AND MDET.FLG_ACTUAL = '1'
            
              LEFT JOIN T_SCOB_MULTA_ANTIDUMPING MUAN
                ON MUAN.ID_MULTA = MULT.ID_MULTA
            
             INNER JOIN T_SCOB_MULTA_COBRANZA MCOB
                ON MCOB.ID_MULTA = MULT.ID_MULTA
               AND MCOB.FLG_ACTUAL = '1'
               AND MCOB.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
              LEFT JOIN usr_sicob.T_SCOB_MULTA_IMPROCEDENCIA MIMP
                ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
            
              LEFT JOIN T_SCOB_EST_MUL_COB_MOTIVO MOTI
                ON MOTI.ID_MOTIVO = MIMP.COD_MOTIVO
            
             INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
                ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
            
             INNER JOIN T_SCOB_MATERIA MATE
                ON MATE.ID_MATERIA = MULT.ID_MATERIA
            
             INNER JOIN T_SCOB_MULTA_SANCIONADO SANC
                ON SANC.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
               AND SANC.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND NVL(SANC.COD_TIPO_PERSONA, '1') = '1'
            
             INNER JOIN T_SCOB_PERSONA PERS
                ON PERS.ID_PERSONA = SANC.ID_PERSONA
               AND PERS.COD_SANCIONADO IS NOT NULL
            
              LEFT JOIN T_SCOB_PERSONA_DOMICILIO PDOM
                ON PDOM.ID_PERSONA = PERS.ID_PERSONA
               AND PDOM.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
              LEFT JOIN T_SCOB_MULTA_SANCIONADO_DIREC SDIR
                ON SDIR.ID_MULTA_SANCIONADO = SANC.ID_MULTA_SANCIONADO
               AND SDIR.ID_PERSONA_DOMICILIO = PDOM.ID_PERSONA_DOMICILIO
               AND SDIR.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
             INNER JOIN T_SCOB_TABLA_DET MRES --TIPO DE MULTA (SOLIDARIA?).
                ON MRES.ID_TABLA = SCOB_PK_CONSTANTES.C_TBL_TIPO_RESP_MULTA_OR
               AND LTRIM(RTRIM(MRES.COD_INTERNO)) = LTRIM(RTRIM(MULT.FLG_TIPO_MULTA))
            
              LEFT JOIN T_SCOB_UBIGEO UBIG
                ON UBIG.ID_UBIGEO = PDOM.ID_UBIGEO
            
              LEFT JOIN T_SCOB_USUARIO ASIG
                ON ASIG.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
            
              LEFT JOIN T_SCOB_USUARIO VALI
                ON VALI.ID_USUARIO = MCOB.ID_USUARIO_VALIDACION
            
              LEFT JOIN T_SCOB_EXPEDIENTE_MULTA EXMU
                ON EXMU.ID_MULTA = MULT.ID_MULTA
               AND EXMU.ESTADO = '1'
            
              LEFT JOIN T_SCOB_EXPEDIENTE EXPE
                ON EXPE.ID_EXPEDIENTE = EXMU.ID_EXPEDIENTE
            
              LEFT JOIN T_SCOB_EST_EXP_COB EST_EXP
                ON EST_EXP.ID_EST_EXP_COB = EXPE.ESTADO_EXPEDIENTE
              LEFT JOIN T_SCOB_AREA_COBRANZA ACOB
                ON ACOB.ID_AREA_COBRANZA = MULT.ID_AREA_COBRANZA
             WHERE MULT.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND (NVL(PI_V_CUM, ' ') = ' ' OR (NVL(PI_V_CUM, ' ') <> ' ' AND MULT.ANIO || TRIM(MULT.CUM) LIKE '%' || TRIM(PI_V_CUM) || '%'))
              
               AND (NVL(PI_C_ANIO, ' ') = ' ' OR (NVL(PI_C_ANIO, ' ') <> ' ' AND MULT.ANIO = PI_C_ANIO))
               AND (NVL(PI_I_TIPO_PERSONA, 0) = 0 OR (NVL(PI_I_TIPO_PERSONA, 0) <> 0 AND PERS.TIPO_PERSONA = PI_I_TIPO_PERSONA))
               AND (NVL(PI_I_TIPO_DOC, 0) = 0 OR (NVL(PI_I_TIPO_DOC, 0) <> 0 AND PERS.TIPO_DOC = PI_I_TIPO_DOC))
               AND (NVL(PI_V_NRO_DOC, ' ') = ' ' OR (NVL(PI_V_NRO_DOC, ' ') <> ' ' AND TRIM(PERS.NRO_DOC) = TRIM(PI_V_NRO_DOC)))
               AND (NVL(PI_V_APE_PATERNO, ' ') = ' ' OR
                   (NVL(PI_V_APE_PATERNO, ' ') <> ' ' AND
                   FUN_SCOB_NOSENSITE(TRIM(PERS.APE_PATERNO)) LIKE '%' || FUN_SCOB_NOSENSITE(TRIM(PI_V_APE_PATERNO)) || '%'))
               AND (NVL(PI_V_APE_MATERNO, ' ') = ' ' OR
                   (NVL(PI_V_APE_MATERNO, ' ') <> ' ' AND
                   FUN_SCOB_NOSENSITE(TRIM(PERS.APE_MATERNO)) LIKE '%' || FUN_SCOB_NOSENSITE(TRIM(PI_V_APE_MATERNO)) || '%'))
               AND (NVL(PI_V_PRI_NOMBRE, ' ') = ' ' OR (NVL(PI_V_PRI_NOMBRE, ' ') <> ' ' AND FUN_SCOB_NOSENSITE(TRIM(PERS.PRI_NOMBRE)) LIKE
                   '%' || FUN_SCOB_NOSENSITE(TRIM(PI_V_PRI_NOMBRE)) || '%'))
               AND (NVL(PI_V_SEG_NOMBRE, ' ') = ' ' OR (NVL(PI_V_SEG_NOMBRE, ' ') <> ' ' AND FUN_SCOB_NOSENSITE(TRIM(PERS.SEG_NOMBRE)) LIKE
                   '%' || FUN_SCOB_NOSENSITE(TRIM(PI_V_SEG_NOMBRE)) || '%'))
               AND (NVL(PI_V_RAZON_SOCIAL, ' ') = ' ' OR
                   (NVL(PI_V_RAZON_SOCIAL, ' ') <> ' ' AND
                   FUN_SCOB_NOSENSITE(TRIM(PERS.RAZON_SOCIAL)) LIKE '%' || FUN_SCOB_NOSENSITE(TRIM(PI_V_RAZON_SOCIAL)) || '%'))
               AND (NVL(PI_N_NRO_INGRESO, 0) = 0 OR (NVL(PI_N_NRO_INGRESO, ' ') <> ' ' AND FUN_SCOB_NOSENSITE(TRIM(MCOB.NRO_INGRESO)) LIKE
                   '%' || FUN_SCOB_NOSENSITE(TRIM(PI_N_NRO_INGRESO)) || '%'))
               AND (NVL(PI_N_NRO_IMPROCEDENCIA, 0) = 0 OR
                   (NVL(PI_N_NRO_IMPROCEDENCIA, ' ') <> ' ' AND
                   FUN_SCOB_NOSENSITE(TRIM(MIMP.NRO_IMPROCEDENCIA)) LIKE '%' || FUN_SCOB_NOSENSITE(TRIM(PI_N_NRO_IMPROCEDENCIA)) || '%'))
               AND (NVL(PI_N_COD_MATERIA, 0) = 0 OR (NVL(PI_N_COD_MATERIA, 0) <> 0 AND MULT.ID_MATERIA = PI_N_COD_MATERIA))
               AND (NVL(PI_N_COD_ORGANO_RESOL, 0) = 0 OR (NVL(PI_N_COD_ORGANO_RESOL, 0) <> 0 AND ORGR.ID_ORGANO_RESOLUTIVO = PI_N_COD_ORGANO_RESOL))
                  
                  --NUEVO
               AND (NVL(PI_V_ASIG, ' ') = ' ' OR
                   (NVL(PI_V_ASIG, ' ') <> ' ' AND ((PI_V_ASIG = '1' AND ASIG.USUARIO IS NOT NULL) OR (PI_V_ASIG = '0' AND ASIG.USUARIO IS NULL))))
                  
               AND (NVL(PI_C_FEC_INGRESO_INI, ' ') = ' ' OR
                   (NVL(PI_C_FEC_INGRESO_INI, ' ') <> ' ' AND
                   (
                   
                    (PI_C_EVENTO = '1' AND
                    TO_DATE(TO_CHAR(MCOB.FECHA_INGRESO, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN TO_DATE(PI_C_FEC_INGRESO_INI, 'DD/MM/YYYY') AND
                    TO_DATE(PI_C_FEC_INGRESO_FIN, 'DD/MM/YYYY')) OR
                    (PI_C_EVENTO = '2' AND
                    TO_DATE(TO_CHAR(MCOB.FECHA_VALIDACION, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN TO_DATE(PI_C_FEC_INGRESO_INI, 'DD/MM/YYYY') AND
                    TO_DATE(PI_C_FEC_INGRESO_FIN, 'DD/MM/YYYY')) OR
                    (PI_C_EVENTO = '3' AND
                    TO_DATE(TO_CHAR(MIMP.AUDFECCREACION, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN TO_DATE(PI_C_FEC_INGRESO_INI, 'DD/MM/YYYY') AND
                    TO_DATE(PI_C_FEC_INGRESO_FIN, 'DD/MM/YYYY')) OR
                    (PI_C_EVENTO = '4' AND
                    TO_DATE(TO_CHAR(MULT.FECHA_ASIG_COBRANZA, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN TO_DATE(PI_C_FEC_INGRESO_INI, 'DD/MM/YYYY') AND
                    TO_DATE(PI_C_FEC_INGRESO_FIN, 'DD/MM/YYYY')))))
                  
               AND (NVL(PI_N_VALOR_UIT_INI, 0) = 0 OR
                   (NVL(PI_N_VALOR_UIT_INI, 0) <> 0 AND MDET.VALOR_UIT BETWEEN PI_N_VALOR_UIT_INI AND PI_N_VALOR_UIT_FIN))
               AND (NVL(PI_N_MONTO_UIT_INI, 0) = 0 OR
                   (NVL(PI_N_MONTO_UIT_INI, 0) <> 0 AND MDET.MONTO_UIT BETWEEN PI_N_MONTO_UIT_INI AND PI_N_MONTO_UIT_FIN))
               AND (NVL(PI_C_COD_DPTO, ' ') = ' ' OR (NVL(PI_C_COD_DPTO, ' ') <> ' ' AND TRIM(UBIG.COD_DPTO) = TRIM(PI_C_COD_DPTO)))
               AND (NVL(PI_C_COD_PROV, ' ') = ' ' OR (NVL(PI_C_COD_PROV, ' ') <> ' ' AND TRIM(UBIG.COD_PROV) = TRIM(PI_C_COD_PROV)))
               AND (NVL(PI_C_COD_DSTO, ' ') = ' ' OR (NVL(PI_C_COD_DSTO, ' ') <> ' ' AND TRIM(UBIG.COD_DIST) = TRIM(PI_C_COD_DSTO)))
                  
                  -------------------
               AND ((NVL(PI_C_FEC_NOT_INI, ' ') = ' ') OR (NVL(PI_C_FEC_NOT_INI, ' ') <> ' ' AND
                   TO_DATE(TO_CHAR(MDET.FEC_NOTIFICACION_RESOLUCION, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN
                   TO_DATE(PI_C_FEC_NOT_INI, 'DD/MM/YYYY') AND TO_DATE(PI_C_FEC_NOT_FIN, 'DD/MM/YYYY')))
                  
               AND ((NVL(PI_C_FEC_RES_INI, ' ') = ' ') OR (NVL(PI_C_FEC_RES_INI, ' ') <> ' ' AND
                   TO_DATE(TO_CHAR(MDET.FEC_RESOLUCION, 'DD/MM/YYYY'), 'DD/MM/YYYY') BETWEEN
                   TO_DATE(PI_C_FEC_RES_INI, 'DD/MM/YYYY') AND TO_DATE(PI_C_FEC_RES_FIN, 'DD/MM/YYYY')))
                  
               AND (NVL(PI_N_SEDE, 0) = 0 OR (NVL(PI_N_SEDE, 0) <> 0 AND MULT.ID_SEDE = PI_N_SEDE))
                  -------------------
                  -----------------------------------------------
                  --EN LA BANDEJA DE POR ASIGNAR,
                  -----------------------------------------------
                  --SOLO SE VEN LAS MULTAS EN AEC QUE ESTAN COMO "NO INICIADAS"
               AND ((NVL(PI_C_EVENTO, ' ') = ' ')
                   
                   --OR ((PI_C_EVENTO=4) AND NVL(MCOB.ID_USUARIO_VALIDACION,0)<>0)
                   OR (PI_C_EVENTO = 4 AND NVL(MULT.FLG_MULTA_COBRANZA, '0') = '1' --SE ENCUENTRA EN EL AREA DE COBRANZA.
                   AND (MULT.ESTADO_MULTA = SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO OR
                   MULT.ESTADO_MULTA = SCOB_PK_CONSTANTES.C_TBL_EST_COB_TRAMITE_COB) AND
                   NOT (MULT.COD_ESTADO_PAGO IN (SCOB_PK_CONSTANTES.C_EST_PAGO_TOTAL, SCOB_PK_CONSTANTES.C_EST_PAGO_DSCTO) AND
                    MULT.ESTADO_ENVIO_ARCHIVO = SCOB_PK_CONSTANTES.C_EST_ARCH_CENTRAL_ENVIADO))
                   -----------------------------------------------
                   --EN LA BANDEJA DE OBSERVADOS,
                   -----------------------------------------------
                   --SOLO SE VEN LAS MULTAS EN AEC QUE HAN SIDO VALIDADAS.
                   OR ((PI_C_EVENTO = 3) AND (NVL(MCOB.ID_USUARIO_VALIDACION, 0) <> 0 AND
                   (NVL(MULT.FLG_MULTA_COBRANZA, '0') = '1' OR MULT.ESTADO_MULTA IN (9, 10, 11, 12, 13)) AND
                   (MULT.ID_MATERIA NOT IN (SCOB_PK_CONSTANTES.C_COD_MATERIA_ANTIDUMPING) AND
                   MULT.ID_SUB_MATERIA NOT IN (SCOB_PK_CONSTANTES.C_COD_SUBMATERIA_ANTIDUMPING))))
                   -----------------------------------------------
                   --EN LA BANDEJA DE VALIDAR,
                   -----------------------------------------------
                   --SOLO SE VEN LAS MULTAS EN AEC QUE HAN SIDO INGRESADAS
                   --QUE NO HAN SIDO VALIDADAS.
                   --QUE NO HAN SIDO OBSERVADOS CON IMPROCEDENCIA.
                   OR ((PI_C_EVENTO = 2) AND (MULT.ESTADO_MULTA = SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO OR
                   NVL(MCOB.ID_USUARIO_VALIDACION, 0) = 0 AND NVL(MULT.FLG_MULTA_COBRANZA, '0') = '1'))
                   -----------------------------------------------
                   --EN LA BANDEJA DE RECEPCIONAR,
                   -----------------------------------------------
                   --SOLO SE VEN LAS MULTAS EN AEC QUE HAN SIDO INGRESADAS
                   --QUE ESTAN CON ESTADO NO_INICIADO.
                   OR ((PI_C_EVENTO = 1) AND
                   (MULT.ESTADO_MULTA = SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO AND NVL(MULT.FLG_MULTA_COBRANZA, '0') = '1')))
                   
            ;
    
    END;

    PROCEDURE SCOB_SP_S_DATOS_MULTA_COBRANZA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 17.03.2011
        -- Proposito    : Consulta los datos de la cabecera de una multa en cobranza
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PO_CU_RETORNO OUT CU_REC_SET) AS
    BEGIN
    
        OPEN PO_CU_RETORNO FOR
        
            SELECT MCOB.ID_MULTA_COBRANZA AS ID_MULTA_COBRANZA,
                   MULT.ANIO || MULT.CUM AS COD_MULTA_AEC,
                   MCOB.NRO_INGRESO AS NRO_INGRESO,
                   MCOB.FECHA_INGRESO AS FEC_INGRESO,
                   MIMP.NRO_IMPROCEDENCIA AS NRO_IMPROCEDENCIA,
                   MIMP.COD_MOTIVO AS COD_MOTIVO_IMPROCEDENCIA,
                   MOTI.DESCRIPCION AS NOM_MOTIVO_IMPROCEDENCIA,
                   MIMP.DES_MOTIVO AS DES_IMPROCEDENCIA,
                   MIMP.AUDFECCREACION AS FEC_IMPROCEDENCIA,
                   MIMP.FECHA_RESPUESTA AS FEC_RPTA_OR,
                   MIMP.DES_RESPUESTA AS DES_RPTA_OR,
                   MULT.NRO_ULT_IMPROCEDENCIA AS NRO_ULT_IMPROCEDENCIA
            
              FROM T_SCOB_MULTA MULT
             INNER JOIN T_SCOB_MULTA_DETAL MDET
                ON MDET.ID_MULTA = MULT.ID_MULTA
               AND MDET.FLG_ACTUAL = '1'
               AND MDET.ESTADO = '1'
              LEFT JOIN T_SCOB_MULTA_COBRANZA MCOB
                ON MCOB.ID_MULTA = MULT.ID_MULTA
               AND MCOB.FLG_ACTUAL = '1'
              LEFT JOIN T_SCOB_MULTA_IMPROCEDENCIA MIMP
                ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
               AND MIMP.ESTADO = '1'
              LEFT JOIN T_SCOB_EST_MUL_COB_MOTIVO MOTI
                ON MOTI.ID_MOTIVO = MIMP.COD_MOTIVO
             WHERE MULT.ID_MULTA = PI_N_ID_MULTA;
    
    END;

    PROCEDURE SCOB_SP_S_MULTA_COBRANZA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 18.03.2011
        -- Proposito    : Consulta las multa para verificar su ingreso a AEC
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_V_CUM          IN T_SCOB_MULTA.CUM%TYPE,
     PO_N_RETORNO      OUT NUMBER,
     PO_N_RETORNO_DET  OUT NUMBER,
     PO_N_RETORNO_DET2 OUT NUMBER,
     PO_C_RETORNO_DET3 OUT CHAR, --
     PO_N_COD_ERROR    OUT NUMBER,
     PO_V_MSJ_ERROR    OUT VARCHAR2) AS
        N_ID_MULTA                     T_SCOB_MULTA_COBRANZA.ID_MULTA%TYPE;
        N_ID_MULTA_DET                 T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE;
        V_COD_MULTA                    VARCHAR(50);
        V_NRO_INGRESO                  VARCHAR(50);
        V_NRO_IMPROCEDENCIA            T_SCOB_MULTA_IMPROCEDENCIA.NRO_IMPROCEDENCIA%TYPE;
        I_EXISTE                       INTEGER;
        I_INSTANCIA_ACTUAL             INTEGER;
        C_FLG_MULTA_COBRANZA           CHAR(1);
        C_FLG_MULTA_IMPROCEDENCIA      CHAR(1);
        C_FLG_MULTA_IMPROCEDENCIA_RPTA CHAR(1);
        C_FLG_MULTA_OR                 CHAR(1);
        D_FEC_GENERACION_SEC           DATE;
    
    BEGIN
    
        BEGIN
        
            SELECT MULT.ID_MULTA,
                   MDET.ID_MULTA_DETAL,
                   MULT.ANIO || MULT.CUM,
                   MCOB.NRO_INGRESO,
                   MIMP.NRO_IMPROCEDENCIA,
                   ORGR.TIPO_INSTANCIA,
                   NVL(MULT.FLG_MULTA_COBRANZA, '0'),
                   NVL(MULT.FLG_MULTA_IMPROCEDENCIA, '0'),
                   DECODE(NVL(MIMP.ID_USUARIO_RPTA_IMPROCEDENCIA, '0'), '0', '0', '1'),
                   NVL(MULT.FLG_MULTA_RESOLUTIVO, '0'),
                   MULT.FEC_GENERACION_SEC
              INTO N_ID_MULTA,
                   N_ID_MULTA_DET,
                   V_COD_MULTA,
                   V_NRO_INGRESO,
                   V_NRO_IMPROCEDENCIA,
                   I_INSTANCIA_ACTUAL,
                   C_FLG_MULTA_COBRANZA,
                   C_FLG_MULTA_IMPROCEDENCIA,
                   C_FLG_MULTA_IMPROCEDENCIA_RPTA,
                   C_FLG_MULTA_OR,
                   D_FEC_GENERACION_SEC
              FROM T_SCOB_MULTA MULT
             INNER JOIN T_SCOB_MULTA_DETAL MDET
                ON MDET.ID_MULTA = MULT.ID_MULTA
               AND MDET.FLG_ACTUAL = '1'
             INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
                ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
              LEFT JOIN T_SCOB_MULTA_COBRANZA MCOB
                ON MCOB.ID_MULTA = MULT.ID_MULTA
               AND MCOB.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND MCOB.FLG_ACTUAL = '1'
              LEFT JOIN T_SCOB_MULTA_IMPROCEDENCIA MIMP
                ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
             WHERE MULT.ANIO || MULT.CUM = UPPER(TRIM(PI_V_CUM))
               AND MULT.ESTADO_MULTA IN (SELECT ESMU.COD_INTERNO
                                           FROM T_SCOB_TABLA_DET ESMU
                                          WHERE ESMU.ID_TABLA = SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA
                                            AND TRIM(ESMU.TXT_VALOR2) = 'COB' --area de cobranza
                                         )
               AND MULT.SALDO > 0 --agregado por OBS 181. 31.08.2011
            /*AND (NVL(MIMP.NRO_IMPROCEDENCIA,'0')='0' OR (
             NVL(MIMP.NRO_IMPROCEDENCIA,'0')<>'0' AND MIMP.FECHA_RESPUESTA IS NOT NULL)
            )*/
            ;
        
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                I_EXISTE := -1;
        END;
    
        PO_N_RETORNO      := N_ID_MULTA;
        PO_N_RETORNO_DET  := N_ID_MULTA_DET;
        PO_N_RETORNO_DET2 := I_INSTANCIA_ACTUAL;
        PO_C_RETORNO_DET3 := C_FLG_MULTA_OR;
        IF I_EXISTE = -1 THEN
            PO_N_COD_ERROR := -10;
            PO_V_MSJ_ERROR := 'No se puede realizar la acción. La multa no existe o antes ha sido recepcionada.';
            RETURN;
        END IF;
    
        IF TO_CHAR(D_FEC_GENERACION_SEC, 'DD/MM/YYYY') IS NULL THEN
             
            -- INICIO INDENCIAS SICOB - VICTOR BENDEZU
            /*PO_N_COD_ERROR := -13;
            PO_V_MSJ_ERROR := 'No se puede realizar la acción. No se ha generado la SEC para la multa.';*
            RETURN;*/
            
            UPDATE USR_SICOB.T_SCOB_MULTA
               SET FEC_GENERACION_SEC = SYSDATE
             WHERE ID_MULTA = N_ID_MULTA;
            -- FIN INDENCIAS SICOB - VICTOR BENDEZU
        END IF;
    
        IF C_FLG_MULTA_COBRANZA = '1' THEN
            PO_N_COD_ERROR := -11;
            PO_V_MSJ_ERROR := 'No se puede realizar la acción. ';
            PO_V_MSJ_ERROR := PO_V_MSJ_ERROR || 'La multa ' || PI_V_CUM || ' antes ha sido ingresada a cobranza.';
            RETURN;
        ELSIF C_FLG_MULTA_IMPROCEDENCIA = '1' AND
              C_FLG_MULTA_IMPROCEDENCIA_RPTA = '0' THEN
            PO_N_COD_ERROR := -12;
            PO_V_MSJ_ERROR := 'No se puede realizar la acción. La multa tiene una improcedencia no resuelta.';
            RETURN;
        END IF;
    
        IF NVL(V_NRO_INGRESO, ' ') = ' ' THEN
            PO_N_COD_ERROR := 1;
            PO_V_MSJ_ERROR := '¿Desea iniciar el proceso de recepción de la Multa (CUM) ' || PI_V_CUM || '?';
        ELSIF C_FLG_MULTA_IMPROCEDENCIA_RPTA = '1' THEN
            PO_N_COD_ERROR := 2;
            PO_V_MSJ_ERROR := 'La multa con CUM ' || PI_V_CUM || ' existe, ¿Desea ingresar respuesta a la improcedencia Nro:' || V_NRO_IMPROCEDENCIA || '?.';
        END IF;
    
    END;

    PROCEDURE SCOB_SP_I_MULTA_COBRANZA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 18.03.2011
        -- Proposito    : Inserta la multa a AEC
        -----------------------------------------------------------
        -- Modificaciones:
        --@0001:28.12.2012:Cambio para identificar el valor NULL en el campo ESTADO_MULTA
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA       IN T_SCOB_MULTA_COBRANZA.ID_MULTA%TYPE,
     PI_N_ID_MULTA_DETAL IN T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE,
     PI_C_FECHA_INGRESO  CHAR,
     PI_ID_AREA_COBRANZA IN T_SCOB_AREA_COBRANZA.ID_AREA_COBRANZA%TYPE,
     PI_V_AUDUSUCREACION IN T_SCOB_MULTA_DETAL.AUDUSUCREACION%TYPE,
     PO_N_RETORNO        OUT NUMBER,
     PO_N_COD_ERROR      OUT NUMBER,
     PO_V_MSJ_ERROR      OUT VARCHAR2) AS
        N_ID_MULTA_COBRANZA  T_SCOB_MULTA_COBRANZA.ID_MULTA_COBRANZA%TYPE;
        N_ID_USUARIO_INGRESO T_SCOB_MULTA_DETAL.ID_USUARIO_ULT_ESTADO%TYPE;
        I_EXISTE             INTEGER;
        N_CORRELATIVO        NUMBER;
        -----
    BEGIN
    
        PO_N_RETORNO   := 0;
        PO_N_COD_ERROR := 0;
        PO_V_MSJ_ERROR := ' ';
    
        --actualizar el registro actual de otros ingresos de la multa a AEC
        UPDATE T_SCOB_MULTA_COBRANZA MCOB
           SET MCOB.FLG_ACTUAL         = '0',
               MCOB.AUDFECMODIFICACION = SYSDATE,
               MCOB.AUDUSUMODIFICACION = PI_V_AUDUSUCREACION
         WHERE MCOB.ID_MULTA = PI_N_ID_MULTA
           AND MCOB.FLG_ACTUAL = '1';
    
        --inserta el ingreso a AEC
        --genera el codigo secuencial de la multa cobranza - tabla
        SELECT SCOB_SQ_MULTA_COBRANZA.NEXTVAL INTO N_ID_MULTA_COBRANZA FROM DUAL;
    
        -----------------------------------
        --SI ES LA PRIMERA VEZ QUE INGRESA A COBRANZA
        --SE GENERA EL CORRELATIVO
        SELECT COUNT(MULT.ID_MULTA)
          INTO I_EXISTE
          FROM T_SCOB_MULTA MULT
         WHERE MULT.FEC_INGRESO_FILE IS NOT NULL
           AND MULT.ID_MULTA = PI_N_ID_MULTA;
    
        IF I_EXISTE = 0 THEN
            --GENERANDO CORRELATIVO DEL AREA POR AÑO.
            SELECT NVL(MAX(TO_NUMBER(MULT.NRO_FILE_AEC)), 0) + 1
              INTO N_CORRELATIVO
              FROM T_SCOB_MULTA MULT
             WHERE MULT.ANIO_FILE_AEC = TO_CHAR(SYSDATE, 'YYYY')
               AND MULT.ID_AREA_COBRANZA = PI_ID_AREA_COBRANZA;
        
            UPDATE T_SCOB_MULTA MULT
               SET MULT.ANIO_FILE_AEC    = TO_CHAR(SYSDATE, 'YYYY'),
                   MULT.NRO_FILE_AEC     = LPAD(TO_CHAR(N_CORRELATIVO), 10, '0000000000'),
                   MULT.FEC_INGRESO_AEC  = SYSDATE, --UNICO POR FILE
                   MULT.FEC_INGRESO_FILE = SYSDATE, --ULTIMO POR FILE ("n" VECES AL AREA)
                   ID_AREA_COBRANZA      = PI_ID_AREA_COBRANZA
             WHERE MULT.ID_MULTA = PI_N_ID_MULTA;
        END IF;
        --------------------------------------
        ----------------------------------------
        N_CORRELATIVO := 0;
        --GENERANDO CORRELATIVO DE INGRESOS DE LA MULTA POR FILE GENERADO
        SELECT NVL(MAX(TO_NUMBER(MCOB.NRO_INGRESO)), 0) + 1
          INTO N_CORRELATIVO
          FROM T_SCOB_MULTA_COBRANZA MCOB
         WHERE MCOB.ID_MULTA = PI_N_ID_MULTA
           AND MCOB.ESTADO = '1';
        ----------------------------------------
    
        INSERT INTO T_SCOB_MULTA_COBRANZA
            (ID_MULTA_COBRANZA, ID_MULTA, NRO_INGRESO, ANIO, FECHA_INGRESO, AUDFECCREACION, AUDUSUCREACION, ESTADO, FLG_ACTUAL)
        VALUES
            (N_ID_MULTA_COBRANZA, PI_N_ID_MULTA, LPAD(TO_CHAR(N_CORRELATIVO), 4, '0000'), TO_CHAR(SYSDATE, 'YYYY'),
             TO_DATE(DECODE(NVL(PI_C_FECHA_INGRESO, ' '), ' ', TO_CHAR(SYSDATE, 'DD/MM/YYYY'), PI_C_FECHA_INGRESO), 'DD/MM/YYYY'), SYSDATE,
             PI_V_AUDUSUCREACION, SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO, '1');
    
        --actualiza los datos de la multa
        UPDATE T_SCOB_MULTA MULT
           SET MULT.FLG_MULTA_IMPROCEDENCIA = '0',
               MULT.FLG_MULTA_COBRANZA      = '1', --INGRESO A COBRANZA, ES UN PENDIENTE.
               MULT.AUDFECMODIFICACION      = SYSDATE,
               MULT.AUDUSUMODIFICACION      = PI_V_AUDUSUCREACION,
               MULT.FEC_INGRESO_FILE        = SYSDATE
         WHERE MULT.ID_MULTA = PI_N_ID_MULTA;
    
        --actualiza el estado de la multa
        --OBTENER EL ID DEL USUARIO QUE INGRESA LA INFORMACION
        SELECT USUARIO.ID_USUARIO
          INTO N_ID_USUARIO_INGRESO
          FROM T_SCOB_USUARIO USUARIO
         WHERE UPPER(TRIM(USUARIO.USUARIO)) = UPPER(TRIM(PI_V_AUDUSUCREACION))
           AND USUARIO.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO;
        SCOB_PK_MULTAS.SCOB_SP_I_MULTA_ESTADO(PI_N_ID_MULTA          => PI_N_ID_MULTA,
                                              PI_N_ID_MULTA_DETAL    => PI_N_ID_MULTA_DETAL,
                                              PI_I_ESTADO_MULTA      => SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO,
                                              PI_I_COD_MOTIVO        => 0,
                                              PI_C_FEC_ESTADO_MULTA  => TO_CHAR(SYSDATE, 'DD/MM/YYYY'),
                                              PI_V_AUDUSUCREACION    => PI_V_AUDUSUCREACION,
                                              PI_N_USU_ULT_ESTADO    => N_ID_USUARIO_INGRESO,
                                              PI_N_ID_MULTA_COBRANZA => 1,
                                              PO_N_RETORNO           => PO_N_RETORNO,
                                              PO_N_COD_ERROR         => PO_N_COD_ERROR,
                                              PO_V_MSJ_ERROR         => PO_V_MSJ_ERROR);
        --@0001:INI
        IF PO_N_RETORNO < 0 THEN
            ROLLBACK;
            RETURN;
        END IF;
        --@0001:FIN
        
        --INICIO VICTOR BENDEZU - MIGRACION SICOB A SIA
        USR_SIA_INTFZ.PKG_INTFZ_REG_MULTA_SICOB_SIA.SP_I_RECEP_MULTA_SICOB_A_SIA(PIN_NU_ID_MULTA => PI_N_ID_MULTA,
                                                                                 POUT_NU_COD_RESULT => PO_N_RETORNO,
                                                                                 POUT_VC_MSG_RESULT => PO_V_MSJ_ERROR);
        
        IF PO_N_RETORNO < 0 THEN
           ROLLBACK;
           RETURN;
        END IF;
        --FIN VICTOR BENDEZU - MIGRACION SICOB A SIA
  
        PO_N_RETORNO := N_ID_MULTA_COBRANZA;
        COMMIT;
    
    EXCEPTION
        WHEN OTHERS THEN
            PO_N_RETORNO   := -1;
            PO_N_COD_ERROR := SQLCODE;
            SELECT CASE
                       WHEN PO_N_COD_ERROR > 0 THEN
                        PO_N_COD_ERROR * -1
                       ELSE
                        PO_N_COD_ERROR
                   END
              INTO PO_N_COD_ERROR
              FROM DUAL;
            PO_V_MSJ_ERROR := SUBSTR(SQLERRM, 1, 250);
            ROLLBACK;
    END;

    PROCEDURE SCOB_SP_S_CARGA_ASIGNADA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 22.03.2011
        -- Proposito    : Consulta la carga de multas asignadas a los usuarios.
                          25.08.2011
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PO_CU_RETORNO     OUT CU_REC_SET,
     PO_CU_RETORNO_DET OUT CU_REC_SET) AS
        N_REG NUMBER;
    BEGIN
    
        SELECT COUNT(MULT.ID_MULTA)
          INTO N_REG
          FROM T_SCOB_MULTA MULT
         WHERE MULT.ID_USUARIO_ASIG_COBRANZA IS NOT NULL
           AND MULT.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO;
    
        OPEN PO_CU_RETORNO FOR
            SELECT MULT.ID_USUARIO_ASIG_COBRANZA AS COD_USUARIO,
                   USUA.USUARIO AS LGN_USUARIO,
                   ((COUNT(MULT.ID_MULTA) * 100) / N_REG) POR_ASIGNADO,
                   COUNT(MULT.ID_MULTA) AS NRO_CUMS,
                   SUM(NVL(MDET.VALOR_UIT, 0)) AS NRO_UIT,
                   SUM(NVL(MDET.MONTO_UIT, 0)) AS MON_UIT,
                   SUM(MULT.TOTAL_AMORTIZADO) AS MON_AMORTIZACION,
                   SUM(MULT.SALDO) AS SALDO,
                   SUM(NVL(MUAN.MONTO_ANTIDUMPING, 0)) AS MON_UIT_DOL
              FROM T_SCOB_MULTA MULT
             INNER JOIN T_SCOB_MULTA_DETAL MDET
                ON MDET.ID_MULTA = MULT.ID_MULTA
               AND MDET.FLG_ACTUAL = '1'
             INNER JOIN T_SCOB_USUARIO USUA
                ON USUA.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
              LEFT JOIN T_SCOB_MULTA_ANTIDUMPING MUAN
                ON MUAN.ID_MULTA = MULT.ID_MULTA
             WHERE MULT.ID_USUARIO_ASIG_COBRANZA IS NOT NULL
               AND MULT.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
             GROUP BY MULT.ID_USUARIO_ASIG_COBRANZA,
                      USUA.USUARIO
             ORDER BY 3 DESC;
    
        OPEN PO_CU_RETORNO_DET FOR
            SELECT COD_USUARIO,
                   LGN_USUARIO,
                   IND_REG,
                   COD_ESTADO,
                   DECODE(IND_REG,
                          '1',
                          SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, COD_ESTADO),
                          EST_EXP.DESCRIPCION) AS NOM_ESTADO,
                   COUNT(COD_ESTADO) AS NRO_CUM_BY_ESTADO
              FROM (SELECT MULT.ID_USUARIO_ASIG_COBRANZA AS COD_USUARIO,
                           USUA.USUARIO AS LGN_USUARIO,
                           DECODE(EXPE.ID_EXPEDIENTE, NULL, '1', '2') AS IND_REG, --1=MULTA; 2=EXPEDIENTE
                           DECODE(EXPE.ID_EXPEDIENTE, NULL, MULT.ESTADO_MULTA, EXPE.ESTADO_EXPEDIENTE) AS COD_ESTADO
                      FROM T_SCOB_MULTA MULT
                     INNER JOIN T_SCOB_MULTA_DETAL MDET
                        ON MDET.ID_MULTA = MULT.ID_MULTA
                       AND MDET.FLG_ACTUAL = '1'
                     INNER JOIN T_SCOB_USUARIO USUA
                        ON USUA.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
                      LEFT JOIN T_SCOB_EXPEDIENTE_MULTA EXMU
                        ON EXMU.ID_MULTA = MULT.ID_MULTA
                       AND EXMU.ESTADO = '1'
                      LEFT JOIN T_SCOB_EXPEDIENTE EXPE
                        ON EXPE.ID_EXPEDIENTE = EXMU.ID_EXPEDIENTE
                     WHERE MULT.ID_USUARIO_ASIG_COBRANZA IS NOT NULL
                       AND MULT.ESTADO = '1') CARGA_ASIG
              LEFT JOIN T_SCOB_EST_EXP_COB EST_EXP
                ON CARGA_ASIG.IND_REG = 2 --ESTADOS DEL EXPEDIENTE
               AND EST_EXP.ID_EST_EXP_COB = CARGA_ASIG.COD_ESTADO
             GROUP BY COD_USUARIO,
                      LGN_USUARIO,
                      IND_REG,
                      COD_ESTADO,
                      EST_EXP.DESCRIPCION
             ORDER BY COD_USUARIO,
                      IND_REG,
                      COD_ESTADO;
    
    END;

    PROCEDURE SCOB_SP_S_CARGA_ASIGNADA_DET
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 25.08.2011
        -- Proposito    : Consulta el detalle de la carga asignada  a los usuarios.
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PO_CU_RETORNO OUT CU_REC_SET) AS
    BEGIN
    
        OPEN PO_CU_RETORNO FOR
        
            SELECT COD_USUARIO,
                   LGN_USUARIO,
                   IND_REG,
                   COD_ESTADO,
                   DECODE(IND_REG,
                          '1',
                          SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, COD_ESTADO), --5
                          EST_EXP.DESCRIPCION) AS NOM_ESTADO,
                   COUNT(COD_ESTADO) AS NRO_CUM_BY_ESTADO,
                   SUM(MONTO_UIT_DA) AS MONTO_UIT_DA, --MONTO DOLARES POR DERECHO ANTIDUMPING
                   SUM(NRO_UIT) AS NRO_UIT,
                   SUM(MONTO_UIT) AS MONTO_UIT,
                   SUM(TOTAL_AMORTIZADO_UIT) AS TOTAL_AMORTIZADO_UIT,
                   SUM(SALDO_UIT) AS SALDO_UIT
            
              FROM (SELECT MULT.ID_USUARIO_ASIG_COBRANZA AS COD_USUARIO,
                           USUA.USUARIO AS LGN_USUARIO,
                           DECODE(EXPE.ID_EXPEDIENTE, NULL, '1', '2') AS IND_REG, --1=MULTA; 2=EXPEDIENTE
                           DECODE(EXPE.ID_EXPEDIENTE, NULL, MULT.ESTADO_MULTA, EXPE.ESTADO_EXPEDIENTE) AS COD_ESTADO,
                           MUAN.MONTO_ANTIDUMPING AS MONTO_UIT_DA,
                           MDET.VALOR_UIT AS NRO_UIT,
                           MULT.MONTO_UIT AS MONTO_UIT,
                           MULT.TOTAL_AMORTIZADO AS TOTAL_AMORTIZADO_UIT,
                           MULT.SALDO AS SALDO_UIT
                    
                      FROM T_SCOB_MULTA MULT
                     INNER JOIN T_SCOB_MULTA_DETAL MDET
                        ON MDET.ID_MULTA = MULT.ID_MULTA
                       AND MDET.FLG_ACTUAL = '1'
                     INNER JOIN T_SCOB_USUARIO USUA
                        ON USUA.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
                      LEFT JOIN T_SCOB_EXPEDIENTE_MULTA EXMU
                        ON EXMU.ID_MULTA = MULT.ID_MULTA
                       AND EXMU.ESTADO = '1'
                      LEFT JOIN T_SCOB_EXPEDIENTE EXPE
                        ON EXPE.ID_EXPEDIENTE = EXMU.ID_EXPEDIENTE
                      LEFT JOIN T_SCOB_MULTA_ANTIDUMPING MUAN
                        ON MUAN.ID_MULTA = MULT.ID_MULTA
                     WHERE MULT.ID_USUARIO_ASIG_COBRANZA IS NOT NULL
                       AND MULT.ESTADO = '1') CARGA_ASIG
              LEFT JOIN T_SCOB_EST_EXP_COB EST_EXP
                ON CARGA_ASIG.IND_REG = 2
               AND EST_EXP.ID_EST_EXP_COB = CARGA_ASIG.COD_ESTADO
             GROUP BY COD_USUARIO,
                      LGN_USUARIO,
                      IND_REG,
                      COD_ESTADO,
                      EST_EXP.DESCRIPCION
             ORDER BY COD_USUARIO,
                      IND_REG,
                      COD_ESTADO;
    
    END;

    PROCEDURE SCOB_SP_U_CARGA_ASIGNADA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 22.03.2011
        -- Proposito    : insertar las multas asignadas a un usuario.
        -----------------------------------------------------------
        -- Modificaciones:
        --@0001:28.12.2012:Cambio para identificar el valor NULL en el campo ESTADO_MULTA
        -----------------------------------------------------------
        */
    (PI_C_EVENTO IN CHAR,
     --1=ASIGNAR CARGA A USUARIO
     --2=VALIDAR MULTA
     PI_N_ID_USUARIO     IN T_SCOB_MULTA.ID_USUARIO_ASIG_COBRANZA%TYPE,
     PI_V_ID_MULTA       IN VARCHAR2,
     PI_N_NRO_ITEMS      IN NUMBER,
     PI_V_AUDUSUCREACION IN T_SCOB_MULTA_CHECK.AUDUSUCREACION%TYPE,
     PO_N_RETORNO        OUT NUMBER,
     PO_N_COD_ERROR      OUT NUMBER,
     PO_V_MSJ_ERROR      OUT VARCHAR2) IS
        N_ID_MULTA_ESTADO         INTEGER;
        N_ID_MULTA_NIVEL          T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE;
        V_ID_MULTA                VARCHAR2(50);
        N_CONT                    INTEGER;
        N_ID_USUARIO_INGRESO      T_SCOB_MULTA_DETAL.ID_USUARIO_INGRESO%TYPE;
        N_COD_ESTADO_MULTA_ACTUAL INTEGER;
    BEGIN
        PO_V_MSJ_ERROR := '';
        PO_N_RETORNO   := 0;
        PO_N_COD_ERROR := -1;
    
        IF PI_C_EVENTO = '1' THEN
            --ASIGNAR CARGA A USUARIOS
        
            UPDATE T_SCOB_MULTA MULT
               SET MULT.ID_USUARIO_ASIG_COBRANZA = DECODE(PI_N_ID_USUARIO, 0, NULL, PI_N_ID_USUARIO),
                   MULT.FECHA_ASIG_COBRANZA      = DECODE(PI_N_ID_USUARIO, 0, NULL, SYSDATE),
                   MULT.AUDUSUMODIFICACION       = PI_V_AUDUSUCREACION,
                   MULT.AUDFECMODIFICACION       = SYSDATE
             WHERE INSTR(PI_V_ID_MULTA, '|' || TO_CHAR(ID_MULTA) || '|') > 0;
        
            --cambiar el estado de la multa.
            --obtener el ultimo nivel de detalle de la multa
            N_CONT := 1;
            WHILE (N_CONT <= PI_N_NRO_ITEMS)
            LOOP
            
                SCOB_PK_UTILITARIO.SCOB_SP_S_SPLIT(PI_V_ID_MULTA, '|', N_CONT + 1, V_ID_MULTA);
            
                IF V_ID_MULTA = '#' THEN
                    EXIT;
                END IF;
            
                SELECT MDET.ID_MULTA_DETAL,
                       MULT.ESTADO_MULTA
                  INTO N_ID_MULTA_NIVEL,
                       N_COD_ESTADO_MULTA_ACTUAL
                  FROM T_SCOB_MULTA_DETAL MDET
                 INNER JOIN T_SCOB_MULTA MULT
                    ON MULT.ID_MULTA = MDET.ID_MULTA
                 WHERE MDET.ID_MULTA = TO_NUMBER(V_ID_MULTA)
                   AND MDET.FLG_ACTUAL = '1';
            
                  
                IF NVL(PI_N_ID_USUARIO, 0) = 0 THEN
                    --DEBE OBTENER EL ESTADO ANTERIOR DE LA MULTA
                    N_ID_MULTA_ESTADO := SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO;
                ELSE
                    N_ID_MULTA_ESTADO := SCOB_PK_CONSTANTES.C_TBL_EST_COB_TRAMITE_COB;
                END IF;
            
                IF N_ID_MULTA_ESTADO <> N_COD_ESTADO_MULTA_ACTUAL THEN
                    --2012.05.09
                    --VALIDA EL CAMBIO DE ESTADO:03.11.2011
                    SCOB_PK_VALIDA_ESTADO.SCOB_SP_S_VAL_ESTADO_MULTA(TO_NUMBER(V_ID_MULTA),
                                                                     N_ID_MULTA_ESTADO, --NUEVO ESTADO
                                                                     0, --NUEVO MOTIVO
                                                                     PO_N_COD_ERROR,
                                                                     PO_V_MSJ_ERROR);
                    IF PO_N_COD_ERROR < 0 THEN
                        PO_N_RETORNO := PO_N_COD_ERROR;
                        ROLLBACK;
                        RETURN;
                    END IF;
                END IF;
            
                --OBTENER EL ID DEL USUARIO QUE ACTUALIZA LA INFORMACION
                SELECT USUARIO.ID_USUARIO
                  INTO N_ID_USUARIO_INGRESO
                  FROM T_SCOB_USUARIO USUARIO
                 WHERE UPPER(TRIM(USUARIO.USUARIO)) = UPPER(TRIM(PI_V_AUDUSUCREACION))
                   AND USUARIO.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO;
            
            SCOB_PK_MULTAS.SCOB_SP_I_MULTA_ESTADO(TO_NUMBER(V_ID_MULTA),
                                                      N_ID_MULTA_NIVEL,
                                                      N_ID_MULTA_ESTADO,
                                                      0,
                                                      TO_CHAR(SYSDATE, 'DD/MM/YYYY'),
                                                      PI_V_AUDUSUCREACION,
                                                      N_ID_USUARIO_INGRESO,
                                                      1,
                                                      N_ID_MULTA_ESTADO,
                                                      PO_N_COD_ERROR,
                                                      PO_V_MSJ_ERROR);
            
                --@0001:INI
                IF PO_N_COD_ERROR < 0 THEN
                    ROLLBACK;
                    RETURN;
                END IF;
                --@0001:FIN
            
                N_CONT := N_CONT + 1;
                
            --INICIO VICTOR BENDEZU - MIGRACION SICOB A SIA
            USR_SIA_INTFZ.PKG_INTFZ_REG_MULTA_SICOB_SIA.SP_I_ASIGNAR_MULTA_SICOB_A_SIA(PIN_NU_ID_MULTA => TO_NUMBER(V_ID_MULTA),
                                                                                       POUT_NU_COD_RESULT => PO_N_RETORNO,
                                                                                       POUT_VC_MSG_RESULT => PO_V_MSJ_ERROR);
            
            IF PO_N_RETORNO < 0 THEN              
               PO_N_COD_ERROR := PO_N_RETORNO;
               ROLLBACK;
               RETURN;   
            END IF;
            --FIN VICTOR BENDEZU - MIGRACION SICOB A SIA
        
            END LOOP;
        
        ELSIF PI_C_EVENTO = '2' THEN
            --VALIDAR MULTA
            UPDATE T_SCOB_MULTA_COBRANZA MCOB
               SET MCOB.ID_USUARIO_VALIDACION = NVL(PI_N_ID_USUARIO, NULL),
                   MCOB.FECHA_VALIDACION      = SYSDATE,
                   MCOB.AUDUSUMODIFICACION    = PI_V_AUDUSUCREACION,
                   MCOB.AUDFECMODIFICACION    = SYSDATE
             WHERE INSTR(PI_V_ID_MULTA, '|' || TO_CHAR(MCOB.ID_MULTA) || '|') > 0
               AND MCOB.FLG_ACTUAL = '1';
        END IF;
        PO_N_COD_ERROR := 0;
        PO_N_RETORNO   := PI_N_ID_USUARIO;
        COMMIT;
        ----
    EXCEPTION
        WHEN OTHERS THEN
            PO_N_RETORNO   := -1;
            PO_N_COD_ERROR := SQLCODE;
            SELECT CASE
                       WHEN PO_N_COD_ERROR > 0 THEN
                        PO_N_COD_ERROR * -1
                       ELSE
                        PO_N_COD_ERROR
                   END
              INTO PO_N_COD_ERROR
              FROM DUAL;
            PO_V_MSJ_ERROR := SUBSTR(SQLERRM, 1, 250);
            ROLLBACK;
    END;

    PROCEDURE SCOB_SP_S_MULTA_IMPROCEDENCIA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 01.03.2011
        -- Proposito    : consulta las improcedencias registradas para una multa.
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_C_IND_PEND IN CHAR, --1=muestra solo la pendiente;0=muestra todas
     PO_CU_RETORNO OUT CU_REC_SET) AS
    BEGIN
        OPEN PO_CU_RETORNO FOR
        
            SELECT MIMP.ID_MULTA_IMPROCEDENCIA AS COD_MULTA_IMPROCEDENCIA,
                   MULT.ANIO || MULT.CUM AS COD_UNICO_MULTA,
                   --
                   MCOB.NRO_INGRESO AS NRO_INGRESO,
                   MCOB.FECHA_INGRESO AS FE_INGRESO,
                   SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MULT.ESTADO_MULTA) AS NOM_ESTADO_AEC,
                   --
                   MIMP.NRO_IMPROCEDENCIA AS NRO_IMPROCEDENCIA,
                   MIMP.AUDFECCREACION    AS FEC_IMPROCEDENCIA,
                   MIMP.COD_MOTIVO        AS COD_MOTIVO,
                   MOTI.DESCRIPCION       AS NOM_MOTIVO,
                   MIMP.DES_MOTIVO        AS DES_MOTIVO, --COLUMNA: NOTA
                   MIMP.AUDUSUCREACION    AS USU_OBSERVA,
                   MDGE.NOMBRE            AS NOM_FORMATO,
                   ---
                   MIMP.FECHA_RESPUESTA AS FEC_RPTA,
                   MIMP.DES_RESPUESTA   AS DES_RPTA,
                   
                   SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MULT.ESTADO_MULTA) AS NOM_ESTADO_MULTA_COB            
              FROM T_SCOB_MULTA_COBRANZA MCOB
            
              LEFT JOIN T_SCOB_MULTA MULT
                ON MULT.ID_MULTA = MCOB.ID_MULTA
            
              LEFT JOIN T_SCOB_MULTA_IMPROCEDENCIA MIMP
                ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
            
              LEFT JOIN T_SCOB_EST_MUL_COB_MOTIVO MOTI
                ON MOTI.ID_MOTIVO = MIMP.COD_MOTIVO
            
              LEFT JOIN T_SCOB_MULTA_DOCUMENTO_GEN MDGE
                ON MDGE.ID_MULTA_IMPROCEDENCIA = MIMP.ID_MULTA_IMPROCEDENCIA
               AND MDGE.ID_MULTA = MULT.ID_MULTA
            /*
            AND MDGE.TIPO_DOC_ASOC IN (
                 SCOB_PK_CONSTANTES.C_TIPO_DOC_ASOC_SISTEMA,
                 SCOB_PK_CONSTANTES.C_TIPO_DOC_ASOC_SISTEMA_ACT
            )
            */
             WHERE MULT.ID_MULTA = PI_N_ID_MULTA
               AND ((NVL(PI_C_IND_PEND, '0') = '0') OR (NVL(PI_C_IND_PEND, '0') <> '0' AND MIMP.FECHA_RESPUESTA IS NULL))
               AND MIMP.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
             ORDER BY MIMP.ID_MULTA_IMPROCEDENCIA DESC;
    
    END;

    PROCEDURE SCOB_SP_I_MULTA_IMPROCEDENCIA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 01.03.2011
        -- Proposito    : inserta improcedencias
        -----------------------------------------------------------
        -- Modificaciones:
        --@0001:28.12.2012:Cambio para identificar el valor NULL en el campo ESTADO_MULTA
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA          IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_N_ID_MULTA_DETAL    IN T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE,
     PI_N_ID_MULTA_COBRANZA IN T_SCOB_MULTA_COBRANZA.ID_MULTA_COBRANZA%TYPE,
     PI_I_COD_ESTADO        IN T_SCOB_MULTA.ESTADO_MULTA%TYPE,
     PI_I_COD_MOTIVO        IN T_SCOB_MULTA_IMPROCEDENCIA.COD_MOTIVO%TYPE,
     PI_V_DES_MOTIVO        IN T_SCOB_MULTA_IMPROCEDENCIA.DES_MOTIVO%TYPE,
     PI_N_ID_PLANTILLA      IN T_SCOB_MULTA_IMPROCEDENCIA.ID_PLANTILLA%TYPE,
     PI_N_MOTIVO_PLANTILLA  IN T_SCOB_MULTA_DOCUMENTO_GEN.ID_MOTIVO_PLANTILLA%TYPE,
     --
     PI_N_ID_SERVICIO      IN NUMBER,
     PI_N_ID_TIPO_SERVICIO IN NUMBER,
     PI_C_FLG_UCI          IN CHAR,
     PI_C_FEC_GENERACION   IN CHAR,
     --
     PI_V_AUDUSUCREACION        IN T_SCOB_MULTA_IMPROCEDENCIA.AUDUSUCREACION%TYPE,
     PI_N_ID_USUARIO_INGRESO    IN T_SCOB_MULTA.ID_USUARIO_INGRESO%TYPE,
     PO_CU_RETORNO_ETIQUETA     OUT CU_REC_SET,
     PO_CU_RETORNO_VAL_ETIQUETA OUT CU_REC_SET,
     PO_N_RETORNO               OUT NUMBER,
     PO_N_COD_ERROR             OUT NUMBER,
     PO_V_MSJ_ERROR             OUT VARCHAR2) IS
        N_ID_MULTA_IMPROCEDENCIA  T_SCOB_MULTA_IMPROCEDENCIA.ID_MULTA_IMPROCEDENCIA%TYPE;
        V_NRO_IMPROCEDENCIA       T_SCOB_MULTA_IMPROCEDENCIA.NRO_IMPROCEDENCIA%TYPE;
        N_ID_MULTA_ESTADO         T_SCOB_MULTA.ESTADO_MULTA%TYPE;
        I_EXISTE                  INTEGER := 0;
        N_COD_GENERADOR_DOCUMENTO T_SCOB_MULTA_DOCUMENTO_GEN.COD_GENERADOR_DOCUMENTO%TYPE;
        V_MSJ_ERROR               VARCHAR(100);
    
        NU_VALIDA NUMBER := 0;
    BEGIN
        PO_N_RETORNO   := PI_N_ID_MULTA;
        PO_N_COD_ERROR := -1;
        PO_V_MSJ_ERROR := '';
        V_MSJ_ERROR    := NULL;
        
        -- INI TK76845@JCARRION
        SELECT COUNT(1)
          INTO NU_VALIDA
          FROM USR_SICOB.T_SCOB_TABLA_DET T
         WHERE T.ID_TABLA_DET = 1787
           AND T.ESTADO = '1'
           AND INSTR(T.TXT_VALOR1, '|' || PI_I_COD_ESTADO || '¬' || PI_I_COD_MOTIVO || '|') > 0;
        -- FIN TK76845@JCARRION
        
        IF NU_VALIDA = 0 THEN -- TK76845@JCARRION
            --verifica si existe alguna improcedencia sin responder        
            SELECT COUNT(MULT.ID_MULTA)
              INTO I_EXISTE
              FROM T_SCOB_MULTA MULT
             WHERE MULT.ID_MULTA = PI_N_ID_MULTA
               AND NVL(MULT.FLG_MULTA_IMPROCEDENCIA, '0') = '1';
        
            IF I_EXISTE > 0 THEN
                RAISE_APPLICATION_ERROR(-20002, 'No se puede realizar la acción. Actualmente, la multa presenta una improcedencia sin resolver.');
            END IF;
        END IF; -- TK76845@JCARRION
        
        
        /*COMENTADO 03.11.2011
        --verifica si en su registro actual tiene improcedencia insubsanable o infructuoso.
        SELECT COUNT(MCOB.ID_MULTA_COBRANZA)
        INTO I_EXISTE
        FROM T_SCOB_MULTA_COBRANZA MCOB
        INNER JOIN T_SCOB_MULTA MULT
              ON MULT.ID_MULTA = MCOB.ID_MULTA
        INNER JOIN T_SCOB_MULTA_IMPROCEDENCIA MIMP
              ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
              AND MULT.ESTADO_MULTA IN (
                  SCOB_PK_CONSTANTES.C_TBL_EST_COB_INSUBSANABLE,
                  SCOB_PK_CONSTANTES.C_TBL_EST_COB_INFRUCTUOSO) --IMPROCEDENTE INSUBSABLE O INFRUCTUOSO
        WHERE MCOB.ID_MULTA = PI_N_ID_MULTA
        AND MCOB.FLG_ACTUAL = '1';
        
        IF I_EXISTE > 0 THEN
           raise_application_error (-20002,'No se puede realizar la acción. La multa se encuentra con estado INFRUCTUOSO o INSUBSANABLE.');
        END IF;
        */
    
        --VALIDA EL CAMBIO DE ESTADO:03.11.2011
        USR_SICOB.SCOB_PK_VALIDA_ESTADO.SCOB_SP_S_VAL_ESTADO_MULTA(PI_N_ID_MULTA,
                                                                   PI_I_COD_ESTADO, --NUEVO ESTADO
                                                                   PI_I_COD_MOTIVO, --NUEVO MOTIVO
                                                                   PO_N_COD_ERROR,
                                                                   PO_V_MSJ_ERROR);
        IF PO_N_COD_ERROR < 0 THEN
            PO_N_RETORNO := PO_N_COD_ERROR;
            RAISE_APPLICATION_ERROR(-20002, PO_V_MSJ_ERROR);
        END IF;
    
        --verificar si el usuario tiene otras multas con estado infrutuoso
        /*
        SELECT COUNT(MULT.ID_MULTA)
        INTO I_EXISTE
        FROM T_SCOB_MULTA MULT
        INNER JOIN T_SCOB_MULTA_DETAL MDET
              ON MDET.ID_MULTA = MULT.ID_MULTA
              AND MDET.FLG_ACTUAL = '1'
              AND MDET.ESTADO = '1'
        INNER JOIN T_SCOB_MULTA_SANCIONADO MSAN
              ON MSAN.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
              AND NVL(MSAN.COD_TIPO_PERSONA,'1')='1'
              AND MSAN.ESTADO = '1'
              AND MSAN.ID_PERSONA IN (
                                    SELECT MSAN.ID_PERSONA
                                    FROM T_SCOB_MULTA MULT
                                    INNER JOIN T_SCOB_MULTA_DETAL MDET
                                          ON MDET.ID_MULTA = MULT.ID_MULTA
                                          AND MDET.FLG_ACTUAL = '1'
                                          AND MDET.ESTADO = '1'
                                    INNER JOIN T_SCOB_MULTA_SANCIONADO MSAN
                                          ON MSAN.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
                                          AND NVL(MSAN.COD_TIPO_PERSONA,'1')='1'
                                          AND MSAN.ESTADO = '1'
                                    WHERE MULT.ID_MULTA = PI_N_ID_MULTA
              )
        WHERE MULT.ESTADO_MULTA IN (SCOB_PK_CONSTANTES.C_TBL_EST_COB_INFRUCTUOSO) --INFRUCTUOSO
        AND MULT.ESTADO = '1';
        
        IF I_EXISTE > 0 THEN
           v_msj_error := 'Se detectó que el o los sancionados de la multa presentan multas catalogadas como INFRUCTUOSAS.';
        END IF;
        */
    
        --genera el codigo secuencial de la improcedencia.
        SELECT SCOB_SQ_MULTA_IMPROCEDENCIA.NEXTVAL INTO N_ID_MULTA_IMPROCEDENCIA FROM DUAL;
    
        --generar el secuencial de improcedencia.
        V_NRO_IMPROCEDENCIA := '000'; --PARA INFRUCTUOSO O INSUBSANABLE
    
        IF PI_I_COD_ESTADO = SCOB_PK_CONSTANTES.C_TBL_EST_COB_SUBSANABLE THEN
            SELECT LPAD(NVL(MAX(MIMP.NRO_IMPROCEDENCIA), 0) + 1, 3, '000')
              INTO V_NRO_IMPROCEDENCIA
              FROM T_SCOB_MULTA_IMPROCEDENCIA MIMP
             INNER JOIN T_SCOB_MULTA_COBRANZA MCOB
                ON MCOB.ID_MULTA_COBRANZA = MIMP.ID_MULTA_COBRANZA
               AND MCOB.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
             WHERE MIMP.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND MCOB.ID_MULTA = PI_N_ID_MULTA;
        END IF;
    
        --inserta el registro
        INSERT INTO T_SCOB_MULTA_IMPROCEDENCIA
            (ID_MULTA_IMPROCEDENCIA, NRO_IMPROCEDENCIA, COD_MOTIVO, DES_MOTIVO, ID_PLANTILLA, ESTADO, AUDFECCREACION, AUDUSUCREACION,
             ID_MULTA_COBRANZA, ESTADO_MULTA)
        VALUES
            (N_ID_MULTA_IMPROCEDENCIA, V_NRO_IMPROCEDENCIA, PI_I_COD_MOTIVO, PI_V_DES_MOTIVO, PI_N_ID_PLANTILLA, SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO,
             SYSDATE, PI_V_AUDUSUCREACION, PI_N_ID_MULTA_COBRANZA, PI_I_COD_ESTADO);
    
        --actualiza la fecha de la ultima improcedencia registrada
        UPDATE T_SCOB_MULTA MULT
           SET MULT.FEC_ULT_IMPROCEDENCIA = SYSDATE,
               MULT.NRO_ULT_IMPROCEDENCIA = V_NRO_IMPROCEDENCIA
         WHERE MULT.ID_MULTA = PI_N_ID_MULTA;
    
        --actualiza el estado actual de la multa.
        IF PI_I_COD_ESTADO = SCOB_PK_CONSTANTES.C_TBL_EST_COB_SUBSANABLE THEN
            BEGIN
                UPDATE T_SCOB_MULTA MULT
                   SET MULT.FLG_MULTA_COBRANZA      = '0',
                       MULT.FLG_MULTA_IMPROCEDENCIA = '1',
                       MULT.AUDUSUMODIFICACION      = PI_V_AUDUSUCREACION,
                       MULT.AUDFECMODIFICACION      = SYSDATE
                 WHERE MULT.ID_MULTA = PI_N_ID_MULTA;
            END;
        END IF;
    
        /*
        IF PI_I_COD_ESTADO = SCOB_PK_CONSTANTES.C_TBL_EST_COB_SUBSANABLE THEN
          BEGIN
            UPDATE T_SCOB_MULTA MULT
            SET
              MULT.FLG_ENVIO_RIESGO = PI_C_FLG_ENVIO_RIESGO,
              MULT.FEC_ENVIO_RIESGO = PI_V_FEC_ENVIO_RIESGO,
              MULT.FEC_INGRESO_ENVIO_RIESGO = SYSDATE,
              MULT.AUDUSUMODIFICACION = PI_V_AUDUSUCREACION,
              MULT.AUDFECMODIFICACION = SYSDATE
            WHERE MULT.ID_MULTA = PI_N_ID_MULTA;
          END;
        END IF;
        */
    
        --insertar logs de estados
        SCOB_PK_MULTAS.SCOB_SP_I_MULTA_ESTADO(PI_N_ID_MULTA,
                                              PI_N_ID_MULTA_DETAL,
                                              PI_I_COD_ESTADO,
                                              PI_I_COD_MOTIVO,
                                              TO_CHAR(SYSDATE, 'DD/MM/YYYY'),
                                              PI_V_AUDUSUCREACION,
                                              PI_N_ID_USUARIO_INGRESO,
                                              1,
                                              N_ID_MULTA_ESTADO,
                                              PO_N_COD_ERROR,
                                              PO_V_MSJ_ERROR);
    
        --@0001:INI
        IF PO_N_COD_ERROR < 0 THEN
            ROLLBACK;
            RETURN;
        END IF;
        --@0001:FIN
    
        --GENERACION DEL DOC
        SCOB_PK_GENERAR_DOCUMENTO.SCOB_SP_I_GENERA_DOC_MULTA(PI_N_ID_MULTA,
                                                             PI_N_ID_MULTA_DETAL,
                                                             N_ID_MULTA_IMPROCEDENCIA,
                                                             '|' || TO_CHAR(PI_N_ID_PLANTILLA) || '|',
                                                             '|' || TO_CHAR(PI_N_MOTIVO_PLANTILLA) || '|',
                                                             1, --PI_N_NRO_ITEMSP
                                                             PI_I_COD_ESTADO,
                                                             SCOB_PK_CONSTANTES.C_TIPO_DOC_ASOC_SISTEMA, --COD_TIPO_ASOC
                                                             PI_N_ID_SERVICIO,
                                                             PI_N_ID_TIPO_SERVICIO,
                                                             PI_C_FLG_UCI,
                                                             PI_C_FEC_GENERACION,
                                                             PI_V_AUDUSUCREACION,
                                                             PI_N_ID_USUARIO_INGRESO,
                                                             '0', --no commit
                                                             N_COD_GENERADOR_DOCUMENTO,
                                                             PO_N_COD_ERROR,
                                                             PO_V_MSJ_ERROR);
    
        --GENERACION DE DATOS PARA LAS ETIQUETAS
        SCOB_PK_GENERAR_DOCUMENTO.SCOB_SP_S_GEN_DOC_ETIQ_MULTA(N_COD_GENERADOR_DOCUMENTO, PO_CU_RETORNO_ETIQUETA, PO_CU_RETORNO_VAL_ETIQUETA);
    
        IF V_MSJ_ERROR IS NOT NULL THEN
            PO_V_MSJ_ERROR := V_MSJ_ERROR;
        END IF;
    
        PO_N_COD_ERROR := 0;
        PO_N_RETORNO   := N_COD_GENERADOR_DOCUMENTO;
    
        COMMIT;
        --rollback;
    
    EXCEPTION
        WHEN OTHERS THEN
        
            IF SQLCODE = -20002 THEN
                IF PO_V_MSJ_ERROR IS NULL THEN
                    PO_V_MSJ_ERROR := SUBSTR(SQLERRM, 11, 400); --14.12.2011
                END IF;
            
                PO_N_RETORNO := -1;
            
                OPEN PO_CU_RETORNO_ETIQUETA FOR
                    SELECT NULL AS NRO_ETIQUETA,
                           NULL AS NOM_ETIQUETA
                      FROM DUAL;
            
                OPEN PO_CU_RETORNO_VAL_ETIQUETA FOR
                    SELECT NULL AS NOM_ARCH_PLANTILLA,
                           NULL AS NOM_ARCH_A_GENERAR,
                           NULL AS FEC_GENERACION_DOC,
                           NULL AS NRO_DOCUMENTO,
                           NULL AS SIGLA_AEC,
                           NULL AS IMPORTE_UIT,
                           NULL AS NOM_SANCIONADO_TODOS,
                           NULL AS NOM_CARGO_JEFE_AEC,
                           NULL AS NOM_SECRETARIO_TEC,
                           NULL AS NOM_CARGO_SECRETARIO_TEC,
                           NULL AS NOM_OR_MULTA,
                           NULL AS NOM_JEFE_AEC,
                           NULL AS NRO_FILE,
                           NULL AS SIGLA_NOM_JEFE_AEC,
                           NULL AS NRO_CUM,
                           NULL AS NRO_SEC,
                           NULL AS NRO_RESOLUCION_OR,
                           NULL AS NRO_EXPED_ADMIN_MULTA,
                           NULL AS SIGLA_NOM_USUARIO_GEN_DOC,
                           NULL AS AEC_ANEXO_TELEFONO,
                           NULL AS AEC_NOMBRE,
                           NULL AS AEC_TELEFONO,
                           NULL AS NRO_EXPED_ANTIGUO_MULTA,
                           NULL AS VALOR_UIT,
                           NULL AS NRO_EXPED_INFRUCTUOSO
                      FROM DUAL;
                RETURN;
            END IF;
        
            PO_N_RETORNO   := -1;
            PO_N_COD_ERROR := SQLCODE;
            SELECT CASE
                       WHEN PO_N_COD_ERROR > 0 THEN
                        PO_N_COD_ERROR * -1
                       ELSE
                        PO_N_COD_ERROR
                   END
              INTO PO_N_COD_ERROR
              FROM DUAL;
            --po_v_msj_error := substr(sqlerrm,1,250);
        
            IF PO_V_MSJ_ERROR IS NULL THEN
                PO_V_MSJ_ERROR := SUBSTR(SQLERRM, 11, 400); --14.12.2011
            END IF;
        
            ROLLBACK;
    END;

    PROCEDURE SCOB_SP_U_MULTA_IMPROCEDENCIA
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 23.03.2011
        -- Proposito    : actualiza improcedencias
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA               IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_N_ID_MULTA_DETAL         IN T_SCOB_MULTA_DETAL.ID_MULTA_DETAL%TYPE,
     PI_N_ID_MULTA_IMPROCEDENCIA IN T_SCOB_MULTA_IMPROCEDENCIA.ID_MULTA_IMPROCEDENCIA%TYPE,
     PI_V_DES_RESPUESTA          IN T_SCOB_MULTA_IMPROCEDENCIA.DES_RESPUESTA%TYPE,
     PI_N_ID_USUARIO_RPTA        IN T_SCOB_USUARIO.ID_USUARIO%TYPE,
     PI_V_AUDUSUMODIFICACION     IN T_SCOB_MULTA_IMPROCEDENCIA.AUDUSUMODIFICACION%TYPE,
     
     PO_N_RETORNO   OUT NUMBER,
     PO_N_COD_ERROR OUT NUMBER,
     PO_V_MSJ_ERROR OUT VARCHAR2) IS
        --  N_ID_MULTA_ESTADO                      NUMBER;
        --  N_ID_USUARIO_INGRESO                   T_SCOB_MULTA_DETAL.ID_USUARIO_ULT_ESTADO%TYPE;
    
    BEGIN
        PO_N_RETORNO   := 0;
        PO_N_COD_ERROR := -1;
        PO_V_MSJ_ERROR := '';
    
        UPDATE T_SCOB_MULTA_IMPROCEDENCIA
           SET DES_RESPUESTA                 = PI_V_DES_RESPUESTA,
               FECHA_RESPUESTA               = SYSDATE,
               AUDFECMODIFICACION            = SYSDATE,
               AUDUSUMODIFICACION            = PI_V_AUDUSUMODIFICACION,
               ID_USUARIO_RPTA_IMPROCEDENCIA = PI_N_ID_USUARIO_RPTA
         WHERE ID_MULTA_IMPROCEDENCIA = PI_N_ID_MULTA_IMPROCEDENCIA;
    
        --actualiza el estado de la multa a NO INICIADO, del area de COBRANZA.
        /*
        UPDATE T_SCOB_MULTA
        SET
          --FLG_MULTA_IMPROCEDENCIA = '0',
          --FLG_MULTA_COBRANZA = '1',
          AUDUSUMODIFICACION = PI_V_AUDUSUMODIFICACION,
          AUDFECMODIFICACION = SYSDATE
        WHERE T_SCOB_MULTA.ID_MULTA = PI_N_ID_MULTA;
        
        
        --insertar logs de estados
        --OBTENER EL ID DEL USUARIO QUE ACTUALIZA LA INFORMACION
        SELECT USUARIO.ID_USUARIO
        INTO N_ID_USUARIO_INGRESO
        FROM T_SCOB_USUARIO USUARIO
        WHERE UPPER(TRIM(USUARIO.USUARIO)) = UPPER(TRIM(PI_V_AUDUSUMODIFICACION))
        AND USUARIO.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO;
        
        SCOB_PK_MULTAS.SCOB_SP_I_MULTA_ESTADO(
          PI_N_ID_MULTA,
          PI_N_ID_MULTA_DETAL,
          SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO,
          0,
          TO_CHAR(SYSDATE,'DD/MM/YYYY'),
          PI_V_AUDUSUMODIFICACION,
          N_ID_USUARIO_INGRESO,
          1,
          N_ID_MULTA_ESTADO,
          PO_N_COD_ERROR,
          PO_V_MSJ_ERROR);
        
        */
    
        PO_N_COD_ERROR := 0;
        PO_N_RETORNO   := PI_N_ID_MULTA;
        COMMIT;
        ----
    EXCEPTION
        WHEN OTHERS THEN
            PO_N_RETORNO   := -1;
            PO_N_COD_ERROR := SQLCODE;
            SELECT CASE
                       WHEN PO_N_COD_ERROR > 0 THEN
                        PO_N_COD_ERROR * -1
                       ELSE
                        PO_N_COD_ERROR
                   END
              INTO PO_N_COD_ERROR
              FROM DUAL;
            PO_V_MSJ_ERROR := SUBSTR(SQLERRM, 1, 250);
            ROLLBACK;
    END;

    PROCEDURE SCOB_SP_U_MULTA_CENTRAL_RIESGO
    /*
        -----------------------------------------------------------
        -- Autor        : RMCA
        -- Creado       : 14.07.2011
        -- Proposito    : ACTUALIZAR ENVIO A CENTRAL DE RIESGOS
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_N_ID_MULTA           IN T_SCOB_MULTA.ID_MULTA%TYPE,
     PI_C_FLG_ENVIO_RIESGO   IN T_SCOB_MULTA.FLG_ENVIO_RIESGO%TYPE,
     PI_V_AUDUSUMODIFICACION IN T_SCOB_MULTA.AUDUSUMODIFICACION%TYPE,
     PO_N_RETORNO            OUT NUMBER,
     PO_N_COD_ERROR          OUT NUMBER,
     PO_V_MSJ_ERROR          OUT VARCHAR2) IS
    BEGIN
        PO_N_RETORNO   := 0;
        PO_N_COD_ERROR := 0;
        PO_V_MSJ_ERROR := '';
    
        UPDATE T_SCOB_MULTA
           SET FLG_ENVIO_RIESGO         = PI_C_FLG_ENVIO_RIESGO,
               FEC_ENVIO_RIESGO         = SYSDATE,
               FEC_INGRESO_ENVIO_RIESGO = SYSDATE,
               AUDFECMODIFICACION       = SYSDATE,
               AUDUSUMODIFICACION       = PI_V_AUDUSUMODIFICACION
         WHERE ID_MULTA = PI_N_ID_MULTA;
    
        PO_N_RETORNO := PI_N_ID_MULTA;
        COMMIT;
        ----
    EXCEPTION
        WHEN OTHERS THEN
            PO_N_RETORNO   := -1;
            PO_N_COD_ERROR := SQLCODE;
            SELECT CASE
                       WHEN PO_N_COD_ERROR > 0 THEN
                        PO_N_COD_ERROR * -1
                       ELSE
                        PO_N_COD_ERROR
                   END
              INTO PO_N_COD_ERROR
              FROM DUAL;
            PO_V_MSJ_ERROR := SUBSTR(SQLERRM, 1, 250);
            ROLLBACK;
    END;

    PROCEDURE SCOB_SP_S_MULTA_BY_ID(PI_N_ID_MULTA IN NUMBER,
                                    PO_CU_RETORNO OUT CU_REC_SET
                                    
                                    ) AS
    BEGIN
        OPEN PO_CU_RETORNO FOR
        
            SELECT DISTINCT MULT.ID_MULTA AS ID_MULTA,
                            MDET.ID_MULTA_DETAL AS ID_MULTA_DETAL,
                            NVL(MCOB.ID_MULTA_COBRANZA, 0) AS ID_MULTA_COBRANZA,
                            NVL(MULT.FLG_MULTA_COBRANZA, '0') AS IND_COBRANZA,
                            NVL(MULT.FLG_MULTA_IMPROCEDENCIA, '0') AS IND_IMPROCEDENCIA,
                            ---
                            ORGR.TIPO_INSTANCIA AS TIPO_INSTANCIA_ACTUAL,
                            MULT.ANIO || MULT.CUM AS COD_MULTA,
                            MDET.ID_ORGANO_RESOLUTIVO AS COD_ORG_RESOLUTIVO,
                            ORGR.DESCRIPCION AS NOM_ORG_RESOLUTIVO,
                            MCOB.FECHA_VALIDACION AS FEC_VALIDACION,
                            IMPRO.NRO_IMPROCEDENCIA AS NRO_IMPROCEDENCIA,
                            DECODE(NVL(IMPRO.NRO_IMPROCEDENCIA, '0'), '0', 'NO', 'SI') AS NOM_IND_IMPROCEDENCIA,
                            MCOB.NRO_INGRESO AS NRO_INGRESO_AEC,
                            MCOB.FECHA_INGRESO AS FEC_INGRESO_AEC,
                            MULT.ID_MATERIA AS COD_MATERIA,
                            MATE.DESCRIPCION AS NOM_MATERIA,
                            MDET.NRO_RESOLUCION AS NRO_RESOLUCION,
                            MDET.FEC_RESOLUCION AS FEC_RESOLUCION,
                            DECODE(MULT.FLG_TIPO_MULTA, SCOB_PK_CONSTANTES.C_FLG_TIPO_MULTA_SOLID, ' ', PERS.COD_SANCIONADO) AS COD_SANCIONADO,
                            DECODE(MULT.FLG_TIPO_MULTA,
                                   SCOB_PK_CONSTANTES.C_FLG_TIPO_MULTA_SOLID,
                                   SCOB_PK_EXPEDIENTE.SCOB_FN_SANCIONADOS_MULTA(MULT.ID_MULTA, 0),
                                   DECODE(PERS.TIPO_PERSONA,
                                          SCOB_PK_CONSTANTES.C_TIPO_PERS_JURIDICA,
                                          PERS.RAZON_SOCIAL,
                                          PERS.APE_PATERNO || ' ' || PERS.APE_MATERNO || ' ' || PERS.PRI_NOMBRE || ' ' || PERS.SEG_NOMBRE || ' ' ||
                                          PERS.APE_CASADA)) AS DES_SANCIONADO,
                            
                            --DATOS ANTIDUMPING
                            DECODE(NVL(MUAN.NRO_LIQUIDACION_CODIGO, ' '),
                                   ' ',
                                   NULL,
                                   MUAN.NRO_LIQUIDACION_CODIGO || '-' || MUAN.NRO_LIQUIDACION_ANIO || '/' || MUAN.NRO_LIQUIDACION_CORRELATIVO) AS NRO_LIQUIDACION,
                            MUAN.TIPO_CAMBIO AS TIPO_CAMBIO,
                            MUAN.MONTO_ANTIDUMPING AS MONTO_ANTIDUMPING,
                            MUAN.MONTO_INTERES AS MONTO_DA_INTERES_COMPENSATORIO,
                            MUAN.MONTO_INTERES_MORATORIO AS MONTO_DA_INTERES_MORATORIO,
                            --FIN DATOS ANTIDUMPING
                            
                            MDET.VALOR_UIT        AS UIT,
                            MULT.MONTO_UIT        AS MONTO_UIT,
                            MULT.TOTAL_AMORTIZADO AS MONTO_AMORTIZACION,
                            MULT.SALDO            AS MONTO_SALDO,
                            
                            VALI.USUARIO AS NOM_VALIDADO_POR,
                            ASIG.USUARIO AS NOM_ASIGNADO_A,
                            MULT.FECHA_ASIG_COBRANZA AS FEC_ASIGNADO_A,
                            MULT.ESTADO_MULTA AS COD_ESTADO,
                            SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MULT.ESTADO_MULTA) AS DES_ESTADO,
                            LTRIM(RTRIM(MULT.FLG_TIPO_MULTA)) AS IND_RESPONSABILIDAD,
                            MRES.TXT_DESCRIPCION AS DES_RESPONSABILIDAD,
                            MDET.FEC_NOTIFICACION_RESOLUCION AS FEC_NOTIF,
                            MIMP.COD_MOTIVO AS COD_MOTIVO,
                            MOTI.DESCRIPCION AS NOM_MOTIVO,
                            MIMP.AUDUSUCREACION AS NOM_OBSERVADO_POR,
                            MULT.COD_ESTADO_PAGO AS COD_ESTADO_PAGO,
                            SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_EST_PAGOS, MULT.COD_ESTADO_PAGO) AS NOM_ESTADO_PAGO,
                            ' ' AS VER_MEMO, --FALTA VER PAGOS!!! NO MEMO. 31.05.2011
                            MULT.FLG_ENVIO_RIESGO AS FLG_ENVIO_RIESGO,
                            MULT.FEC_ENVIO_RIESGO AS FEC_ENVIO_RIESGO,
                            MULT.FLG_MULTA_RESOLUTIVO AS IND_TIPO_MULTA, --1=MULTA OR;0=ANTIDUMPING
                            MULT.FEC_GENERACION_SEC AS FEC_GENERACION_SEC, --NVO
                            MULT.NRO_FILE_AEC AS NRO_FILE,
                            MULT.ANIO_FILE_AEC AS ANIO_FILE
            
              FROM T_SCOB_MULTA MULT
            
              LEFT JOIN (SELECT IMPRO.ID_MULTA AS ID_MULTA,
                                LPAD(MAX(TO_NUMBER(IMPRO.NRO_IMPROCEDENCIA)), 3, '000') AS NRO_IMPROCEDENCIA
                           FROM (SELECT MCOB.ID_MULTA          AS,
                                        MIMP.NRO_IMPROCEDENCIA AS NRO_IMPROCEDENCIA
                                   FROM T_SCOB_MULTA_IMPROCEDENCIA MIMP
                                  INNER JOIN T_SCOB_MULTA_COBRANZA MCOB
                                     ON MCOB.ID_MULTA_COBRANZA = MIMP.ID_MULTA_COBRANZA) IMPRO
                          GROUP BY IMPRO.ID_MULTA) IMPRO
                ON IMPRO.ID_MULTA = MULT.ID_MULTA
            
             INNER JOIN T_SCOB_MULTA_DETAL MDET
                ON MDET.ID_MULTA = MULT.ID_MULTA
               AND MDET.FLG_ACTUAL = '1'
            
              LEFT JOIN T_SCOB_MULTA_ANTIDUMPING MUAN
                ON MUAN.ID_MULTA = MULT.ID_MULTA
            
              LEFT JOIN T_SCOB_MULTA_COBRANZA MCOB
                ON MCOB.ID_MULTA = MULT.ID_MULTA
               AND MCOB.FLG_ACTUAL = '1'
               AND MCOB.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
              LEFT JOIN T_SCOB_MULTA_IMPROCEDENCIA MIMP
                ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
            
              LEFT JOIN T_SCOB_EST_MUL_COB_MOTIVO MOTI
                ON MOTI.ID_MOTIVO = MIMP.COD_MOTIVO
            
             INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
                ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
            
             INNER JOIN T_SCOB_MATERIA MATE
                ON MATE.ID_MATERIA = MULT.ID_MATERIA
            
             INNER JOIN T_SCOB_MULTA_SANCIONADO SANC
                ON SANC.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
               AND SANC.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND NVL(SANC.COD_TIPO_PERSONA, '1') = '1'
            
             INNER JOIN T_SCOB_PERSONA PERS
                ON PERS.ID_PERSONA = SANC.ID_PERSONA
               AND PERS.COD_SANCIONADO IS NOT NULL
            
              LEFT JOIN T_SCOB_PERSONA_DOMICILIO PDOM
                ON PDOM.ID_PERSONA = PERS.ID_PERSONA
               AND PDOM.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
              LEFT JOIN T_SCOB_MULTA_SANCIONADO_DIREC SDIR
                ON SDIR.ID_MULTA_SANCIONADO = SANC.ID_MULTA_SANCIONADO
               AND SDIR.ID_PERSONA_DOMICILIO = PDOM.ID_PERSONA_DOMICILIO
               AND SDIR.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
             INNER JOIN T_SCOB_TABLA_DET MRES --TIPO DE MULTA (SOLIDARIA?).
                ON MRES.ID_TABLA = SCOB_PK_CONSTANTES.C_TBL_TIPO_RESP_MULTA_OR
               AND LTRIM(RTRIM(MRES.COD_INTERNO)) = LTRIM(RTRIM(MULT.FLG_TIPO_MULTA))
            
              LEFT JOIN T_SCOB_UBIGEO UBIG
                ON UBIG.ID_UBIGEO = PDOM.ID_UBIGEO
            
              LEFT JOIN T_SCOB_USUARIO ASIG
                ON ASIG.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
            
              LEFT JOIN T_SCOB_USUARIO VALI
                ON VALI.ID_USUARIO = MCOB.ID_USUARIO_VALIDACION
            
             WHERE MULT.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND MULT.ID_MULTA = PI_N_ID_MULTA
            
            ;
    END;
    ----

    PROCEDURE SCOB_SP_U_ASIGNAR_MASIVO(IN_AR_VC_CUM         IN STR_ARRAY,
                                       IN_ID_USUARIO_AEC    IN VARCHAR2,
                                       IN_VC_AUDUSUMODIFICA IN VARCHAR2,
                                       PO_N_RETORNO         OUT NUMBER,
                                       PO_V_MSJ_ERROR       OUT VARCHAR2) IS
    BEGIN
    
        FOR I IN 1 .. IN_AR_VC_CUM.COUNT
        LOOP
        
            UPDATE USR_SICOB.T_SCOB_MULTA T
               SET T.ID_USUARIO_ASIG_COBRANZA = IN_ID_USUARIO_AEC,
                   T.ESTADO_MULTA             = SCOB_PK_CONSTANTES.C_TBL_EST_COB_TRAMITE_COB
             WHERE T.ANIO || T.CUM IN (IN_AR_VC_CUM(I));
        
        END LOOP;
    
        COMMIT;
        PO_N_RETORNO   := 0;
        PO_V_MSJ_ERROR := '';
    
    EXCEPTION
        WHEN OTHERS THEN
            PO_N_RETORNO := SQLCODE;
            SELECT CASE
                       WHEN PO_N_RETORNO > 0 THEN
                        PO_N_RETORNO * -1
                       ELSE
                        PO_N_RETORNO
                   END
              INTO PO_N_RETORNO
              FROM DUAL;
        
            ROLLBACK;
            PO_N_RETORNO   := SQLCODE;
            PO_V_MSJ_ERROR := SQLERRM;
    END SCOB_SP_U_ASIGNAR_MASIVO;
    
    PROCEDURE SCOB_SP_S_COMBOS_MULTA_CERO
    /*
    -----------------------------------------------------------
    -- Autor        : HCHALCO
    -- Creado       : 05.08.2021
    -- Proposito    : Listar tipo multas de exp para la págiana multa cero
    -----------------------------------------------------------
    -- Modificacion :
    -- Autor        :
    -- Modificado   :
    -- Proposito    : 
    -----------------------------------------------------------
    */
    (
      PI_VC_NOM_COMBO         VARCHAR2,
      PI_NU_ID_ESTADO_MULTA   NUMBER,
      PO_CU_RETORNO            out CU_REC_SET
    )
    AS
    BEGIN
      IF PI_VC_NOM_COMBO = 'tipoMulta' THEN 
        OPEN  PO_CU_RETORNO for
        SELECT T.COD_INTERNO AS ID, T.TXT_DESCRIPCION AS DESCRIPCION
          FROM USR_SICOB.T_SCOB_TABLA_DET T
         WHERE T.ID_TABLA = 85
           AND T.ESTADO = 1;
        
      ELSIF PI_VC_NOM_COMBO = 'estadoMulta' THEN
          OPEN  PO_CU_RETORNO for
          SELECT T.COD_INTERNO AS ID, T.TXT_DESCRIPCION AS  DESCRIPCION
          FROM USR_SICOB.T_SCOB_TABLA_DET T 
          WHERE ID_TABLA=5 AND T.COD_INTERNO IN (11,12,13); 
          
      ELSIF PI_VC_NOM_COMBO = 'motivoMulta' THEN
          OPEN  PO_CU_RETORNO for
          SELECT t.id_motivo AS ID, t.descripcion AS DESCRIPCION 
          FROM USR_SICOB.T_SCOB_EST_MUL_COB_MOTIVO T 
          WHERE T.ID_EST_MUL_COB=PI_NU_ID_ESTADO_MULTA AND T.ESTADO=1;
          
      END IF;
      

  END;
  
/*****************************************************************
'* Nombre           :  SCOB_SP_I_MULTA_CERO
'* Parámetros       :  PI_VC_CUM: Numero CUM  de la multa
'*                     PI_NU_TIPO_MULTA: Id del tipo de Multa
'*                     PI_NU_ESTADO_MULTA: Id del estado de la multa a crear
'*                     PI_NU_MOTIVO_MULTA: Id del motivo de la multa a crear
'*                     PI_DT_FECHA_ESTADO: Fecha del estado de la multa
                       PI_VC_USUARIO_LOGIN: Usuario que realiza la multa cero
'* Propósito        :  Generar multa cero
'* Output           :  PO_NU_RETORNO: 1: Ok
'*                     PO_NU_COD_ERROR : Codigo 0: Grabo OK
'*                     PO_VC_MSJ_ERROR : Mensaje
'* Creado por       :  HCHALCO
'* Fec Creación     :  2021-08-05 17:06:00
'* Fec Actualización:  2023-02-03 18:56:00 se agrega llamada para ejecucion de proceso en linea para el SIA
'****************************************************************/
  PROCEDURE SCOB_SP_I_MULTA_CERO   
    (
      PI_VC_CUM   IN VARCHAR2,
      PI_NU_TIPO_MULTA         IN NUMBER,
      PI_NU_ESTADO_MULTA         IN NUMBER,
      PI_NU_MOTIVO_MULTA         IN NUMBER,
      PI_DT_FECHA_ESTADO       IN VARCHAR2,
      PI_VC_USUARIO_LOGIN      IN VARCHAR2,
      
      PO_NU_RETORNO            OUT NUMBER,
      PO_NU_COD_ERROR          OUT NUMBER,
      PO_VC_MSJ_ERROR          OUT VARCHAR2
    )
    AS
      V_NU_ID_MULTA NUMBER;
      V_NU_ID_MULTA_DETAL NUMBER;
      V_NU_EXISTE  NUMBER;
      V_COD_INTERNO VARCHAR2(20);
    BEGIN
      DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>');
      -- MULTA CERO PARA EXPEDIENTE - PODER JUDICIAL
      SELECT MU.ID_MULTA INTO V_NU_ID_MULTA
      FROM USR_SICOB.T_SCOB_MULTA MU
      WHERE MU.ANIO || MU.CUM = PI_VC_CUM
      AND MU.Estado = 1;
      DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_VC_CUM>>' || PI_VC_CUM);
      SELECT COUNT(MU.ID_MULTA) INTO V_NU_EXISTE
        FROM USR_SICOB.T_SCOB_MULTA MU
       INNER JOIN USR_SICOB.T_SCOB_MULTA_ESTADO ME
          ON (MU.ID_MULTA = ME.ID_MULTA)
       WHERE MU.ID_MULTA = V_NU_ID_MULTA
         AND ME.ESTADO = 1
         AND ME.NU_ID_TIPO_MULTAC IN (1, 2);
      DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>V_NU_EXISTE>>' || V_NU_EXISTE);   
     --Evaluamos si la multa ya tiene  registrado Multa Cero
     IF V_NU_EXISTE>0 THEN
          PO_NU_COD_ERROR := 0;
          PO_NU_RETORNO   := 2;
          PO_VC_MSJ_ERROR := 'Esta multa ya tiene registrado una Multa Cero';
     ELSE
       BEGIN
         -- UPDATE DE MONTOS MULTA CERO
         -- INSERTS
         UPDATE USR_SICOB.T_SCOB_MULTA
            SET MONTO_UIT                = 0,
                MONTO_COSTAS             = 0,
                MONTO_TOTAL_DEUDA        = 0,
                TOTAL_AMORTIZADO         = 0,
                TOTAL_AMORTIZADO_COSTAS  = 0,
                TOTAL_AMORTIZACION_DEUDA = 0,
                SALDO                    = 0,
                SALDO_COSTAS             = 0,
                SALDO_TOTAL_DEUDA        = 0,
                COD_ESTADO_PAGO          = 3,
                AUDUSUMODIFICACION       = PI_VC_USUARIO_LOGIN,
                AUDFECMODIFICACION       = SYSDATE
          WHERE ID_MULTA = V_NU_ID_MULTA;
          DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>U T_SCOB_MULTA');   
         UPDATE USR_SICOB.T_SCOB_MULTA_DETAL
            SET VALOR_UIT          = 0,
                MONTO_UIT          = 0,
                AUDUSUMODIFICACION = PI_VC_USUARIO_LOGIN,
                AUDFECMODIFICACION = SYSDATE
          WHERE ESTADO = 1
            AND FLG_ACTUAL = 1
            AND ID_MULTA = V_NU_ID_MULTA;
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>U T_SCOB_MULTA_DETAL'); 
         SELECT MD.ID_MULTA_DETAL INTO V_NU_ID_MULTA_DETAL
           FROM USR_SICOB.T_SCOB_MULTA_DETAL MD
          WHERE MD.ID_MULTA = V_NU_ID_MULTA
            AND MD.ESTADO = 1
            AND MD.FLG_ACTUAL = 1;
        DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>V_NU_ID_MULTA_DETAL>>' || V_NU_ID_MULTA_DETAL); 
        
         -- INSERT ESTADO DE MULTA COBRANZA
         /*DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>V_NU_ID_MULTA>>' || V_NU_ID_MULTA); 
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>V_NU_ID_MULTA_DETAL>>' || V_NU_ID_MULTA_DETAL); 
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_NU_ESTADO_MULTA>>' || PI_NU_ESTADO_MULTA); 
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_VC_USUARIO_LOGIN>>' || PI_VC_USUARIO_LOGIN); 
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_DT_FECHA_ESTADO>>' || PI_DT_FECHA_ESTADO); 
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_NU_MOTIVO_MULTA>>' || PI_NU_MOTIVO_MULTA); 
         DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_NU_TIPO_MULTA>>' || PI_NU_TIPO_MULTA); */
         INSERT INTO USR_SICOB.T_SCOB_MULTA_ESTADO
           (ID_MULTA_ESTADO,
            ID_MULTA,
            ID_MULTA_DETAL,
            ESTADO_MULTA,
            ESTADO,
            AUDFECCREACION,
            AUDUSUCREACION,
            FEC_ESTADO_MULTA,
            COD_MOTIVO,
            NU_ID_TIPO_MULTAC)
         VALUES
           (USR_SICOB.SCOB_SQ_MULTA_ESTADO.NEXTVAL,
            V_NU_ID_MULTA,
            V_NU_ID_MULTA_DETAL,
            PI_NU_ESTADO_MULTA,
            '1',
            SYSDATE,
            PI_VC_USUARIO_LOGIN,
            TO_DATE(PI_DT_FECHA_ESTADO, 'DD/MM/YYYY'),
            PI_NU_MOTIVO_MULTA,
            PI_NU_TIPO_MULTA
            );
            --DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>PI_NU_ESTADO_MULTA>>' || PI_NU_ESTADO_MULTA); 
          UPDATE USR_SICOB.T_SCOB_MULTA MULT
             SET MULT.ESTADO_MULTA     = PI_NU_ESTADO_MULTA,
                 MULT.FEC_ESTADO_MULTA = TO_DATE(PI_DT_FECHA_ESTADO,'DD/MM/YYYY'),
                 COD_MOTIVO            = PI_NU_MOTIVO_MULTA
           WHERE MULT.ID_MULTA = V_NU_ID_MULTA;
        
         --DBMS_OUTPUT.PUT_LINE('SCOB_SP_I_MULTA_CERO>>V_NU_ID_MULTA>>' || V_NU_ID_MULTA);
         
         --INICIO VICTOR BENDEZU - MIGRACION SICOB A SIA
          USR_SIA_INTFZ.PKG_INTFZ_REG_MULTA_SICOB_SIA.SP_U_MULTA_SICOB_A_SIA(PIN_NU_ID_MULTA => V_NU_ID_MULTA,
                                                                             POUT_NU_COD_RESULT => PO_NU_RETORNO,
                                                                             POUT_VC_MSG_RESULT => PO_VC_MSJ_ERROR);
          IF PO_NU_RETORNO < 0 THEN
             ROLLBACK;
             RETURN;
          END IF;
          USR_SICOB.PKG_RECAUDACION_BANCOS.SP_DO_GRABAR_BN(PIN_NU_ID_MULTA => V_NU_ID_MULTA,
                                     POUT_NU_COD_RESULT => PO_NU_RETORNO,
                                     POUT_VC_MSG_RESULT => PO_VC_MSJ_ERROR);
          IF PO_NU_RETORNO < 0 THEN
             ROLLBACK;
             RETURN;
          END IF;
          USR_SICOB.PKG_RECAUDACION_BANCOS.SP_DO_GRABAR_ASBANC(PIN_NU_ID_MULTA => V_NU_ID_MULTA,
                                           POUT_NU_COD_RESULT => PO_NU_RETORNO,
                                           POUT_VC_MSG_RESULT => PO_VC_MSJ_ERROR);
          IF PO_NU_RETORNO < 0 THEN
             ROLLBACK;
             RETURN;
          END IF;    
          --FIN VICTOR BENDEZU - MIGRACION SICOB A SIA
            
          PO_NU_COD_ERROR := 0;
          PO_NU_RETORNO   := 1;
       END;
     END IF;
     
   EXCEPTION
    WHEN OTHERS THEN
      PO_NU_RETORNO   := -1;
      PO_NU_COD_ERROR := SQLCODE;
      SELECT CASE
               WHEN PO_NU_COD_ERROR > 0 THEN
                PO_NU_COD_ERROR * -1
               ELSE
                PO_NU_COD_ERROR
             END
        INTO PO_NU_COD_ERROR
        FROM DUAL;
      PO_VC_MSJ_ERROR := SUBSTR(SQLERRM, 1, 250);
      ROLLBACK;
   END;
   
   PROCEDURE SCOB_SP_S_MULTA_CERO
    /*
        -----------------------------------------------------------
        -- Autor        : HCHALCO
        -- Creado       : 10.08.2021
        -- Proposito    : Consulta para Multa CERO
        -----------------------------------------------------------
        -- Modificacion :
        -- Autor        :
        -- Modificado   :
        -- Proposito    :
        -----------------------------------------------------------
        */
    (PI_V_CUM               IN VARCHAR2,
     PO_CU_RETORNO          OUT CU_REC_SET
     
     ) AS
    BEGIN 
       
        OPEN PO_CU_RETORNO FOR
            SELECT DISTINCT '0' AS SEM_ASIG_MULTA,
                            MULT.FEC_ESTADO_MULTA AS FEC_ULT_ESTADO_MULTA,
                            MULT.ID_MULTA AS ID_MULTA,
                            MDET.ID_MULTA_DETAL AS ID_MULTA_DETAL,
                            NVL(MCOB.ID_MULTA_COBRANZA, 0) AS ID_MULTA_COBRANZA,
                            NVL(MULT.FLG_MULTA_COBRANZA, '0') AS IND_COBRANZA,
                            NVL(MULT.FLG_MULTA_IMPROCEDENCIA, '0') AS IND_IMPROCEDENCIA,
                            ---
                            ORGR.TIPO_INSTANCIA AS TIPO_INSTANCIA_ACTUAL,
                            MULT.ANIO || MULT.CUM AS COD_MULTA,
                            MDET.ID_ORGANO_RESOLUTIVO AS COD_ORG_RESOLUTIVO,
                            ORGR.DESCRIPCION AS NOM_ORG_RESOLUTIVO,
                            MCOB.FECHA_VALIDACION AS FEC_VALIDACION,
                            MULT.NRO_ULT_IMPROCEDENCIA AS NRO_IMPROCEDENCIA,
                            DECODE(NVL(MULT.NRO_ULT_IMPROCEDENCIA, '0'), '0', 'NO', 'SI') AS NOM_IND_IMPROCEDENCIA,

                            trunc(mimp.audfeccreacion) as FEC_IMPROCEDENCIA,
                            MCOB.NRO_INGRESO AS NRO_INGRESO_AEC, --COLUMNA: NºINGRESO
                            MCOB.FECHA_INGRESO AS FEC_INGRESO_AEC, --COLUMNA: FEC.INGRESO
                            MULT.ID_MATERIA AS COD_MATERIA,
                            MATE.DESCRIPCION AS NOM_MATERIA,
                            MDET.NRO_RESOLUCION AS NRO_RESOLUCION,
                            MDET.FEC_RESOLUCION AS FEC_RESOLUCION,
                            DECODE(MULT.FLG_TIPO_MULTA, SCOB_PK_CONSTANTES.C_FLG_TIPO_MULTA_SOLID, ' ', PERS.COD_SANCIONADO) AS COD_SANCIONADO,
                            DECODE(MULT.FLG_TIPO_MULTA,
                                   SCOB_PK_CONSTANTES.C_FLG_TIPO_MULTA_SOLID,
                                   SCOB_PK_EXPEDIENTE.SCOB_FN_SANCIONADOS_MULTA(MULT.ID_MULTA, 0),
                                   DECODE(PERS.TIPO_PERSONA,
                                          SCOB_PK_CONSTANTES.C_TIPO_PERS_JURIDICA,
                                          PERS.RAZON_SOCIAL,
                                          PERS.APE_PATERNO || ' ' || PERS.APE_MATERNO || ' ' || PERS.PRI_NOMBRE || ' ' || PERS.SEG_NOMBRE || ' ' ||
                                          PERS.APE_CASADA)) AS DES_SANCIONADO,
                            
                            --DATOS ANTIDUMPING
                            DECODE(NVL(MUAN.NRO_LIQUIDACION_CODIGO, ' '),
                                   ' ',
                                   NULL,
                                   MUAN.NRO_LIQUIDACION_CODIGO || '-' || MUAN.NRO_LIQUIDACION_ANIO || '/' || MUAN.NRO_LIQUIDACION_CORRELATIVO) AS NRO_LIQUIDACION,
                            
                            --------------------------------------------------------------------------------------
                            --montos deuda antidumping
                            MUAN.TIPO_CAMBIO       AS TIPO_CAMBIO,
                            MUAN.MONTO_ANTIDUMPING AS MONTO_ANTIDUMPING,
                            --1=Multa OR 0=Multa Antidumping
                            DECODE(MULT.FLG_MULTA_RESOLUTIVO, '1', NULL, MUAN.MONTO_INTERES) AS MONTO_DA_INTERES_COMPENSATORIO, --MUAN.MONTO_INTERES AS MONTO_DA_INTERES_COMPENSATORIO,
                            DECODE(MULT.FLG_MULTA_RESOLUTIVO, '1', NULL, MUAN.MONTO_INTERES_MORATORIO) AS MONTO_DA_INTERES_MORATORIO, --MUAN.MONTO_INTERES_MORATORIO AS MONTO_DA_INTERES_MORATORIO,
                            MUAN.MONTO_TOTAL AS MONTO_TOTAL_DEUDA_DA,
                            
                            --montos deuda uit
                            MDET.VALOR_UIT               AS UIT,
                            MULT.MONTO_UIT               AS MONTO_UIT,
                            MULT.MONTO_INTERES           AS MONTO_IC,
                            MULT.MONTO_INTERES_MORATORIO AS MONTO_IM,
                            MULT.MONTO_COSTAS            AS MONTO_COSTAS,
                            MULT.MONTO_TOTAL_DEUDA       AS MONTO_TOTAL_DEUDA,
                            
                            --montos amortizado
                            CASE
                                WHEN MULT.COD_ESTADO_PAGO = SCOB_PK_CONSTANTES.C_EST_PAGO_DSCTO THEN
                                 0.00
                                ELSE
                                 MULT.TOTAL_AMORTIZADO
                            END AS MONTO_AMORTIZACION, --amortizado_uit
                            CASE
                                WHEN MULT.COD_ESTADO_PAGO = SCOB_PK_CONSTANTES.C_EST_PAGO_DSCTO THEN
                                 DECODE(MULT.IND_DESCUENTO, '1', MULT.MONTO_PORCENTAJE_DSCTO, 0.00)
                                ELSE
                                 0.00
                            END AS MONTO_AMORTIZADO_DSCTO,
                            MULT.TOTAL_AMORTIZADO_IC AS MONTO_AMORTIZADO_IC,
                            MULT.TOTAL_AMORTIZADO_IM AS MONTO_AMORTIZADO_IM,
                            MULT.TOTAL_AMORTIZADO_COSTAS AS MONTO_AMORTIZADO_COSTAS,
                            MULT.TOTAL_AMORTIZACION_DEUDA AS MONTO_TOTAL_AMORTIZADO,
                            
                            --montos saldo
                            MULT.SALDO             AS MONTO_SALDO, --uit
                            MULT.SALDO_IC          AS SALDO_IC,
                            MULT.SALDO_IM          AS SALDO_IM,
                            MULT.SALDO_COSTAS      AS SALDO_COSTAS,
                            MULT.SALDO_TOTAL_DEUDA AS SALDO_TOTAL,
                            --------------------------------------------------------------------------------------
                            
                            VALI.USUARIO             AS NOM_VALIDADO_POR,
                            ASIG.USUARIO             AS NOM_ASIGNADO_A,
                            MULT.FECHA_ASIG_COBRANZA AS FEC_ASIGNADO_A,
                            MULT.ESTADO_MULTA        AS COD_ESTADO,

                            SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MIMP.ESTADO_MULTA) AS DES_ESTADO,
                            
                            LTRIM(RTRIM(MULT.FLG_TIPO_MULTA)) AS IND_RESPONSABILIDAD,
                            MRES.TXT_DESCRIPCION AS DES_RESPONSABILIDAD,
                            MDET.FEC_NOTIFICACION_RESOLUCION AS FEC_NOTIF,
                            MIMP.COD_MOTIVO AS COD_MOTIVO,
                            MOTI.DESCRIPCION AS NOM_MOTIVO,
                            MIMP.AUDUSUCREACION AS NOM_OBSERVADO_POR,
                            MULT.COD_ESTADO_PAGO AS COD_ESTADO_PAGO,
                            SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_EST_PAGOS, MULT.COD_ESTADO_PAGO) AS NOM_ESTADO_PAGO,
                            ' ' AS VER_MEMO,
                            MULT.FLG_ENVIO_RIESGO AS FLG_ENVIO_RIESGO,
                            MULT.FEC_ENVIO_RIESGO AS FEC_ENVIO_RIESGO,
                            MULT.FLG_MULTA_RESOLUTIVO AS IND_TIPO_MULTA, --1=MULTA OR;0=ANTIDUMPING
                            MULT.FEC_GENERACION_SEC AS FEC_GENERACION_SEC,
                            -------------NRO FILE-----------------------------------------------------
                            MULT.ANIO_FILE_AEC    AS ANIO_FILE, --ANIO
                            ACOB.CODIGO           AS COD_AREA_COB, --COD AREA
                            MULT.NRO_FILE_AEC     AS NRO_FILE, --CORRELATIVO  --COLUMNA: NºFILE (LOS 3 CAMPOS)
                            MULT.FEC_INGRESO_FILE AS FEC_INGRESO_FILE, --COLUMNA: FEC. INGRESO FILE
                            ---------------------------------------------------------------------------
                            EXPE.ID_EXPEDIENTE AS ID_EXPEDIENTE,
                            CASE
                                WHEN EXPE.ID_EXPEDIENTE IS NOT NULL THEN
                                 EST_EXP.DESCRIPCION
                                ELSE
                                  -- INI TK76845@JCARRION
                                  --SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MULT.ESTADO_MULTA)
                                 SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES(SCOB_PK_CONSTANTES.C_TBL_ESTADO_MULTA, MIMP.ESTADO_MULTA)
                                 -- FIN TK76845@JCARRION
                            END AS ESTADO_MULTA_EXPEDIENTE,
                            
                            CASE
                                WHEN MULT.COD_ESTADO_PAGO = 3 OR
                                     MULT.COD_ESTADO_PAGO = 4 THEN --TOTAL O DESCUENTO
                                 '0' -- VALOR ANTERIOR: 1 cambio JCARRION@20161025
                                WHEN (MULT.ESTADO_MULTA <> SCOB_PK_CONSTANTES.C_TBL_EST_MUL_NO_INICIADO) AND
                                     (MULT.ESTADO_MULTA <> SCOB_PK_CONSTANTES.C_TBL_EST_COB_TRAMITE_COB) THEN
                                 '2'
                                ELSE
                                 '0'
                            END AS IND_HABILITA,
                            MULT.TIPO_INSTANCIA_INICIA AS TIPO_INSTANCIA_INICIA
              FROM T_SCOB_MULTA MULT
            
             INNER JOIN T_SCOB_MULTA_DETAL MDET
                ON MDET.ID_MULTA = MULT.ID_MULTA
               AND MDET.FLG_ACTUAL = '1'
            
              LEFT JOIN T_SCOB_MULTA_ANTIDUMPING MUAN
                ON MUAN.ID_MULTA = MULT.ID_MULTA
            
             INNER JOIN T_SCOB_MULTA_COBRANZA MCOB
                ON MCOB.ID_MULTA = MULT.ID_MULTA
               AND MCOB.FLG_ACTUAL = '1'
               AND MCOB.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
              LEFT JOIN usr_sicob.T_SCOB_MULTA_IMPROCEDENCIA MIMP
                ON MIMP.ID_MULTA_COBRANZA = MCOB.ID_MULTA_COBRANZA
            
              LEFT JOIN T_SCOB_EST_MUL_COB_MOTIVO MOTI
                ON MOTI.ID_MOTIVO = MIMP.COD_MOTIVO
            
             INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
                ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
            
             INNER JOIN T_SCOB_MATERIA MATE
                ON MATE.ID_MATERIA = MULT.ID_MATERIA
            
             INNER JOIN T_SCOB_MULTA_SANCIONADO SANC
                ON SANC.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
               AND SANC.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND NVL(SANC.COD_TIPO_PERSONA, '1') = '1'
            
             INNER JOIN T_SCOB_PERSONA PERS
                ON PERS.ID_PERSONA = SANC.ID_PERSONA
               AND PERS.COD_SANCIONADO IS NOT NULL
            
              LEFT JOIN T_SCOB_PERSONA_DOMICILIO PDOM
                ON PDOM.ID_PERSONA = PERS.ID_PERSONA
               AND PDOM.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
              LEFT JOIN T_SCOB_MULTA_SANCIONADO_DIREC SDIR
                ON SDIR.ID_MULTA_SANCIONADO = SANC.ID_MULTA_SANCIONADO
               AND SDIR.ID_PERSONA_DOMICILIO = PDOM.ID_PERSONA_DOMICILIO
               AND SDIR.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
            
             INNER JOIN T_SCOB_TABLA_DET MRES --TIPO DE MULTA (SOLIDARIA?).
                ON MRES.ID_TABLA = SCOB_PK_CONSTANTES.C_TBL_TIPO_RESP_MULTA_OR
               AND LTRIM(RTRIM(MRES.COD_INTERNO)) = LTRIM(RTRIM(MULT.FLG_TIPO_MULTA))
            
              LEFT JOIN T_SCOB_UBIGEO UBIG
                ON UBIG.ID_UBIGEO = PDOM.ID_UBIGEO
            
              LEFT JOIN T_SCOB_USUARIO ASIG
                ON ASIG.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
            
              LEFT JOIN T_SCOB_USUARIO VALI
                ON VALI.ID_USUARIO = MCOB.ID_USUARIO_VALIDACION
            
              LEFT JOIN T_SCOB_EXPEDIENTE_MULTA EXMU
                ON EXMU.ID_MULTA = MULT.ID_MULTA
               AND EXMU.ESTADO = '1'
            
              LEFT JOIN T_SCOB_EXPEDIENTE EXPE
                ON EXPE.ID_EXPEDIENTE = EXMU.ID_EXPEDIENTE
            
              LEFT JOIN T_SCOB_EST_EXP_COB EST_EXP
                ON EST_EXP.ID_EST_EXP_COB = EXPE.ESTADO_EXPEDIENTE
              LEFT JOIN T_SCOB_AREA_COBRANZA ACOB
                ON ACOB.ID_AREA_COBRANZA = MULT.ID_AREA_COBRANZA
             WHERE MULT.ESTADO = SCOB_PK_CONSTANTES.C_ESTADO_ACTIVO
               AND (NVL(PI_V_CUM, ' ') = ' ' OR (NVL(PI_V_CUM, ' ') <> ' ' AND MULT.ANIO || TRIM(MULT.CUM) LIKE '%' || TRIM(PI_V_CUM) || '%'))
               AND MULT.ESTADO = 1
            ;
    
    END;
    
procedure scob_sp_s_multa_avanzada_aec(
-----------------------------------------------------------------------------------------------
/*001*/   pi_v_area_macro                        in varchar2      --AREA MACRO
/*002*/  ,pi_v_cum_ini                           in varchar2      --cum
/*003*/  ,pi_v_cum_fin                           in varchar2      --cum
/*004*/  ,pi_v_fec_gen_cum_ini                   in varchar2      --FECHA GENERACION CUM INI
/*005*/  ,pi_v_fec_gen_cum_fin                   in varchar2      --FECHA GENERACION CUM FIN
/*006*/  ,pi_v_id_sede                           in varchar2      --sede
/*007*/  ,PI_V_ID_COD_DPTO_SEDE                  in VARCHAR2      --CODIGO DEPARTAMENTO SEDE
/*008*/  ,PI_V_ID_COD_PROV_SEDE                  in VARCHAR2      --CODIGO PROVINCIA SEDE
/*009*/  ,PI_V_ID_COD_DIST_SEDE                  in VARCHAR2      --CODIGO DISTRITO SEDE
/*010*/  ,pi_v_id_org_resol                      in varchar2      --organo resolutivo
/*011*/  ,PI_V_ID_COD_DPTO_ORGR                  in VARCHAR2      --CODIGO DEPARTAMENTO ORGANO RESOLUTIVO
/*012*/  ,PI_V_ID_COD_PROV_ORGR                  in VARCHAR2      --CODIGO PROVINCIA ORGANO RESOLUTIVO
/*013*/  ,PI_V_ID_COD_DIST_ORGR                  in VARCHAR2      --CODIGO DISTRITO ORGANO RESOLUTIVO
/*014*/  ,PI_V_ID_NRO_INSTANCIA                  in VARCHAR2      --NUMERO DE INSTANCIA
/*015*/  ,pi_v_id_materia                        in varchar2      --materia
/*016*/  ,pi_v_id_sub_materia                    in varchar2      --SUBMATERIA
/*017*/  ,pi_v_nro_exp_unico_ini                 in varchar2      --nro. expediente administrativo
/*018*/  ,pi_v_nro_exp_unico_fin                 in varchar2      --nro. expediente administrativo
/*019*/  ,pi_v_nroExpAdm_nivel                   in varchar2      --nro. expediente antiguo
/*020*/  ,pi_v_nro_resol                         in varchar2      --nro. resolucion or
/*021*/  ,pi_v_fec_reso_or_ini                   in varchar2      --FECHA RESOLUCION OR INI
/*022*/  ,pi_v_fec_reso_or_fin                   in varchar2      --FECHA RESOLUCION OR FIN
/*023*/  ,pi_v_fec_notifi_or_ini                 in varchar2      --FECHA NOTIFICACION RESOLUCION INI
/*024*/  ,pi_v_fec_notifi_or_fin                 in varchar2      --FECHA NOTIFICACION RESOLUCION FIN
/*025*/  ,PI_V_FEC_GENERACION_SEC_INI            in VARCHAR2      --FECHA GENERACION SEC
/*026*/  ,PI_V_FEC_GENERACION_SEC_FIN            in VARCHAR2      --FECHA GENERACION SEC
---
/*027*/  ,pi_v_fec_recepcion_aec_ini             in varchar2      --FECHA RECEPCION AEC INICIO
/*028*/  ,pi_v_fec_recepcion_aec_fin             in varchar2      --FECHA RECEPCION AEC FIN
/*029*/  ,PI_V_ANIO_INGRESO_AEC_INI              in varchar2      --AÑO INGRESO AL AEC INI
/*030*/  ,PI_V_ANIO_INGRESO_AEC_FIN              in varchar2      --AÑO INGRESO AL AEC FIN
/*031*/  ,PI_V_NRO_INGRESO_AEC_INI               in varchar2      --nro. ingreso aec
/*032*/  ,PI_V_NRO_INGRESO_AEC_FIN               in varchar2      --nro. ingreso aec
---
/*033*/  ,PI_V_ANIO_FILE_INI                     in varchar2      --AÑO FILE INI
/*034*/  ,PI_V_ANIO_FILE_FIN                     in varchar2      --AÑO FILE FIN
/*035*/  ,PI_V_NRO_FILE_INI                      in varchar2      --nro. file
/*036*/  ,PI_V_NRO_FILE_FIN                      in varchar2      --nro. file
/*037*/  ,pi_v_fec_recepcion_file_ini            in varchar2      --FECHA RECEPCION FILE INICIO
/*038*/  ,pi_v_fec_recepcion_file_fin            in varchar2      --FECHA RECEPCION FILE FIN
---
/*039*/  ,pi_n_valor_uit_ini                     in number        --nro uit ini
/*040*/  ,pi_n_valor_uit_fin                     in number        --nro uit fin
/*041*/  ,pi_n_monto_uit_ini                     in NUMBER        --MONTO UIT INI
/*042*/  ,pi_n_monto_uit_fin                     in NUMBER        --MONTO UIT FIN
/*043*/  ,pi_n_saldo_ini                         in NUMBER        --SALDO UIT INI
/*044*/  ,pi_n_saldo_fin                         in NUMBER        --SALDO UIT FIN
/*045*/  ,pi_v_id_tipo_multa                     in varchar2      --TIPO MULTA (SOLIDARIA/INDIVIDUAL)
/*046*/  ,pi_v_cod_estado_multa_resol            in varchar2      --estado de la multa resolutivo
/*047*/  ,pi_v_cod_estado_pago                   in varchar2      --estado pago de la multa
/*048*/  ,PI_V_FEC_ESTADO_MULTA_OR_INI           in VARCHAR2      --FECHA ESTADO MULTA OR INI
/*049*/  ,PI_V_FEC_ESTADO_MULTA_OR_FIN           in VARCHAR2      --FECHA ESTADO MULTA OR FIN
/*050*/  ,PI_V_FEC_ESTADO_MULTA_COB_INI          in VARCHAR2      --FECHA ESTADO MULTA COBRANZA
/*051*/  ,PI_V_FEC_ESTADO_MULTA_COB_FIN          in VARCHAR2      --FECHA ESTADO MULTA COBRANZA
/*052*/  ,pi_v_cod_estado_multa_cob              in varchar2      --estado de la multa cobranza
/*053*/  ,pi_v_cod_motivo_multa_cob              in varchar2      --motivo multa cobranza
/*054*/  ,PI_V_IND_TIPO_PAGO                     in VARCHAR2      --INDICADOR DE PAGO
/*055*/  ,pi_c_flg_asocu_multa                   IN CHAR         --INDICADOR % ASOCU > 0
-----------------------------------------------------------------------------------------------
/*056*/  ,pi_v_cod_estado_exped_cob              in varchar2      --estado expediente cobranza
/*057*/  ,pi_v_anio                              in varchar2      --año expediente cobranza
/*058*/  ,pi_v_nro_exp_cob_ini                   in varchar2      --nro. expediente cobranza
/*059*/  ,pi_v_nro_exp_cob_fin                   in varchar2      --nro. expediente cobranza
/*060*/  ,pi_v_fec_gen_exped_cob_ini             in varchar2      --FECHA GENERACION EXPED COBRANZA INI
/*061*/  ,pi_v_fec_gen_exped_cob_fin             in varchar2      --FECHA GENERACION EXPED COBRANZA FIN
-------
/*062*/  ,pi_v_gestor_cobranza                   in varchar2      --Gestor de cobranza
/*063*/  ,pi_v_fec_emi_rec_ini                   in varchar2      --Fecha de Emisión de la REC
/*064*/  ,pi_v_fec_emi_rec_fin                   in varchar2      --Fecha de Emisión de la REC
/*065*/  ,pi_v_fec_noti_rec_ini                  in varchar2      --Fecha de Notificación de la REC
/*066*/  ,pi_v_fec_noti_rec_fin                  in varchar2      --Fecha de Notificación de la REC
/*067*/  ,pi_v_cod_motivo_exped_cob              in varchar2      --motivo expediente cobranza---------
/*068*/  ,pi_v_fec_est_exped_cob_ini             in varchar2      --Fecha de Estado del Expediente
/*069*/  ,pi_v_fec_est_exped_cob_fin             in varchar2      --Fecha de Estado del Expediente
/*070*/  ,pi_v_num_env_arch_ini                  in varchar2      --Nº Envio a Archivo Central
/*071*/  ,pi_v_num_env_arch_fin                  in varchar2      --Nº Envio a Archivo Central
/*072*/  ,pi_v_fec_envi_arch_ini                 in varchar2      --Fecha de Envío a Archivo Central
/*073*/  ,pi_v_fec_envi_arch_fin                 in varchar2      --Fecha de Envío a Archivo Central
/*074*/  ,pi_v_nro_ofic_sunat_ini                in varchar2      --Nº de Oficio de la SUNAT
/*075*/  ,pi_v_nro_ofic_sunat_fin                in varchar2      --Nº de Oficio de la SUNAT
/*076*/  ,pi_n_dere_antiDump_ini                 in NUMBER        --Derechos Antidumping
/*077*/  ,pi_n_dere_antiDump_fin                 in NUMBER        --Derechos Antidumping
/*078*/  ,pi_v_nro_parti_ini                     in varchar2      --Partida Arancelaria
/*079*/  ,pi_v_nro_parti_fin                     in varchar2      --Partida Arancelaria
/*080*/  ,pi_v_nro_dua_ini                       in varchar2      --Nº DUA
/*081*/  ,pi_v_nro_dua_fin                       in varchar2      --Nº DUA
/*082*/  ,pi_v_nro_liq_cob_ini                   in varchar2      --Nº Liquidación de Cobranza
/*083*/  ,pi_v_nro_liq_cob_fin                   in varchar2      --Nº Liquidación de Cobranza
/*084*/  ,pi_v_id_intendencia                    in varchar2      --Intendencia antidumping
/*085*/  ,pi_c_flg_ind_embargo                   in char          --INDICADOR TIENE EMBARGO?
/*086*/  ,pi_v_fec_asig_gestor_ini               in varchar2      --fecha de asignacion de gestor ini
/*087*/  ,pi_v_fec_asig_gestor_fin               in varchar2      --fecha de asignacion de gestor fin
/*088*/  ,pi_v_fec_carta_precoactiva_ini         in varchar2      --fecha de carta precoactiva inicio
/*089*/  ,pi_v_fec_carta_precoactiva_fin         in varchar2      --fecha de carta precoactiva fin
/*090*/  ,pi_v_id_expectativa_cobro              in varchar2      --cadena codigos espectativa de cobro

-----------------------------------------------------------------------------------------------
        --denunciante
/*091*/  ,pi_v_d_codSanciona_ini                 in varchar2      --Código del INDECOPI
/*092*/  ,pi_v_d_codSanciona_fin                 in varchar2      --Código del INDECOPI
/*093*/  ,pi_i_d_tip_persona                     in integer       --Tipo de Personería
/*094*/  ,pi_v_d_razon_social                    in varchar2      --Razón Social
/*095*/  ,pi_v_d_ape_paterno                     in varchar2      --Apellido Paterno
/*096*/  ,pi_v_d_ape_materno                     in varchar2      --Apellido Materno
/*097*/  ,pi_v_d_ape_casada                      in varchar2      --Apellido Casada
/*098*/  ,pi_v_d_pri_nombre                      in varchar2      --Primer nombre
/*099*/  ,pi_v_d_seg_nombre                      in varchar2      --Segundo nombre
/*100*/  ,pi_i_d_tipo_doc                        in integer       --Tipo de Documento
/*101*/  ,pi_v_d_nro_doc                         in varchar2      --Nº de documento de identidad
/*102*/  ,pi_i_d_tip_empresa                     in integer       --Tipo de Empresa
/*103*/  ,pi_n_d_id_sect_econo                   in number        --CIIU (Actividad Economica)
/*104*/  ,pi_c_d_flg_asocu                       in char          --flag asocu
/*105*/  ,pi_c_d_fl_oficio                       in char          --indicador denunciante de oficio=Indecopi
        --denunciado
/*106*/  ,pi_v_do_codSanciona_ini                in varchar2      --Código del INDECOPI
/*107*/  ,pi_v_do_codSanciona_fin                in varchar2      --Código del INDECOPI
/*108*/  ,pi_i_do_tip_persona                    in integer       --Tipo de Personería
/*109*/  ,pi_v_do_razon_social                   in varchar2      --Razón Social
/*110*/  ,pi_v_do_ape_paterno                    in varchar2      --Apellido Paterno
/*111*/  ,pi_v_do_ape_materno                    in varchar2      --Apellido Materno
/*112*/  ,pi_v_do_ape_casada                     in varchar2      --Apellido Casada
/*113*/  ,pi_v_do_pri_nombre                     in varchar2      --Primer nombre
/*114*/  ,pi_v_do_seg_nombre                     in varchar2      --Segundo nombre
/*115*/  ,pi_i_do_tipo_doc                       in integer       --Tipo de Documento
/*116*/  ,pi_v_do_nro_doc                        in varchar2      --Nº de documento de identidad
/*117*/  ,pi_i_do_tip_empresa                    in integer       --Tipo de Empresa
/*118*/  ,pi_n_do_id_sect_econo                  in number        --CIIU (Actividad Economica)
/*119*/  ,pi_c_do_flg_asocu                      in char          --flag asocu
         --sancionado
/*120*/  ,pi_v_s_codSanciona_ini                 in varchar2      --Código del INDECOPI
/*121*/  ,pi_v_s_codSanciona_fin                 in varchar2      --Código del INDECOPI
/*122*/  ,pi_i_s_tip_persona                     in integer       --Tipo de Personería
/*123*/  ,pi_v_s_razon_social                    in varchar2      --Razón Social
/*124*/  ,pi_v_s_ape_paterno                     in varchar2      --Apellido Paterno
/*125*/  ,pi_v_s_ape_materno                     in varchar2      --Apellido Materno
/*126*/  ,pi_v_s_ape_casada                      in varchar2      --Apellido Casada
/*127*/  ,pi_v_s_pri_nombre                      in varchar2      --Primer nombre
/*128*/  ,pi_v_s_seg_nombre                      in varchar2      --Segundo nombre
/*129*/  ,pi_i_s_tipo_doc                        in integer       --Tipo de Documento
/*130*/  ,pi_v_s_nro_doc                         in varchar2      --Nº de documento de identidad
/*131*/  ,pi_i_s_tip_empresa                     in integer       --Tipo de Empresa
/*132*/  ,pi_n_s_id_sect_econo                   in number        --CIIU (Actividad Economica)
/*133*/  ,pi_c_s_flg_asocu                       in char           --flag asocu
--@0002:ini
/*134*/  ,pi_c_s_flg_buscar_by_contenido         in char           --0=NO;1=SI
--@0002:fin
-----------------------------------------------------------------------------------------------
         ,po_cu_retorno                          out cu_rec_set
)is

  c_flg_administrado                           char(1);
  c_flg_sancionado                             char(1);
  c_flg_denunciado                             char(1);
  c_flg_denunciante                            char(1);

  v_sql_admin_select                           varchar2(8000);
  v_sql_admin_where_d                          varchar2(8000);
  v_sql_admin_where_do                         varchar2(8000);
  v_sql_admin_where_s                          varchar2(8000);

  v_sql_select_1                               varchar2(8000);
  v_sql_select_2                               varchar2(8000);
  v_sql_select_3                               varchar2(8000);
  v_sql_select_4                               varchar2(8000);
  v_sql_select_5                               varchar2(8000);
  v_sql_join_1                                 varchar2(8000);
  v_sql_join_2                                 varchar2(8000);
  v_sql_join_3                                 varchar2(8000);
  v_sql_join_4                                 varchar2(8000);
  v_sql_join_5                                 varchar2(8000);
  v_sql_where_1                                varchar2(8000);
  v_sql_where_2                                varchar2(8000);
  v_sql_where_3                                varchar2(8000);
  v_sql_where_4                                varchar2(8000);
  v_sql_where_5                                varchar2(8000);
  v_sql_where_6                                varchar2(8000);
  v_sql_where_7                                varchar2(8000);
  v_sql_where_8                                varchar2(8000);
  v_sql_where_9                                varchar2(8000);
  v_sql_where_10                               varchar2(8000);
  v_sql_where_11                               varchar2(8000);
  v_sql_where_12                               varchar2(8000);
  c_car_porcentaje                             varchar(1);
begin
  --@0002:ini
  c_car_porcentaje := '';
  if pi_c_s_flg_buscar_by_contenido = '1' then c_car_porcentaje := '%'; end if;
  --@0002:fin

  --control del filtro sancionado
  c_flg_administrado := '0';
  c_flg_sancionado := '0';
  c_flg_denunciado := '0';
  c_flg_denunciante := '0';

  v_sql_where_1 := '';
  v_sql_where_2 := '';
  v_sql_where_3 := '';
  v_sql_where_4 := '';
  v_sql_where_5 := '';
  v_sql_where_6 := '';
  v_sql_where_7 := '';
  v_sql_where_8 := '';
  v_sql_where_9 := '';
  v_sql_where_10 := '';
  v_sql_where_11 := '';
  v_sql_where_12 := '';

  IF  pi_v_s_codSanciona_ini is not null or
      pi_v_s_codSanciona_fin is not null or
      pi_i_s_tip_persona <> 0 or
      pi_v_s_razon_social is not null or
      pi_v_s_ape_paterno is not null or
      pi_v_s_ape_materno is not null or
      pi_v_s_ape_casada is not null or
      pi_v_s_pri_nombre is not null or
      pi_v_s_seg_nombre is not null or
      pi_i_s_tipo_doc <> 0 or
      pi_v_s_nro_doc is not null or
      pi_i_s_tip_empresa <> 0 or
      pi_n_s_id_sect_econo <> 0 or
      pi_c_s_flg_asocu<>'0'
  THEN
      c_flg_sancionado := '1';
      if c_flg_administrado = '0' then c_flg_administrado := '1'; end if;
  END IF;

  IF (
      pi_v_do_codSanciona_ini is not null or
      pi_v_do_codSanciona_fin is not null or
      pi_i_do_tip_persona <> 0 or
      pi_v_do_razon_social is not null or
      pi_v_do_ape_paterno is not null or
      pi_v_do_ape_materno is not null or
      pi_v_do_ape_casada is not null or
      pi_v_do_pri_nombre is not null or
      pi_v_do_seg_nombre is not null or
      pi_i_do_tipo_doc <> 0 or
      pi_v_do_nro_doc is not null or
      pi_i_do_tip_empresa <> 0 or
      pi_n_do_id_sect_econo <> 0 or
      pi_c_do_flg_asocu<>'0'
      )
  THEN
      c_flg_denunciado := '1';
      if c_flg_administrado = '0' then c_flg_administrado := '1'; end if;
  END IF;

  IF  (
      pi_v_d_codSanciona_ini is not null or
      pi_v_d_codSanciona_fin is not null or
      pi_i_d_tip_persona <> 0 or
      pi_v_d_razon_social is not null or
      pi_v_d_ape_paterno is not null or
      pi_v_d_ape_materno is not null or
      pi_v_d_ape_casada is not null or
      pi_v_d_pri_nombre is not null or
      pi_v_d_seg_nombre is not null or
      pi_i_d_tipo_doc <> 0 or
      pi_v_d_nro_doc is not null or
      pi_i_d_tip_empresa <> 0 or
      pi_n_d_id_sect_econo <> 0 or
      pi_c_d_flg_asocu<>'0' or
      pi_c_d_fl_oficio<>'0'
      )
  THEN
      c_flg_denunciante := '1';
      if c_flg_administrado = '0' then c_flg_administrado := '1'; end if;
  END IF;

  --obtener los datos de las intancias de una multa
  EXECUTE IMMEDIATE 'TRUNCATE TABLE T_SCOB_TMP_INSTANCIAS_MULTA1';
  INSERT INTO USR_SICOB.T_SCOB_TMP_INSTANCIAS_MULTA1(
      ID_MULTA,
      NRO_NIVEL,
      NRO_RESOLUCION,
      FEC_RESOLUCION,
      FEC_NOTIFICACION_RESOLUCION,
      FEC_ESTADO_SGTE_INSTANCIA,
      FEC_REGISTRO,
      LOGIN_USUARIO_REGISTRO,
      NRO_RESOLUCION_DECLARACION,
      FEC_CONS_FIRME,
      FEC_NOTF_CONS_FIRME
      )(
        SELECT
          MDET.ID_MULTA,
          ORGR.TIPO_INSTANCIA,
          --MDET.NRO_RESOLUCION_ID,
          MDET.NRO_RESOLUCION,
          MDET.FEC_RESOLUCION,
          MDET.FEC_NOTIFICACION_RESOLUCION,
          MDET.FEC_ESTADO_SGTE_INSTANCIA,
          TO_DATE(TO_CHAR(MDET.AUDFECCREACION,'DD/MM/YYYY'),'DD/MM/YYYY'),
          MDET.AUDUSUCREACION,
          MDET.NRO_RESOLUCION_DECLARACION,
          MDET.FEC_DECLARACION AS FEC_CONS_FIRME,
          MDET.FEC_NOTIFICACION_DECLARACION AS FEC_NOTF_CONS_FIRME
        FROM T_SCOB_MULTA_DETAL MDET
        INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
              ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
        WHERE MDET.ESTADO = '1'
  );
  /*EXECUTE IMMEDIATE 'TRUNCATE TABLE T_SCOB_TMP_INSTANCIAS_MULTA';
  INSERT INTO T_SCOB_TMP_INSTANCIAS_MULTA(
      ID_MULTA,
      NRO_NIVEL,
      NRO_RESOLUCION,
      FEC_RESOLUCION,
      FEC_NOTIFICACION_RESOLUCION,
      FEC_ESTADO_SGTE_INSTANCIA,
      FEC_REGISTRO,
      LOGIN_USUARIO_REGISTRO
  )(
        SELECT
          MDET.ID_MULTA,
          ORGR.TIPO_INSTANCIA,
          --Req. 30 - @dcelis/begin
          --MDET.NRO_RESOLUCION_ID,
          MDET.NRO_RESOLUCION,
          --Req. 30 - @dcelis/end
          MDET.FEC_RESOLUCION,
          MDET.FEC_NOTIFICACION_RESOLUCION,
          MDET.FEC_ESTADO_SGTE_INSTANCIA,
          TO_DATE(TO_CHAR(MDET.AUDFECCREACION,'DD/MM/YYYY'),'DD/MM/YYYY'),
          MDET.AUDUSUCREACION
        FROM T_SCOB_MULTA_DETAL MDET
        INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
              ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
        WHERE MDET.ESTADO = '1'

  );*/

  --obtener la situacion de pago de las multas
  EXECUTE IMMEDIATE 'TRUNCATE TABLE T_SCOB_TMP_SITUACION_MULTA';
  INSERT INTO T_SCOB_TMP_SITUACION_MULTA(
     ID_MULTA,
     COD_SITUACION_MULTA
  )
  SELECT
    MULT.ID_MULTA,
    CASE
       WHEN EXPE.ESTADO_EXPEDIENTE = 4 THEN 3 --'FR'
       WHEN EXPE.ESTADO_EXPEDIENTE = 5 THEN 4 --'PP'
       WHEN MULT.NRO_FILE_AEC IS NULL THEN 1 --PAGO VOLUNTARIO
       ELSE 2 --PAGO COACTIVO
       --WHEN MULT.IND_DESCUENTO = 1 AND MULT.COD_ESTADO_PAGO IN (4) THEN 1 --'DS'
       --WHEN MULT.NRO_FILE_AEC IS NULL THEN 2 --'MU'--NO TIENE DESCUENTO Y NO HA INGRESADO A COBRANZA
       --ELSE 2--'CO'
    END AS COD_SITUACION_MULTA
  FROM T_SCOB_MULTA MULT
  LEFT JOIN T_SCOB_EXPEDIENTE_MULTA EXMU
       ON EXMU.ID_MULTA = MULT.ID_MULTA
       AND EXMU.ESTADO = '1'
  LEFT JOIN T_SCOB_EXPEDIENTE EXPE
       ON EXPE.ID_EXPEDIENTE = EXMU.ID_EXPEDIENTE
  WHERE MULT.ESTADO = '1';

  -----------------------------------------------------------------------------------
  --obtener los administrados
  -----------------------------------------------------------------------------------
  --3=DENUNCIANTE
  -----------------------------------------------------------------------------------
  /*
  Dbms_Output.put_line('c_flg_administrado--->' || c_flg_administrado);
  Dbms_Output.put_line('c_flg_denunciante--->' || c_flg_denunciante);
  Dbms_Output.put_line('c_flg_sancionado--->' || c_flg_sancionado);
  Dbms_Output.put_line('c_flg_denunciado--->' || c_flg_denunciado);
  */

  EXECUTE IMMEDIATE 'TRUNCATE TABLE T_SCOB_TMP_ADMINISTRADO';
  --obtener a todos los administrados
  if c_flg_administrado = '1' then

      v_sql_admin_select := '
      INSERT INTO T_SCOB_TMP_ADMINISTRADO(
          ID_MULTA, TIPO_ADMINISTRADO, ID_PERSONA
      )
      SELECT
          ADMINISTRADO.ID_MULTA,ADMINISTRADO.TIPO_ADMINISTRADO,PERS.ID_PERSONA
      FROM (
          SELECT MDET.ID_MULTA AS ID_MULTA, ''3'' AS TIPO_ADMINISTRADO, --DENUNCIANTE
                 MDEN.ID_PERSONA  AS ID_PERSONA
          FROM T_SCOB_MULTA_DETAL MDET
          INNER JOIN T_SCOB_MULTA_DENUNCIANTE MDEN
                ON MDEN.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
                AND MDEN.ESTADO = ''1''
          WHERE MDET.FLG_ACTUAL = ''1'' AND MDET.ESTADO = ''1''
          UNION ALL
          SELECT MDET.ID_MULTA AS ID_MULTA, MSAN.COD_TIPO_PERSONA AS TIPO_ADMINISTRADO, --SANCIONADO Y DENUNCIADO
                 MSAN.ID_PERSONA AS ID_PERSONA
          FROM T_SCOB_MULTA_DETAL MDET
          INNER JOIN T_SCOB_MULTA_SANCIONADO MSAN
                ON MSAN.ID_MULTA_DETAL = MDET.ID_MULTA_DETAL
                AND MSAN.ESTADO = ''1''
          WHERE MDET.FLG_ACTUAL = ''1'' AND MDET.ESTADO = ''1''
      )ADMINISTRADO
      INNER JOIN T_SCOB_PERSONA PERS ON PERS.ID_PERSONA = ADMINISTRADO.ID_PERSONA
      ';

      v_sql_admin_where_d := '
      WHERE ADMINISTRADO.ID_MULTA IS NOT NULL ';

      IF c_flg_denunciante = '1' THEN

      v_sql_admin_where_d := v_sql_admin_where_d ||
      '
      AND (ADMINISTRADO.TIPO_ADMINISTRADO = ''3'' --denunciante
      ';

          --CODIGO INDECOPI
          if pi_v_d_codSanciona_ini is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND TO_NUMBER(PERS.COD_SANCIONADO) BETWEEN TO_NUMBER('||pi_v_d_codSanciona_ini||') AND TO_NUMBER('||pi_v_d_codSanciona_fin||')'
             ;

          end if;

          --TIPO PERSONERIA
          if pi_i_d_tip_persona<>0 then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.TIPO_PERSONA='||pi_i_d_tip_persona
             ;
          end if;

          --TIPO DOCUMENTO
          if pi_i_d_tipo_doc<>0 then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.TIPO_DOC='||pi_i_d_tipo_doc
             ;
          end if;

          --NRO DOCUMENTO
          if pi_v_d_nro_doc is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.NRO_DOC='''||pi_v_d_nro_doc||''''
             ;
          end if;

          --APELLIDOS Y NOMBRES
          if pi_v_d_ape_paterno is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.APE_PATERNO LIKE '''||c_car_porcentaje||pi_v_d_ape_paterno||'%'''
             ;
          end if;

          if pi_v_d_ape_materno is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.APE_MATERNO LIKE '''||c_car_porcentaje||pi_v_d_ape_materno||'%'''
             ;
          end if;

          if pi_v_d_ape_casada is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.APE_CASADA LIKE '''||c_car_porcentaje||pi_v_d_ape_casada||'%'''
             ;
          end if;

          if pi_v_d_pri_nombre is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.PRI_NOMBRE LIKE '''||c_car_porcentaje||pi_v_d_pri_nombre||'%'''
             ;
          end if;

          if pi_v_d_seg_nombre is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.SEG_NOMBRE LIKE '''||c_car_porcentaje||pi_v_d_seg_nombre||'%'''
             ;
          end if;

          --DENOMINACION O RAZON SOCIAL
          if pi_v_d_razon_social is not null then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.RAZON_SOCIAL LIKE '''||c_car_porcentaje||pi_v_d_razon_social ||'%'''
             ;
          end if;

          --TIPO DE EMPRESA
          if pi_i_d_tip_empresa<>0 then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.TIP_EMPRESA=' ||pi_i_d_tip_empresa
             ;
          end if;

          --SECTOR ECONOMICO
          if pi_n_d_id_sect_econo<>0 then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.ID_SECTOR_ECONOMICO='||pi_n_d_id_sect_econo
             ;
          end if;

          --INDICADOR DENUNCIANTE DE OFICIO = INDECOPI
          if pi_c_d_fl_oficio='1' then
             v_sql_admin_where_d := v_sql_admin_where_d ||
             '
             AND PERS.ID_PERSONA='||SCOB_PK_CONSTANTES.C_ID_ADMINISTRADO_INDECOPI;
          end if;




      v_sql_admin_where_d := v_sql_admin_where_d || '
      )';

      END IF;

      IF c_flg_denunciado = '1' THEN
          if  c_flg_denunciante = '1' then
              v_sql_admin_where_do :=
              '
              OR(ADMINISTRADO.TIPO_ADMINISTRADO = ''2'' --denunciado';
          else
              v_sql_admin_where_do :=
              '
              AND(ADMINISTRADO.TIPO_ADMINISTRADO = ''2'' --denunciado';
          end if;

          --CODIGO INDECOPI
          if pi_v_d_codSanciona_ini is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND TO_NUMBER(PERS.COD_SANCIONADO) BETWEEN TO_NUMBER('||pi_v_do_codSanciona_ini||') AND TO_NUMBER('||pi_v_do_codSanciona_fin||')'
             ;
          end if;

          --TIPO PERSONERIA
          if pi_i_do_tip_persona<>0 then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.TIPO_PERSONA='||pi_i_do_tip_persona
             ;
          end if;

          --TIPO DOCUMENTO
          if pi_i_do_tipo_doc<>0 then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.TIPO_DOC='||pi_i_do_tipo_doc
             ;
          end if;

          --NRO DOCUMENTO
          if pi_v_do_nro_doc is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.NRO_DOC='''||pi_v_do_nro_doc||''''
             ;
          end if;

          --APELLIDOS Y NOMBRES
          if pi_v_do_ape_paterno is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.APE_PATERNO LIKE '''||c_car_porcentaje||pi_v_do_ape_paterno||'%'''
             ;
          end if;

          if pi_v_do_ape_materno is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.APE_MATERNO LIKE '''||c_car_porcentaje||pi_v_do_ape_materno||'%'''
             ;
          end if;

          if pi_v_do_ape_casada is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.APE_CASADA LIKE '''||c_car_porcentaje||pi_v_do_ape_casada||'%'''
             ;
          end if;

          if pi_v_do_pri_nombre is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.PRI_NOMBRE LIKE '''||c_car_porcentaje||pi_v_do_pri_nombre||'%'''
             ;
          end if;

          if pi_v_do_seg_nombre is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.SEG_NOMBRE LIKE '''||c_car_porcentaje||pi_v_do_seg_nombre||'%'''
             ;
          end if;

          --DENOMINACION O RAZON SOCIAL
          if pi_v_do_razon_social is not null then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.RAZON_SOCIAL LIKE '''||c_car_porcentaje||pi_v_do_razon_social ||'%'''
             ;
          end if;

          --TIPO DE EMPRESA
          if pi_i_do_tip_empresa<>0 then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.TIP_EMPRESA=' ||pi_i_do_tip_empresa
             ;
          end if;

          --SECTOR ECONOMICO
          if pi_n_do_id_sect_econo<>0 then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.ID_SECTOR_ECONOMICO='||pi_n_do_id_sect_econo
             ;
          end if;

          if pi_c_do_flg_asocu='1' then
             v_sql_admin_where_do := v_sql_admin_where_do ||
             '
             AND PERS.FLG_ASOCU='''||pi_c_do_flg_asocu||''''
             ;
          end if;

          v_sql_admin_where_do := v_sql_admin_where_do ||'
          )';
      END IF;

      IF c_flg_sancionado = '1' THEN
          if  c_flg_denunciado = '1' or c_flg_denunciante = '1' then
              v_sql_admin_where_s :=
              '
              OR(ADMINISTRADO.TIPO_ADMINISTRADO = ''1'' --sancionado';
          else
              v_sql_admin_where_s :=
              '
              AND(ADMINISTRADO.TIPO_ADMINISTRADO = ''1'' --sancionado';
          end if;

          --CODIGO INDECOPI
          if pi_v_s_codSanciona_ini is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND TO_NUMBER(PERS.COD_SANCIONADO) BETWEEN TO_NUMBER('||pi_v_s_codSanciona_ini||') AND TO_NUMBER('||pi_v_s_codSanciona_fin||')'
             ;
          end if;

          --TIPO PERSONERIA
          if pi_i_s_tip_persona<>0 then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.TIPO_PERSONA='||pi_i_s_tip_persona
             ;
          end if;

          --TIPO DOCUMENTO
          if pi_i_s_tipo_doc<>0 then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.TIPO_DOC='||pi_i_s_tipo_doc
             ;
          end if;

          --NRO DOCUMENTO
          if pi_v_s_nro_doc is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.NRO_DOC='''||pi_v_s_nro_doc||''''
             ;
          end if;

          --APELLIDOS Y NOMBRES
          if pi_v_s_ape_paterno is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.APE_PATERNO LIKE '''||c_car_porcentaje||pi_v_s_ape_paterno||'%'''
             ;
          end if;

          if pi_v_s_ape_materno is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.APE_MATERNO LIKE '''||c_car_porcentaje||pi_v_s_ape_materno||'%'''
             ;
          end if;

          if pi_v_s_ape_casada is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.APE_CASADA LIKE '''||c_car_porcentaje||pi_v_s_ape_casada||'%'''
             ;
          end if;

          if pi_v_s_pri_nombre is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.PRI_NOMBRE LIKE '''||c_car_porcentaje||pi_v_s_pri_nombre||'%'''
             ;
          end if;

          if pi_v_s_seg_nombre is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.SEG_NOMBRE LIKE '''||c_car_porcentaje||pi_v_s_seg_nombre||'%'''
             ;
          end if;

          --DENOMINACION O RAZON SOCIAL
          if pi_v_s_razon_social is not null then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.RAZON_SOCIAL LIKE '''||c_car_porcentaje||pi_v_s_razon_social ||'%'''
             ;
          end if;

          --TIPO DE EMPRESA
          if pi_i_s_tip_empresa<>0 then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.TIP_EMPRESA=' ||pi_i_s_tip_empresa
             ;
          end if;

          --SECTOR ECONOMICO
          if pi_n_s_id_sect_econo<>0 then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.ID_SECTOR_ECONOMICO='||pi_n_s_id_sect_econo
             ;
          end if;

          if pi_c_s_flg_asocu='1' then
             v_sql_admin_where_s := v_sql_admin_where_s ||
             '
             AND PERS.FLG_ASOCU='''||pi_c_s_flg_asocu||''''
             ;
          end if;

          v_sql_admin_where_s := v_sql_admin_where_s ||'
          )';
      END IF;

      DBMS_OUTPUT.put_line(v_sql_admin_select);
      DBMS_OUTPUT.put_line(v_sql_admin_where_d);
      DBMS_OUTPUT.put_line(v_sql_admin_where_do);
      DBMS_OUTPUT.put_line(v_sql_admin_where_s);

      EXECUTE IMMEDIATE v_sql_admin_select || v_sql_admin_where_d || v_sql_admin_where_do || v_sql_admin_where_s;

  end if;

  IF c_flg_administrado = '0' THEN
      INSERT INTO T_SCOB_TMP_ADMINISTRADO(ID_MULTA)
      VALUES('0');
  END IF;


  --mostrar los datos de la consulta
  v_sql_select_1 := '
  SELECT
    ROWNUM AS NRO_REG,
    MULT.ID_MULTA AS ID_MULTA,
    MULT.ANIO || MULT.CUM AS CUM,

  
  

    MULT.FEC_INGRESO AS FEC_GENERACION_CUM,
    TIPO_PROC.DESCRIPCION AS NOM_TIPO_PROCEDEMIENTO,
    ORGR.CODIGO AS COD_ORGANO_RESOLUTIVO,
    ORGR.DESCRIPCION AS NOM_ORGANO_RESOLUTIVO,
    SEDE.CODIGO AS COD_SEDE,
    SEDE.DESCRIPCION AS NOM_SEDE,
    MATE.DESCRIPCION AS NOM_MATERIA,
    SUBM.DESCRIPCION AS NOM_SUB_MATERIA,
    MULT.NRO_EXP_ADMINISTRATIVO AS NRO_EXPEDIENTE_UNICO,
    MDET.NRO_EXP_NIVEL AS NRO_EXPEDIENTE_ADMINISTRATIVO,
    --PRIMERA INSTANCIA
    NIVEL1.NRO_RESOLUCION AS NRO_RESOL_OR, --num_resolu
    NIVEL1.FEC_REGISTRO AS FEC_REG_OR,
    NIVEL1.FEC_RESOLUCION AS FEC_EMI_RESOL_OR, --fec_emision
    NIVEL1.FEC_NOTIFICACION_RESOLUCION AS FEC_NOTIF_RESOL_OR, --fec_notifica
    NIVEL1.FEC_ESTADO_SGTE_INSTANCIA AS FEC_APELACION,
    NIVEL1.LOGIN_USUARIO_REGISTRO AS USU_REG_OR,

  
  
    scob_pk_utilitario.scob_fn_dias_laborables_neg(to_char(NIVEL1.FEC_RESOLUCION,''DD/MM/YYYY''),to_char(NIVEL1.FEC_REGISTRO,''DD/MM/YYYY'')) AS CANTIDAD_OR,';
  v_sql_select_2 :=
    '--SEGUNDA INSTANCIA
    NIVEL2.NRO_RESOLUCION AS NRO_RESOL_COMISION,
    NIVEL2.FEC_REGISTRO AS FEC_REG_COMISION,
    NIVEL2.FEC_RESOLUCION AS FEC_RESOL_COMISION,
    NIVEL2.FEC_NOTIFICACION_RESOLUCION AS FEC_NOTIF_RESOL_COMISION,
    NIVEL2.FEC_ESTADO_SGTE_INSTANCIA AS FEC_REVISION,
    NIVEL2.LOGIN_USUARIO_REGISTRO AS USU_REG_COMISION,

  
  
    scob_pk_utilitario.scob_fn_dias_laborables_neg(to_char(NIVEL2.FEC_RESOLUCION,''DD/MM/YYYY''),to_char(NIVEL2.FEC_REGISTRO,''DD/MM/YYYY'')) AS CANTIDAD_COMISION,
    --TERCERA INSTANCIA
    NIVEL3.NRO_RESOLUCION AS NRO_RESOL_SALA,
    NIVEL3.FEC_REGISTRO AS FEC_REG_SALA,
    NIVEL3.FEC_RESOLUCION  AS FEC_RESOL_SALA,
    NIVEL3.FEC_NOTIFICACION_RESOLUCION AS FEC_NOTIF_RESOL_SALA,
    NIVEL3.LOGIN_USUARIO_REGISTRO AS USU_REG_SALA,

  
    scob_pk_utilitario.scob_fn_dias_laborables_neg(to_char(NIVEL3.FEC_RESOLUCION,''DD/MM/YYYY''),to_char(NIVEL3.FEC_REGISTRO,''DD/MM/YYYY'')) AS CANTIDAD_SALA,
    ------------------------------------------------------
    ';
  v_sql_select_3 :=
    'TIPO_MULTA.TXT_DESCRIPCION AS NOM_TIPO_MULTA, --tipo_multa
    scob_pk_expediente.SCOB_FN_DENUNCIANTES_MULTA(mdet.id_multa,0) AS NOM_DENUNCIANTE, --denunciante
    scob_pk_expediente.SCOB_FN_DENUNCIADOS_MULTA(mdet.id_multa,0) AS NOM_DENUNCIADO, --denunciado
    scob_pk_expediente.SCOB_FN_SANCIONADOS_MULTA(mdet.id_multa,0) AS NOM_SANCIONADO, --sancionado
    scob_pk_expediente.SCOB_FN_SANCIONADOS_TIPO_DOC(mdet.id_multa,0) AS NOM_TIPO_DOC_SANCIONADO,
    scob_pk_expediente.SCOB_FN_SANCIONADOS_NRO_DOC(mdet.id_multa,0) AS NRO_TIPO_DOC_SANCIONADO,
    scob_pk_expediente.SCOB_FN_SANCIONADOS_COD_INDEC(mdet.id_multa,0) AS COD_INDECOPI_SANCIONADO,
    scob_pk_expediente.SCOB_FN_SANCIONADOS_CLAS_INDEC(mdet.id_multa,0) AS CLASIF_SANCIONADO,
    scob_pk_expediente.SCOB_FN_SANCIONADOS_CIIU(mult.id_multa,0) CIIU_SANCIONADO, --act_economica
    DECODE(NVL(MDET.POR_ASOCU,''0''),''0'',''No'',''Si'') AS IND_ASOCU,
    NVL(MDET.POR_ASOCU,0) AS PORCENTAJE_ASOCU,
    --CAMPOS ANTIDUMPING
    MUAN.TIPO_CAMBIO AS TIPO_CAMBIO_DA,
    MUAN.MONTO_ANTIDUMPING AS DERECHO_ANTIDUMPING,
    MUAN.MONTO_INTERES AS MONTO_DA_IC,
    MUAN.MONTO_INTERES_MORATORIO AS MONTO_DA_IM,
    --
    MUAN.NRO_OFICIO_SUNAT_CODIGO || MUAN.NRO_OFICIO_SUNAT_ANIO || MUAN.NRO_OFICIO_SUNAT_PREFIJO || MUAN.NRO_OFICIO_SUNAT_CORRELATIVO AS NRO_OFICIO_SUNAT,
    NRO_LIQUIDACION_CODIGO ||NRO_LIQUIDACION_ANIO || NRO_LIQUIDACION_CORRELATIVO AS NRO_LIQUIDACION_COBRANZA,
    PART.CODIGO AS COD_PARTIDA,
    PART.DESCRIPCION AS NOM_PARTIDA,
    --NO EXISTE EL CAMPO MEMO EN LA INTERFAZ DE ANTIDUMPING
    NRO_DUA_CODIGO || NRO_DUA_ANIO || NRO_DUA_CORRELATIVO AS NRO_DUA,
    MUAN.ID_INTENDENCIA AS COD_INTENDENCIA,
    INTE.DESCRIPCION AS NOM_INTENDENCIA,

    --DECODE(MUAN.NRO_LIQUIDACION_CODIGO,NULL,'''',MUAN.NRO_LIQUIDACION_CODIGO ||''-''|| MUAN.NRO_LIQUIDACION_ANIO ||''/''|| MUAN.NRO_LIQUIDACION_CORRELATIVO) AS NRO_LIQUIDACION_COBRANZA2,
    DECODE(MATE.CODIGO,11,DECODE(SUBM.CODIGO,21,MUAN.NRO_LIQUIDACION_CODIGO ||''-''|| MUAN.NRO_LIQUIDACION_ANIO ||''/''|| MUAN.NRO_LIQUIDACION_CORRELATIVO,''''),'''') AS NRO_LIQUIDACION_COBRANZA2,
    DECODE(MATE.CODIGO,11,DECODE(SUBM.CODIGO,21,TO_CHAR(NIVEL2.FEC_NOTIFICACION_RESOLUCION,''DD/MM/YYYY''),''''),'''') AS FECH_NOT_SUNAT,
    --'''' AS FECH_NOT_SUNAT,
    --MUAN.MONTO_ANTIDUMPING AS MONTO_ANTIDUMPING,
    DECODE(MATE.CODIGO,11,DECODE(SUBM.CODIGO,21,MUAN.NRO_DUA_CODIGO ||''-''|| MUAN.NRO_DUA_ANIO ||''-''|| MUAN.NRO_DUA_CORRELATIVO,''''),'''') AS NRO_DUA2,
    --DECODE(MUAN.NRO_DUA_CODIGO,NULL,'''',MUAN.NRO_DUA_CODIGO ||''-''|| MUAN.NRO_DUA_ANIO ||''-''|| MUAN.NRO_DUA_CORRELATIVO) AS NRO_DUA2,
    DECODE(MATE.CODIGO,11,DECODE(SUBM.CODIGO,21,PART.CODIGO||''-''||PART.DESCRIPCION,''''),'''') AS NOM_PARTIDA2,
    --PART.CODIGO||''-''||PART.DESCRIPCION AS NOM_PARTIDA2,
    --INTE.DESCRIPCION AS DESC_INTENDENCIA,
    --FIN CAMPOS ANTIDUMPING
    -----------------------------------
  ';
  v_sql_select_4 :=
   'NVL(MDET.VALOR_UIT,0) AS VALOR_UIT,
    MULT.MONTO_UIT AS MONTO_UIT,
    MULT.MONTO_INTERES AS MONTO_IC,
    MULT.MONTO_INTERES_MORATORIO AS MONTO_INTERES_IM,
    MULT.MONTO_COSTAS AS MONTO_COSTAS,
    --
    MULT.TOTAL_AMORTIZADO AS TOTAL_AMORTIZADO,
    MULT.TOTAL_AMORTIZADO_IC AS TOTAL_AMORTIZADO_IC,
    MULT.TOTAL_AMORTIZADO_IM AS TOTAL_AMORTIZADO_IM,
    MULT.TOTAL_AMORTIZADO_COSTAS AS TOTAL_AMORTIZADO_COSTAS,
    --
    MULT.SALDO AS SALDO, --saldo_capital
    MULT.SALDO_IC AS SALDO_IC,
    MULT.SALDO_IM AS SALDO_IM,
    MULT.SALDO_COSTAS AS SALDO_COSTAS,
    EST_MULTA_OR.TXT_DESCRIPCION AS NOM_ESTADO_MULTA_OR, --est_multa_resolu
    EST_DEUDA.TXT_DESCRIPCION AS NOM_ESTADO_PAGO, --est_pago_multa
    DECODE(MULT.COD_ESTADO_PAGO,''4'',MULT.PORCENTAJE_DESCUENTO,NULL) AS POR_DSCTO_PAGO, --porcen_dscto_pago
    MULT.FEC_GENERACION_SEC AS FEC_GENERACION_SEC, --fec_gene_sec
    MULT.ANIO_FILE_AEC AS ANIO_FILE_AEC, --anio_file
    MULT.FEC_INGRESO_AEC AS FEC_RECEPCION_FILE,
    ARCO.CODIGO || MULT.NRO_FILE_AEC AS NRO_FILE_AEC, --nro_file

  
  
  

    MCOB.NRO_INGRESO AS NRO_INGRESO_AEC,
    EST_MULTA_COB.TXT_DESCRIPCION AS NOM_ESTADO_MULTA_COB,
    DECODE(MOTIVO_MULT.ID_MOTIVO,0,NULL,MOTIVO_MULT.DESCRIPCION) AS NOM_MOTIVO_MULTA, --moti_multacobra
    MULT.FEC_ULT_IMPROCEDENCIA AS FEC_ULT_OBSERVACION_AEC,
  ';
  v_sql_select_5 :=
    'MULT.FEC_INGRESO_FILE  AS FEC_ULT_INGRESO_AEC,
    EXPE.ANIO||EXPE.NRO_EXPEDIENTE AS NRO_EXPED_COB, --nro_expe_cobranza
    EXPE.FEC_INGRESO AS FEC_GENERACION_EXPED_COB, --fec_gen_exp_cobran
    USUA.USUARIO AS USU_GESTOR_COBRANZA, --gestor_cobranza
    MULT.FECHA_ASIG_COBRANZA AS FEC_ASIG_GESTOR_COBRANZA,
    MULT.FEC_ULT_GEN_PRECOACTIVA AS FEC_ULT_GEN_PRECOACTIVA,
    MULT.FEC_EMISION_REC AS FEC_EMISION_REC, --fec_emision_REC
    MULT.FEC_NOTIF_REC AS FEC_NOTIF_REC, --fec_notifi_REC
    DECODE(NVL(EXPE.FLG_EMBARGO,''0''),''0'',''No'', ''Si'') AS IND_EMBARGO,
    EST_EXP.DESCRIPCION AS NOM_ESTADO_EXPED_COB, --est_exp_cobranza
    MOTIVO_EXPE.DESCRIPCION AS NOM_MOTIVO_EXPED_COB, --moti_exp_cobranza
    EXPE.FEC_ESTADO_EXPEDIENTE AS FEC_ULT_ESTADO_EXPED_COB, --fec_est_exp_cobran
    SCOB_PK_UTILITARIO.SCOB_FN_TABLA_DET_DES('||SCOB_PK_CONSTANTES.C_TBL_ESPECTATIVA_COBRO_EXPCOB||',EXPE.COD_EXPECTATIVA_COBRO) AS NOM_EXPECTATIVA_COBRO,
    scob_pk_expediente.SCOB_FN_SANCIONADOS_REGION(mdet.id_multa,0) AS REGION_SANCIONADO,

    DECODE(EXPE.ID_EXPEDIENTE,NULL,MULT.FEC_ENVIO_RIESGO,MULT.FEC_ENVIO_RIESGO_EXP) AS FEC_MARCA_ENVIO_INFOCORP, --(FECHA EN QUE "MARCA" PARA ENVIAR A INFOCORP)
    ARCH_CEN.NRO_ORDEN AS NRO_ENVIO_ARCHIVO, --nro_envarch_central
    ARCH_CEN.FEC_ENVIO AS FEC_ENVIO_ARCHIVO, --fec_envarch_central
    (CASE
      WHEN MULT.ESTADO_ENVIO_ARCHIVO = 2 THEN ''ARCHIVO CENTRAL''
      WHEN MULT.ESTADO_MULTA IN (9,10,11,12,13) THEN ''AEC''
      ELSE '' '' END) AS UBI_FISICA_EXPEDIENTE,
    SIT_MULTA.COD_SITUACION_MULTA AS COD_SITUACION_MULTA,

    TIPO_PROC.Codigo   AS vc_cod_tipoproc,
    MATE.CODIGO        AS VC_COD_MATERIA,
    SUBM.CODIGO        AS VC_COD_SUBMATERIA,
    EST_MULTA_OR.COD_INTERNO  AS VC_COD_EST_MULTA,
    EST_DEUDA.COD_INTERNO     AS VC_COD_EST_PAGO,
    EST_MULTA_COB.COD_INTERNO AS VC_COD_EST_MULTA_COB,
    EST_EXP.CODIGO            AS VC_CODIGO_EST_EXP,
    MOTIVO_EXPE.CODIGO        AS VC_COD_MOTIVO_EXPED_COB,
    NULL               AS VC_CODIGO_CLASIFICACION,
    NULL               AS VC_CODIGO_CIIU,
    (CASE WHEN EXPE.ESTADO_EXPEDIENTE = 4 THEN
     ''FR'' ELSE ''NF'' END) AS VC_TIPO_MULTA,
    scob_pk_consulta.fn_getReso_gaf_aprueba(EXPE.id_expediente) AS vc_reso_gaf_APRUEBA,
    scob_pk_consulta.fn_getFecReso_gaf_aprueba(EXPE.id_expediente) AS vc_FEC_reso_gaf_APRUEBA,
    scob_pk_consulta.fn_getReso_gaf_perdida(EXPE.id_expediente) AS vc_reso_gaf_PERDIDA,
    scob_pk_consulta.fn_getFecReso_gaf_perdida(EXPE.id_expediente) AS vc_FEC_reso_gaf_PERDIDA,
    scob_pk_consulta.SCOB_FN_COD_DENUNCIANTES_MULTA(mdet.id_multa,0) AS VC_NRO_DOC_DENUNCIANTE,
    DECODE(MULT.COD_MOTIVO, 0, NULL, MULT.COD_MOTIVO) AS VC_COD_MOTIVO_MULTA_COB,
    scob_pk_consulta.SCOB_FN_CENTRO_DE_COSTO(MULT.ID_MULTA) AS VC_COD_CENTRO_COSTO, 

    NULL AS VC_NRO_REC_DECLA_01,
    NULL AS DT_RES_CONS_FIRME_01,
    NULL AS DT_NOTF_CONS_FIRME_01,
    NULL AS VC_NRO_REC_DECLA_02,
    NULL AS DT_RES_CONS_FIRME_02,
    NULL AS DT_NOTF_CONS_FIRME_02,
    NULL AS VC_NRO_REC_DECLA_03,
    NULL AS DT_RES_CONS_FIRME_03,
    NULL AS DT_NOTF_CONS_FIRME_03,

  
    NULL AS V_ACUM, 
    NULL AS ES_ACUM,
    NULL AS ID_EXPEDIENTE,
    NULL AS UIT_NIVEL1,
    NULL AS FEC_DECLARACION_NIVEL1,
    NULL AS F_REGISTRO_NIVEL1,
    NULL AS UIT_NIVEL2,
    NULL AS FEC_DECLARACION_NIVEL2,
    NULL AS F_REGISTRO_NIVEL2,
    NULL AS UIT_NIVEL3,
    NULL AS F_REGISTRO_NIVEL3,
  NULL AS NRO_FILE_CUM_ALFA ';
  --JOINS
  v_sql_join_1 := '
  FROM T_SCOB_MULTA MULT
  INNER JOIN T_SCOB_MULTA_DETAL MDET
       ON MDET.ID_MULTA = MULT.ID_MULTA
       AND MDET.FLG_ACTUAL = ''1''
       AND MDET.ESTADO = ''1''
  INNER JOIN (
    SELECT DISTINCT ID_MULTA AS ID_MULTA
    FROM T_SCOB_TMP_ADMINISTRADO
  ) ADMINISTRADO
  ON (
     ('||c_flg_administrado||' = ''0'' AND ''0''=ADMINISTRADO.ID_MULTA)OR
     ('||c_flg_administrado||' <> ''0'' AND ADMINISTRADO.ID_MULTA = MULT.ID_MULTA)
  )
  INNER JOIN T_SCOB_TMP_SITUACION_MULTA SIT_MULTA
        ON SIT_MULTA.ID_MULTA = MULT.ID_MULTA
  INNER JOIN T_SCOB_MATERIA MATE
       ON MATE.ID_MATERIA = MULT.ID_MATERIA
  INNER JOIN T_SCOB_TIPO_PROCEDIMIENTO TIPO_PROC
       ON TIPO_PROC.ID_TIPO_PROCEDIMIENTO = MATE.ID_TIPO_PROCEDIMIENTO
  INNER JOIN T_SCOB_SUBMATERIA SUBM
       ON SUBM.ID_SUBMATERIA = MULT.ID_SUB_MATERIA
  INNER JOIN T_SCOB_ORGANO_RESOLUTIVO ORGR
       ON ORGR.ID_ORGANO_RESOLUTIVO = MDET.ID_ORGANO_RESOLUTIVO
  INNER JOIN T_SCOB_UBIGEO UBIG_ORGR
       ON UBIG_ORGR.COD_DPTO = ORGR.COD_DPTO
       AND UBIG_ORGR.COD_PROV = ORGR.COD_PROV
       AND UBIG_ORGR.COD_DIST = ORGR.COD_DIST
  INNER JOIN T_SCOB_SEDE SEDE
       ON SEDE.ID_SEDE = MULT.ID_SEDE
  INNER JOIN T_SCOB_UBIGEO UBIG_SEDE
       ON UBIG_SEDE.COD_DPTO = SEDE.COD_DPTO
       AND UBIG_SEDE.COD_PROV = SEDE.COD_PROV
       AND UBIG_SEDE.COD_DIST = SEDE.COD_DIST
  INNER JOIN T_SCOB_TABLA_DET TIPO_MULTA
        ON TIPO_MULTA.ID_TABLA = 45 --TIPO MULTA
        AND TO_NUMBER(TIPO_MULTA.COD_INTERNO) = TO_NUMBER(MULT.FLG_TIPO_MULTA)
  INNER JOIN T_SCOB_TABLA_DET EST_DEUDA
        ON EST_DEUDA.ID_TABLA = 34 --ESTADO DEUDA PAGO
        AND TO_NUMBER(EST_DEUDA.COD_INTERNO) = MULT.COD_ESTADO_PAGO';

  v_sql_join_2 := '
  LEFT JOIN T_SCOB_TABLA_DET EST_MULTA_OR
        ON EST_MULTA_OR.ID_TABLA = 5 --ESTADO MULTA OR
        AND TO_NUMBER(EST_MULTA_OR.COD_INTERNO) = MDET.ESTADO_MULTA
        AND TO_NUMBER(EST_MULTA_OR.TXT_VALOR1) = 1
  LEFT JOIN T_SCOB_TABLA_DET EST_MULTA_COB
       ON EST_MULTA_COB.ID_TABLA = 5 --ESTADO MULTA COBRANZA
       AND TO_NUMBER(EST_MULTA_COB.COD_INTERNO) = MULT.ESTADO_MULTA
       AND TO_NUMBER(EST_MULTA_COB.TXT_VALOR1) = 2
  LEFT JOIN T_SCOB_AREA_COBRANZA ARCO
       ON ARCO.ID_AREA_COBRANZA = MULT.ID_AREA_COBRANZA
  LEFT JOIN T_SCOB_USUARIO USUA
       ON USUA.ID_USUARIO = MULT.ID_USUARIO_ASIG_COBRANZA
  ------------------------------------------------------------------------------
  ---INSTANCIAS
  LEFT JOIN T_SCOB_TMP_INSTANCIAS_MULTA1 NIVEL1
       ON NIVEL1.NRO_NIVEL = '||SCOB_PK_CONSTANTES.C_TBL_TIPO_INSTANCIA_AUTO||'
       AND NIVEL1.ID_MULTA = MULT.ID_MULTA
  LEFT JOIN T_SCOB_TMP_INSTANCIAS_MULTA1 NIVEL2
       ON NIVEL2.NRO_NIVEL = '||SCOB_PK_CONSTANTES.C_TBL_TIPO_INSTANCIA_COMI||'
       AND NIVEL2.ID_MULTA = MULT.ID_MULTA
  LEFT JOIN T_SCOB_TMP_INSTANCIAS_MULTA1 NIVEL3
       ON NIVEL3.NRO_NIVEL = '||SCOB_PK_CONSTANTES.C_TBL_TIPO_INSTANCIA_SALA||'
       AND NIVEL3.ID_MULTA = MULT.ID_MULTA
  ------------------------------------------------------------------------------
  LEFT JOIN T_SCOB_MULTA_COBRANZA MCOB
       ON MCOB.ID_MULTA = MULT.ID_MULTA
       AND MCOB.FLG_ACTUAL = ''1''
       AND MCOB.ESTADO = ''1''';

  v_sql_join_3 := '
  LEFT JOIN T_SCOB_EST_MUL_COB_MOTIVO MOTIVO_MULT --motivo multa cobranza
       ON MOTIVO_MULT.ID_MOTIVO = MULT.COD_MOTIVO
  LEFT JOIN T_SCOB_EXPEDIENTE_MULTA EXMU
       ON EXMU.ID_MULTA = MULT.ID_MULTA
       AND EXMU.ESTADO = ''1''
  LEFT JOIN T_SCOB_EXPEDIENTE EXPE
       ON EXPE.ID_EXPEDIENTE = EXMU.ID_EXPEDIENTE
       AND EXPE.ESTADO = ''1''
  LEFT JOIN T_SCOB_EST_EXP_COB EST_EXP
       ON EST_EXP.ID_EST_EXP_COB = EXPE.ESTADO_EXPEDIENTE
  LEFT JOIN T_SCOB_EST_EXP_COB_MOTIVO MOTIVO_EXPE --motivo estado expediente
       ON MOTIVO_EXPE.ID_MOTIVO = EXPE.ID_MOTIVO
  LEFT JOIN T_SCOB_MULTA_ANTIDUMPING MUAN
       ON MUAN.ID_MULTA = MULT.ID_MULTA
       AND MUAN.ESTADO = ''1''
  LEFT JOIN T_SCOB_INTENDENCIA INTE
       ON INTE.ID_INTENDENCIA = MUAN.ID_INTENDENCIA
  LEFT JOIN T_SCOB_PARTIDA PART
       ON PART.ID_PARTIDA = MUAN.ID_PARTIDA';

  v_sql_join_4 := '
  LEFT JOIN T_SCOB_MULTA_ARCHIVO_CENTRAL EXPED_ARCH_CEN
       ON EXPED_ARCH_CEN.ID_MULTA = MULT.ID_MULTA
       AND EXPED_ARCH_CEN.FLG_ACTUAL = ''1''
       AND EXPED_ARCH_CEN.ESTADO = ''1''
  LEFT JOIN T_SCOB_ARCHIVO_CENTRAL ARCH_CEN
       ON ARCH_CEN.ID_ARCHIVO_CENTRAL = EXPED_ARCH_CEN.ID_MULTA_ARCHIVO_CENTRAL
       AND ARCH_CEN.ESTADO = ''1''';

  v_sql_where_1 := v_sql_where_1 || '
  WHERE MULT.ESTADO = ''1''';

  ---------------------------------------------------------------------------
  -- FILTROS MULTA
  ---------------------------------------------------------------------------
  --AREA MACRO
  if pi_v_area_macro is not null then
     v_sql_where_1 := v_sql_where_1 || '
     AND INSTR('''||pi_v_area_macro||''',''|'' || TO_CHAR(TIPO_PROC.ID_TIPO_PROCEDIMIENTO) || ''|'' )>0';
  end if;

  --CODIGO MULTA
  if pi_v_cum_ini is not null then
     v_sql_where_1 := v_sql_where_1 || '
     AND MULT.ANIO||MULT.CUM BETWEEN '''||pi_v_cum_ini||''' AND '''||pi_v_cum_fin|| '''';
  end if;

  --FECHA GENERACION MULTA
  if pi_v_fec_gen_cum_ini is not null then
     v_sql_where_1 := v_sql_where_1 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_INGRESO,''DD/MM/YYYY''),''DD/MM/YYYY'')
     BETWEEN TO_DATE('''||pi_v_fec_gen_cum_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_gen_cum_fin||''',''DD/MM/YYYY'')
     ';
  end if;

  --SEDE
  if pi_v_id_sede is not null then
     v_sql_where_1 := v_sql_where_1 || '
     AND INSTR('''||pi_v_id_sede||''',''|'' || TO_CHAR(MULT.ID_SEDE) || ''|'' )>0';
  end if;

  --UBIGEO SEDE
  if PI_V_ID_COD_DPTO_SEDE is not null then
     v_sql_where_1 := v_sql_where_1 || '
     AND SEDE.COD_DPTO='''||PI_V_ID_COD_DPTO_SEDE||'''';
  end if;

  if PI_V_ID_COD_PROV_SEDE is not null then
     v_sql_where_2 := v_sql_where_2 || '
     AND SEDE.COD_PROV='''||PI_V_ID_COD_PROV_SEDE||'''';
  end if;

  if PI_V_ID_COD_DIST_SEDE is not null then
     v_sql_where_2 := v_sql_where_2 || '
     AND SEDE.COD_DIST='''||PI_V_ID_COD_DIST_SEDE||'''';
  end if;

  --ORGANO RESOLUTIVO
  if pi_v_id_org_resol is not null then
     v_sql_where_2 := v_sql_where_2 || '
     AND INSTR('''||pi_v_id_org_resol||''',''|'' || TO_CHAR(MDET.ID_ORGANO_RESOLUTIVO) || ''|'' )>0';
  end if;

  --UBIGEO ORGANO RESOLUTIVO
  if PI_V_ID_COD_DPTO_ORGR is not null then
     v_sql_where_2 := v_sql_where_2 || '
     AND ORGR.COD_DPTO='''||PI_V_ID_COD_DPTO_ORGR||'''';
  end if;

  if PI_V_ID_COD_PROV_ORGR is not null then
     v_sql_where_2 := v_sql_where_2 || '
     AND ORGR.COD_PROV='''||PI_V_ID_COD_PROV_ORGR||'''';
  end if;
  if PI_V_ID_COD_DIST_ORGR is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND ORGR.COD_DIST='''||PI_V_ID_COD_DIST_ORGR||'''';
  end if;

  --TIPO INSTANCIA
  if PI_V_ID_NRO_INSTANCIA is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND INSTR('''||PI_V_ID_NRO_INSTANCIA||''',''|'' || TO_CHAR(ORGR.TIPO_INSTANCIA) || ''|'' )>0';
  end if;

  --MATERIA
  if pi_v_id_materia is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND INSTR('''||pi_v_id_materia||''',''|'' || TO_CHAR(MULT.ID_MATERIA) || ''|'' )>0';
  end if;

  --SUBMATERIA
  if pi_v_id_sub_materia is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND INSTR('''||pi_v_id_sub_materia||''',''|'' || TO_CHAR(MULT.ID_SUB_MATERIA) || ''|'' )>0';
  end if;

  --NUMERO EXPEDIENTE UNICO
  if pi_v_nro_exp_unico_ini is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND TO_NUMBER(MULT.NRO_EXPED_UNICO) --@0001
        BETWEEN '''||pi_v_nro_exp_unico_ini||''' and '''||pi_v_nro_exp_unico_fin||'''';
  end if;

  --NUMERO EXPEDIENTE ADMINISTRATIVO
  if pi_v_nroExpAdm_nivel is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND MDET.NRO_EXP_NIVEL LIKE '''|| pi_v_nroExpAdm_nivel ||'%''';
  end if;

  --NRO RESOLUCION OR
  if pi_v_nro_resol is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND NIVEL1.NRO_RESOLUCION LIKE '''|| pi_v_nro_resol || '%''';
  end if;

  --FECHA RESOLUCION OR
  if pi_v_fec_reso_or_ini is not null then
     v_sql_where_3 := v_sql_where_3 || '
     AND TO_DATE(TO_CHAR(MDET.FEC_RESOLUCION,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_reso_or_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_reso_or_fin||''',''DD/MM/YYYY'')';
  end if;

  --FECHA NOTIFICACION RESOLUCION OR
  if pi_v_fec_notifi_or_ini is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND TO_DATE(TO_CHAR(MDET.FEC_NOTIFICACION_RESOLUCION,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_notifi_or_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_notifi_or_fin||''',''DD/MM/YYYY'')';
  end if;

  --FECHA GENERACION DE LA SEC
  if PI_V_FEC_GENERACION_SEC_INI is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_GENERACION_SEC,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||PI_V_FEC_GENERACION_SEC_INI||''',''DD/MM/YYYY'') AND TO_DATE('''||PI_V_FEC_GENERACION_SEC_FIN||''',''DD/MM/YYYY'')';
  end if;

  --FECHA INGRESO AL AEC
  if pi_v_fec_recepcion_aec_ini is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_INGRESO_FILE,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_recepcion_aec_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_recepcion_aec_fin||''',''DD/MM/YYYY'')';
  end if;

  --AÑO INGRESO AL AEC
  if PI_V_ANIO_INGRESO_AEC_INI is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND MCOB.ANIO
         BETWEEN '''||PI_V_ANIO_INGRESO_AEC_INI||''' AND '''||PI_V_ANIO_INGRESO_AEC_FIN||'''';
  end if;

  --NRO INGRESO AL AEC
  if PI_V_NRO_INGRESO_AEC_INI is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND MCOB.NRO_INGRESO
         BETWEEN '''||LPAD(PI_V_NRO_INGRESO_AEC_INI,4,'0000')||''' AND '''||LPAD(PI_V_NRO_INGRESO_AEC_FIN,4,'0000')||'''';
  end if;

  --AÑO FILE
  if PI_V_ANIO_FILE_INI is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND MULT.ANIO_FILE_AEC BETWEEN '''||PI_V_ANIO_FILE_INI||''' AND '''||PI_V_ANIO_FILE_FIN||'''';
  end if;

  --NRO FILE
  if PI_V_NRO_FILE_INI is not null then
     v_sql_where_4 := v_sql_where_4 || '
     AND MULT.NRO_FILE_AEC
         BETWEEN '''||LPAD(PI_V_NRO_FILE_INI,10,'0000000000')||''' AND '''||LPAD(PI_V_NRO_FILE_FIN,10,'0000000000')||'''';
  end if;

  --VALOR UIT
  if pi_n_valor_uit_ini>0 then
     v_sql_where_5 := v_sql_where_5 || '
     AND MDET.VALOR_UIT
         BETWEEN '||pi_n_valor_uit_ini||' AND '||pi_n_valor_uit_fin;
  end if;

  --MONTO UIT
  if pi_n_monto_uit_ini>0 then
     v_sql_where_5 := v_sql_where_5 || '
     AND MULT.MONTO_UIT
         BETWEEN '||pi_n_monto_uit_ini||' AND '||pi_n_monto_uit_fin;
  end if;

  --SALDO UIT
  if pi_n_saldo_ini>0 then
     v_sql_where_5 := v_sql_where_5 || '
     AND MULT.SALDO
         BETWEEN '||pi_n_saldo_ini||' AND '||pi_n_saldo_fin;
  end if;

  --TIPO MULTA
  if pi_v_id_tipo_multa is not null then
     v_sql_where_5 := v_sql_where_5 || '
     AND INSTR('''||pi_v_id_tipo_multa||''',''|'' || MULT.FLG_TIPO_MULTA || ''|'' )>0';
  end if;

  --ESTADO MULTA OR
  if pi_v_cod_estado_multa_resol is not null then
     v_sql_where_5 := v_sql_where_5 || '
     AND INSTR('''||pi_v_cod_estado_multa_resol||''',''|'' || TO_CHAR(MDET.ESTADO_MULTA) || ''|'' )>0';
  end if;

  --ESTADO PAGO MULTA
  if pi_v_cod_estado_pago is not null then
     v_sql_where_5 := v_sql_where_5 || '
     AND INSTR('''||pi_v_cod_estado_pago||''',''|'' || TO_CHAR(MULT.COD_ESTADO_PAGO) || ''|'' )>0';
  end if;

  --FECHA ESTADO MULTA OR
  if PI_V_FEC_ESTADO_MULTA_OR_INI is not null then
     v_sql_where_6 := v_sql_where_6 || '
     AND TO_DATE(TO_CHAR(MDET.FEC_ESTADO_MULTA,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||PI_V_FEC_ESTADO_MULTA_OR_INI||''',''DD/MM/YYYY'') AND TO_DATE('''||PI_V_FEC_ESTADO_MULTA_OR_FIN||''',''DD/MM/YYYY'')';
  end if;

  --FECHA ESTADO MULTA COB
  if PI_V_FEC_ESTADO_MULTA_COB_INI is not null then
     v_sql_where_6 := v_sql_where_6 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_ESTADO_MULTA,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||PI_V_FEC_ESTADO_MULTA_COB_INI||''',''DD/MM/YYYY'') AND TO_DATE('''||PI_V_FEC_ESTADO_MULTA_COB_FIN||''',''DD/MM/YYYY'')';
  end if;

  --ESTADO MULTA COBRANZA
  if pi_v_cod_estado_multa_cob is not null then
     v_sql_where_6 := v_sql_where_6 || '
     AND INSTR('''||pi_v_cod_estado_multa_cob||''',''|'' || TO_CHAR(MULT.ESTADO_MULTA) || ''|'' )>0';
  end if;

  --MOTIVO MULTA COBRANZA
  if pi_v_cod_motivo_multa_cob is not null then
     v_sql_where_6 := v_sql_where_6 || '
     AND INSTR('''||pi_v_cod_motivo_multa_cob||''',''|'' || MULT.COD_MOTIVO || ''|'' )>0';
  end if;

  --INDICADOR DE PAGO
  if PI_V_IND_TIPO_PAGO is not null then
     v_sql_where_6 := v_sql_where_6 || '
     AND INSTR('''||PI_V_IND_TIPO_PAGO||''',''|'' || TO_CHAR(SIT_MULTA.COD_SITUACION_MULTA) || ''|'' )>0';
  end if;

  --INDICADOR PORCENTAJE ASOCU MULTA
  if pi_c_flg_asocu_multa<>'0' then
     v_sql_where_6 := v_sql_where_6 || '
     AND NVL(MDET.POR_ASOCU,0) > 0';
  end if;

  --EXPECTATIVA DE COBRO
  if pi_v_id_expectativa_cobro is not null then
     v_sql_where_7 := v_sql_where_7 || '
     AND INSTR('''||pi_v_id_expectativa_cobro||''',''|'' || TO_CHAR(EXPE.COD_EXPECTATIVA_COBRO) || ''|'' )>0';
  end if;

  --INDICADOR EMBARGO
  if pi_c_flg_ind_embargo<>'0' then
     v_sql_where_7 := v_sql_where_7 || '
     AND NVL(EXPE.FLG_EMBARGO,''0'') = ''1''';
  end if;

  --FECHA ULTIMA GENERACION PRECOACTIVO
  if pi_v_fec_carta_precoactiva_ini is not null then
     v_sql_where_7 := v_sql_where_7 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_ULT_GEN_PRECOACTIVA,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_carta_precoactiva_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_carta_precoactiva_fin||''',''DD/MM/YYYY'')';
  end if;

 --FECHA RECEPCION FILE
  if pi_v_fec_recepcion_file_ini is not null then
     v_sql_where_7 := v_sql_where_7 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_INGRESO_AEC,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_recepcion_file_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_recepcion_file_fin||''',''DD/MM/YYYY'')';
  end if;

  ---------------------------------------------------------------------------
  -- FILTROS EXPEDIENTE
  ---------------------------------------------------------------------------
  --ESTADO EXPEDIENTE COBRANZA
  if pi_v_cod_estado_exped_cob is not null then
     v_sql_where_7 := v_sql_where_7 || '
     AND INSTR('''||pi_v_cod_estado_exped_cob||''',''|'' || TO_CHAR(EXPE.ESTADO_EXPEDIENTE) || ''|'' )>0';
  end if;

  --AÑO EXPEDIENTE COBRANZA
  if pi_v_anio is not null then
     v_sql_where_7 := v_sql_where_7 || '
     AND EXPE.ANIO='''||pi_v_anio||'''';
  end if;

  --NRO EXPEDIENTE COBRANZA
  if pi_v_nro_exp_cob_ini>0 then
     v_sql_where_7 := v_sql_where_7 || '
     AND EXPE.NRO_EXPEDIENTE
         BETWEEN lpad('''||pi_v_nro_exp_cob_ini||''',10,''0000000000'') AND lpad('''||pi_v_nro_exp_cob_fin||''',10,''0000000000'')';
  end if;

  --FECHA GENERACION EXPEDIENTE COBRANZA
  if pi_v_fec_gen_exped_cob_ini is not null then
     v_sql_where_8 := v_sql_where_8 || '
     AND TO_DATE(TO_CHAR(EXPE.FEC_INGRESO,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_gen_exped_cob_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_gen_exped_cob_fin||''',''DD/MM/YYYY'')';
  end if;

  --GESTOR COBRANZA
  if pi_v_gestor_cobranza is not null then
     v_sql_where_8 := v_sql_where_8 || '
     AND INSTR('''||pi_v_gestor_cobranza||''',''|'' || TO_CHAR(MULT.ID_USUARIO_ASIG_COBRANZA) || ''|'' )>0';
  end if;

  --FECHA EMISION DE LA REC
  if pi_v_fec_emi_rec_ini is not null then
     v_sql_where_8 := v_sql_where_8 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_EMISION_REC,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_emi_rec_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||nvl(pi_v_fec_emi_rec_fin,pi_v_fec_emi_rec_ini)||''',''DD/MM/YYYY'')';
  end if;

  --FECHA NOTIFICACION DE LA REC
  if pi_v_fec_noti_rec_ini is not null then
     v_sql_where_8 := v_sql_where_8 || '
     AND TO_DATE(TO_CHAR(MULT.FEC_NOTIF_REC,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_noti_rec_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_noti_rec_fin||''',''DD/MM/YYYY'')';
  end if;

  --MOTIVO EXPEDIENTE COBRANZA
  if pi_v_cod_motivo_exped_cob is not null then
     v_sql_where_8 := v_sql_where_8 || '
     AND INSTR('''||pi_v_cod_motivo_exped_cob||''',''|'' || TO_CHAR(EXPE.ID_MOTIVO) || ''|'' )>0';
  end if;

  --FECHA ULTIMO ESTADO EXPEDIENTE
  if pi_v_fec_est_exped_cob_ini is not null then
     v_sql_where_9 := v_sql_where_9 || '
     AND TO_DATE(TO_CHAR(EXPE.FEC_ESTADO_EXPEDIENTE,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_est_exped_cob_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_est_exped_cob_fin||''',''DD/MM/YYYY'')';
  end if;

  --NUMERO DE ENVIO A ARCHIVO CENTRAL
  if pi_v_num_env_arch_ini is not null then
     v_sql_where_9 := v_sql_where_9 || '
     AND ARCH_CEN.NRO_ORDEN
         BETWEEN LPAD('''||pi_v_num_env_arch_ini||''',4,''0000'') AND LPAD('''||pi_v_num_env_arch_fin||''',4,''0000'')';
  end if;

  --FECHA ENVIO ARCHIVO CENTRAL
  if pi_v_fec_envi_arch_ini is not null then
     v_sql_where_9 := v_sql_where_9 || '
     AND TO_DATE(TO_CHAR(ARCH_CEN.FEC_ENVIO,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_envi_arch_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_envi_arch_fin||''',''DD/MM/YYYY'')';
  end if;

  --NRO OFICIO SUNAT
  if pi_v_nro_ofic_sunat_ini is not null then
     v_sql_where_9 := v_sql_where_9 || '
     AND (MUAN.NRO_OFICIO_SUNAT_CODIGO || MUAN.NRO_OFICIO_SUNAT_ANIO ||
     MUAN.NRO_OFICIO_SUNAT_PREFIJO || MUAN.NRO_OFICIO_SUNAT_CORRELATIVO)
     BETWEEN '''||pi_v_nro_ofic_sunat_ini||''' AND '''||pi_v_nro_ofic_sunat_fin||'''';
  end if;

  --DERECHO ANTIDUMOPING
  if pi_n_dere_antiDump_ini>0 then
     v_sql_where_9 := v_sql_where_9 || '
     AND MUAN.MONTO_ANTIDUMPING
         BETWEEN '||pi_n_dere_antiDump_ini||' AND '||pi_n_dere_antiDump_fin;
  end if;

  --PARTIDA ARANCELARIA
  if pi_v_nro_parti_ini is not null then
  v_sql_where_10 := v_sql_where_10 || '
      AND PART.CODIGO
      BETWEEN lpad('''||pi_v_nro_parti_ini||''',10,''0000000000'') AND lpad('''||pi_v_nro_parti_fin||''',10,''0000000000'')';
  end if;

  --MEMO ANTIDUMPING --FALTA EL CAMPO NO EXISTE EN LA INTERFAZ
  --NRO DUA
  if pi_v_nro_dua_ini is not null then
     v_sql_where_10 := v_sql_where_10 || '
     AND (MUAN.NRO_DUA_CODIGO || MUAN.NRO_DUA_ANIO || MUAN.NRO_DUA_CORRELATIVO)
         BETWEEN '''||pi_v_nro_dua_ini||''' AND '''||pi_v_nro_dua_fin||'''';
  end if;

  --NRO LIQUIDACION COBRANZA
  if pi_v_nro_liq_cob_ini is not null then
     v_sql_where_10 := v_sql_where_10 || '
     AND (MUAN.NRO_LIQUIDACION_CODIGO || MUAN.NRO_LIQUIDACION_ANIO || MUAN.NRO_LIQUIDACION_CORRELATIVO)
         BETWEEN '''||pi_v_nro_liq_cob_ini||''' AND '''||pi_v_nro_liq_cob_fin||'''';
  end if;

  --INTENDENCIA
  if pi_v_id_intendencia is not null then
     v_sql_where_10 := v_sql_where_10 || '
     AND INSTR('''||pi_v_id_intendencia||''',''|'' || TO_CHAR(MUAN.ID_INTENDENCIA) || ''|'' )>0';
  end if;

 --FECHA ASIGNACION GESTOR COBRANZA
  if pi_v_fec_asig_gestor_ini is not null then
     v_sql_where_11 := v_sql_where_11 || '
     AND TO_DATE(TO_CHAR(MULT.FECHA_ASIG_COBRANZA,''DD/MM/YYYY''),''DD/MM/YYYY'')
         BETWEEN TO_DATE('''||pi_v_fec_asig_gestor_ini||''',''DD/MM/YYYY'') AND TO_DATE('''||pi_v_fec_asig_gestor_fin||''',''DD/MM/YYYY'')';
  end if;

  --v_sql_where_12 := v_sql_where_12 || '
  --ORDER BY CUM DESC';


  DBMS_OUTPUT.put_line(v_sql_select_1);
  DBMS_OUTPUT.put_line(v_sql_select_2);
  DBMS_OUTPUT.put_line(v_sql_select_3);
  DBMS_OUTPUT.put_line(v_sql_select_4);
  DBMS_OUTPUT.put_line(v_sql_select_5);
  ---
  DBMS_OUTPUT.put_line(v_sql_join_1);
  DBMS_OUTPUT.put_line(v_sql_join_2);
  DBMS_OUTPUT.put_line(v_sql_join_3);
  DBMS_OUTPUT.put_line(v_sql_join_4);
  DBMS_OUTPUT.put_line(v_sql_join_5);
  ---
  DBMS_OUTPUT.put_line(v_sql_where_1);
  DBMS_OUTPUT.put_line(v_sql_where_2);
  DBMS_OUTPUT.put_line(v_sql_where_3);
  DBMS_OUTPUT.put_line(v_sql_where_4);
  DBMS_OUTPUT.put_line(v_sql_where_5);
  ---
  DBMS_OUTPUT.put_line(v_sql_where_6);
  DBMS_OUTPUT.put_line(v_sql_where_7);
  DBMS_OUTPUT.put_line(v_sql_where_8);
  DBMS_OUTPUT.put_line(v_sql_where_9);
  DBMS_OUTPUT.put_line(v_sql_where_10);
  DBMS_OUTPUT.put_line(v_sql_where_11);
  DBMS_OUTPUT.put_line(v_sql_where_12);

  open po_cu_retorno for
  --select sysdate from dual;

                     v_sql_select_1 ||
                     v_sql_select_2 ||
                     v_sql_select_3 ||
                     v_sql_select_4 ||
                     v_sql_select_5 ||
                     v_sql_join_1 ||
                     v_sql_join_2 ||
                     v_sql_join_3 ||
                     v_sql_join_4 ||
                     v_sql_join_5 ||
                     v_sql_where_1 ||
                     v_sql_where_2||
                     v_sql_where_3 ||
                     v_sql_where_4 ||
                     v_sql_where_5 ||
                     v_sql_where_6 ||
                     v_sql_where_7 ||
                     v_sql_where_8 ||
                     v_sql_where_9 ||
                     v_sql_where_10 ||
                     v_sql_where_11 ||
                     v_sql_where_12
                     ;

  COMMIT;

end;

END SCOB_PK_COBRANZAS;
/
